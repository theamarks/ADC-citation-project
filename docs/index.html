<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml" lang="en" xml:lang="en"><head>

<meta charset="utf-8">
<meta name="generator" content="quarto-1.1.251">

<meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=yes">

<meta name="author" content="Althea Marks">
<meta name="dcterms.date" content="2022-09-28">

<title>Searching for Elusive Arctic Dataset Citations</title>
<style>
code{white-space: pre-wrap;}
span.smallcaps{font-variant: small-caps;}
div.columns{display: flex; gap: min(4vw, 1.5em);}
div.column{flex: auto; overflow-x: auto;}
div.hanging-indent{margin-left: 1.5em; text-indent: -1.5em;}
ul.task-list{list-style: none;}
ul.task-list li input[type="checkbox"] {
  width: 0.8em;
  margin: 0 0.8em 0.2em -1.6em;
  vertical-align: middle;
}
pre > code.sourceCode { white-space: pre; position: relative; }
pre > code.sourceCode > span { display: inline-block; line-height: 1.25; }
pre > code.sourceCode > span:empty { height: 1.2em; }
.sourceCode { overflow: visible; }
code.sourceCode > span { color: inherit; text-decoration: inherit; }
div.sourceCode { margin: 1em 0; }
pre.sourceCode { margin: 0; }
@media screen {
div.sourceCode { overflow: auto; }
}
@media print {
pre > code.sourceCode { white-space: pre-wrap; }
pre > code.sourceCode > span { text-indent: -5em; padding-left: 5em; }
}
pre.numberSource code
  { counter-reset: source-line 0; }
pre.numberSource code > span
  { position: relative; left: -4em; counter-increment: source-line; }
pre.numberSource code > span > a:first-child::before
  { content: counter(source-line);
    position: relative; left: -1em; text-align: right; vertical-align: baseline;
    border: none; display: inline-block;
    -webkit-touch-callout: none; -webkit-user-select: none;
    -khtml-user-select: none; -moz-user-select: none;
    -ms-user-select: none; user-select: none;
    padding: 0 4px; width: 4em;
    color: #aaaaaa;
  }
pre.numberSource { margin-left: 3em; border-left: 1px solid #aaaaaa;  padding-left: 4px; }
div.sourceCode
  {   }
@media screen {
pre > code.sourceCode > span > a:first-child::before { text-decoration: underline; }
}
code span.al { color: #ff0000; font-weight: bold; } /* Alert */
code span.an { color: #60a0b0; font-weight: bold; font-style: italic; } /* Annotation */
code span.at { color: #7d9029; } /* Attribute */
code span.bn { color: #40a070; } /* BaseN */
code span.bu { color: #008000; } /* BuiltIn */
code span.cf { color: #007020; font-weight: bold; } /* ControlFlow */
code span.ch { color: #4070a0; } /* Char */
code span.cn { color: #880000; } /* Constant */
code span.co { color: #60a0b0; font-style: italic; } /* Comment */
code span.cv { color: #60a0b0; font-weight: bold; font-style: italic; } /* CommentVar */
code span.do { color: #ba2121; font-style: italic; } /* Documentation */
code span.dt { color: #902000; } /* DataType */
code span.dv { color: #40a070; } /* DecVal */
code span.er { color: #ff0000; font-weight: bold; } /* Error */
code span.ex { } /* Extension */
code span.fl { color: #40a070; } /* Float */
code span.fu { color: #06287e; } /* Function */
code span.im { color: #008000; font-weight: bold; } /* Import */
code span.in { color: #60a0b0; font-weight: bold; font-style: italic; } /* Information */
code span.kw { color: #007020; font-weight: bold; } /* Keyword */
code span.op { color: #666666; } /* Operator */
code span.ot { color: #007020; } /* Other */
code span.pp { color: #bc7a00; } /* Preprocessor */
code span.sc { color: #4070a0; } /* SpecialChar */
code span.ss { color: #bb6688; } /* SpecialString */
code span.st { color: #4070a0; } /* String */
code span.va { color: #19177c; } /* Variable */
code span.vs { color: #4070a0; } /* VerbatimString */
code span.wa { color: #60a0b0; font-weight: bold; font-style: italic; } /* Warning */
</style>


<script src="site_libs/quarto-nav/quarto-nav.js"></script>
<script src="site_libs/clipboard/clipboard.min.js"></script>
<script src="site_libs/quarto-search/autocomplete.umd.js"></script>
<script src="site_libs/quarto-search/fuse.min.js"></script>
<script src="site_libs/quarto-search/quarto-search.js"></script>
<meta name="quarto:offset" content="./">
<script src="site_libs/quarto-html/quarto.js"></script>
<script src="site_libs/quarto-html/popper.min.js"></script>
<script src="site_libs/quarto-html/tippy.umd.min.js"></script>
<script src="site_libs/quarto-html/anchor.min.js"></script>
<link href="site_libs/quarto-html/tippy.css" rel="stylesheet">
<link href="site_libs/quarto-html/quarto-syntax-highlighting.css" rel="stylesheet" id="quarto-text-highlighting-styles">
<script src="site_libs/bootstrap/bootstrap.min.js"></script>
<link href="site_libs/bootstrap/bootstrap-icons.css" rel="stylesheet">
<link href="site_libs/bootstrap/bootstrap.min.css" rel="stylesheet" id="quarto-bootstrap" data-mode="light">
<script id="quarto-search-options" type="application/json">{
  "location": "sidebar",
  "copy-button": false,
  "collapse-after": 3,
  "panel-placement": "start",
  "type": "textbox",
  "limit": 20,
  "language": {
    "search-no-results-text": "No results",
    "search-matching-documents-text": "matching documents",
    "search-copy-link-title": "Copy link to search",
    "search-hide-matches-text": "Hide additional matches",
    "search-more-match-text": "more match in this document",
    "search-more-matches-text": "more matches in this document",
    "search-clear-button-title": "Clear",
    "search-detached-cancel-button-title": "Cancel",
    "search-submit-button-title": "Submit"
  }
}</script>


</head>

<body>

<div id="quarto-search-results"></div>
<!-- content -->
<div id="quarto-content" class="quarto-container page-columns page-rows-contents page-layout-article">
<!-- sidebar -->
<!-- margin-sidebar -->
    <div id="quarto-margin-sidebar" class="sidebar margin-sidebar">
        <nav id="TOC" role="doc-toc" class="toc-active">
    <h2 id="toc-title">On this page</h2>
   
  <ul>
  <li><a href="#purpose" id="toc-purpose" class="nav-link active" data-scroll-target="#purpose">Purpose</a></li>
  <li><a href="#questions" id="toc-questions" class="nav-link" data-scroll-target="#questions">Questions</a></li>
  <li><a href="#methods-overview" id="toc-methods-overview" class="nav-link" data-scroll-target="#methods-overview">Methods Overview</a></li>
  <li><a href="#setup" id="toc-setup" class="nav-link" data-scroll-target="#setup">Setup</a></li>
  <li><a href="#analysis" id="toc-analysis" class="nav-link" data-scroll-target="#analysis">Analysis</a>
  <ul class="collapse">
  <li><a href="#retrieve-all-adc-citations-with-get-api-request-body" id="toc-retrieve-all-adc-citations-with-get-api-request-body" class="nav-link" data-scroll-target="#retrieve-all-adc-citations-with-get-api-request-body">1. Retrieve all ADC citations with GET API request body</a></li>
  <li><a href="#get-all-adc-dois-from-solr-query" id="toc-get-all-adc-dois-from-solr-query" class="nav-link" data-scroll-target="#get-all-adc-dois-from-solr-query">2. Get all ADC DOIs from SOLR query</a></li>
  <li><a href="#run-all-adc-dataset-dois-through-scythe-libraries" id="toc-run-all-adc-dataset-dois-through-scythe-libraries" class="nav-link" data-scroll-target="#run-all-adc-dataset-dois-through-scythe-libraries">3. Run all ADC dataset DOIs through <code>scythe</code> libraries</a></li>
  <li><a href="#dealing-with-api-request-errors" id="toc-dealing-with-api-request-errors" class="nav-link" data-scroll-target="#dealing-with-api-request-errors">4. Dealing with API request errors</a></li>
  <li><a href="#calculate-citation-source-overlap" id="toc-calculate-citation-source-overlap" class="nav-link" data-scroll-target="#calculate-citation-source-overlap">5. Calculate citation source overlap</a></li>
  <li><a href="#how-many-completely-unique-citations-found-in-each-source" id="toc-how-many-completely-unique-citations-found-in-each-source" class="nav-link" data-scroll-target="#how-many-completely-unique-citations-found-in-each-source">6. How many completely unique citations found in each source?</a></li>
  <li><a href="#compare-scythe-results-to-dataone-metrics-citations" id="toc-compare-scythe-results-to-dataone-metrics-citations" class="nav-link" data-scroll-target="#compare-scythe-results-to-dataone-metrics-citations">7. Compare <code>scythe</code> results to DataOne Metrics citations</a></li>
  </ul></li>
  <li><a href="#results" id="toc-results" class="nav-link" data-scroll-target="#results">Results</a></li>
  <li><a href="#next-steps" id="toc-next-steps" class="nav-link" data-scroll-target="#next-steps">Next Steps</a></li>
  </ul>
</nav>
    </div>
<!-- main -->
<main class="content" id="quarto-document-content">

<header id="title-block-header" class="quarto-title-block default">
<div class="quarto-title">
<div class="quarto-title-block"><div><h1 class="title">Searching for Elusive Arctic Dataset Citations</h1><button type="button" class="btn code-tools-button dropdown-toggle" id="quarto-code-tools-menu" data-bs-toggle="dropdown" aria-expanded="false"><i class="bi"></i> Code</button><ul class="dropdown-menu dropdown-menu-end" aria-labelelledby="quarto-code-tools-menu"><li><a id="quarto-show-all-code" class="dropdown-item" href="javascript:void(0)" role="button">Show All Code</a></li><li><a id="quarto-hide-all-code" class="dropdown-item" href="javascript:void(0)" role="button">Hide All Code</a></li><li><hr class="dropdown-divider"></li><li><a id="quarto-view-source" class="dropdown-item" href="javascript:void(0)" role="button">View Source</a></li></ul></div></div>
<p class="subtitle lead">Arctice Data Center Data Fellowship Project 2022</p>
</div>



<div class="quarto-title-meta">

    <div>
    <div class="quarto-title-meta-heading">Author</div>
    <div class="quarto-title-meta-contents">
             <p>Althea Marks </p>
          </div>
  </div>
    
    <div>
    <div class="quarto-title-meta-heading">Published</div>
    <div class="quarto-title-meta-contents">
      <p class="date">September 28, 2022</p>
    </div>
  </div>
    
  </div>
  

</header>

<section id="purpose" class="level2">
<h2 class="anchored" data-anchor-id="purpose">Purpose</h2>
<p>Run ADC DOIs through <code>scythe</code> &amp; compare to known DataONE metrics citations. Known ADC citations have mixed origins including DataCite, pervious <code>scythe</code> runs, and mannual additions via the ADC UI.</p>
</section>
<section id="questions" class="level2">
<h2 class="anchored" data-anchor-id="questions">Questions</h2>
<ol type="1">
<li><p>Does the addition of the <a href="https://geodeepdive.org/">xDD</a> digital library to the <a href="https://github.com/DataONEorg/scythe/tree/main">Scythe package</a> improve the quality and scope of citations in the ADC?</p></li>
<li><p>Does increasing the number of sources we are searching result in more complete coverage (quality)?</p>
<ul>
<li><p>Overlap in citation among sources</p></li>
<li><p>Species ratification curve inspired - start to get to a point where we can estimate the actual amount of citation out there. Dataset citations are rare enough the technique may not be applicable. Rarefaction.</p></li>
</ul>
<blockquote class="blockquote">
<p>The calculation of species richness for a given number of samples is based on the rarefaction curve. The rarefaction curve is a plot of the number of species against the number of samples. This curve is created by randomly re-sampling the pool of N samples several times and then plotting the average number of species found on each sample. Generally, it initially grows rapidly (as the most common species are found) and then slightly flattens (as the rarest species remain to be sampled). <a href="https://www.cd-genomics.com/microbioseq/rarefaction-curve-a-measure-of-species-richness-and-diversity.html">source</a></p>
</blockquote>
<p><em>Would this be sampling the entireity of ADC DOIs?</em></p></li>
<li><p>Does the prevalence of data citations differ among disciplines (enviro vs SS)?</p>
<ul>
<li><p>Use ADC dicipline classifications</p></li>
<li><p>Dataset citations are rare, N of classifications varies widely, need to control for sampling biases <a href="https://zenodo.org/record/4730857#.YoaQ2WDMKrM" class="uri">https://zenodo.org/record/4730857#.YoaQ2WDMKrM</a></p></li>
</ul></li>
</ol>
<!-- -->
<ol start="4" type="1">
<li><p>Total number of citations is extremely useful. Ground truth analysis - for a small number of datasets manually search through literature for citations.</p></li>
<li><p>Do usage metrics (downloads and views) correlate well with citation metrics?</p></li>
</ol>
</section>
<section id="methods-overview" class="level2">
<h2 class="anchored" data-anchor-id="methods-overview">Methods Overview</h2>
<ol type="1">
<li>Gather existing/known ADC dataset citations picked up by the automated DataONE metrics API</li>
<li>Get a list of all ADC dataset DOIs</li>
<li>Run all ADC dataset DOIs through <code>scythe</code> libraries</li>
<li>Review HTTP errors and rerun</li>
<li>Calculate citation source overlap</li>
<li>Compare citations from <code>scythe</code> to DataONE metrics</li>
</ol>
</section>
<section id="setup" class="level2">
<h2 class="anchored" data-anchor-id="setup">Setup</h2>
<div class="cell">
<details>
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb1"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb1-1"><a href="#cb1-1" aria-hidden="true" tabindex="-1"></a><span class="fu">dir.create</span>(<span class="at">path =</span> <span class="st">"./output"</span>, <span class="at">showWarnings =</span> F)</span>
<span id="cb1-2"><a href="#cb1-2" aria-hidden="true" tabindex="-1"></a>output_directory <span class="ot">&lt;-</span> <span class="fu">file.path</span>(<span class="st">"./output"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
</div>
<div class="cell">
<details>
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb2"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb2-1"><a href="#cb2-1" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(readr)</span>
<span id="cb2-2"><a href="#cb2-2" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(jsonlite)</span>
<span id="cb2-3"><a href="#cb2-3" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(tidyr)</span>
<span id="cb2-4"><a href="#cb2-4" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(dplyr)</span>
<span id="cb2-5"><a href="#cb2-5" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(dataone)</span>
<span id="cb2-6"><a href="#cb2-6" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(job)</span>
<span id="cb2-7"><a href="#cb2-7" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(magrittr)</span>
<span id="cb2-8"><a href="#cb2-8" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(readr)</span>
<span id="cb2-9"><a href="#cb2-9" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(stringr)</span>
<span id="cb2-10"><a href="#cb2-10" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(purrr)</span>
<span id="cb2-11"><a href="#cb2-11" aria-hidden="true" tabindex="-1"></a><span class="co"># library(scythe) # published version of package</span></span>
<span id="cb2-12"><a href="#cb2-12" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb2-13"><a href="#cb2-13" aria-hidden="true" tabindex="-1"></a><span class="co"># install development version of scythe package with added xdd library</span></span>
<span id="cb2-14"><a href="#cb2-14" aria-hidden="true" tabindex="-1"></a>devtools<span class="sc">::</span><span class="fu">install_github</span>(<span class="st">"dataoneorg/scythe@develop"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
</div>
</section>
<section id="analysis" class="level2">
<h2 class="anchored" data-anchor-id="analysis">Analysis</h2>
<section id="retrieve-all-adc-citations-with-get-api-request-body" class="level3">
<h3 class="anchored" data-anchor-id="retrieve-all-adc-citations-with-get-api-request-body">1. Retrieve all ADC citations with GET API request body</h3>
<p>metrics service production endpoint: <a href="https://logproc-stage-ucsb-1.test.dataone.org/metrics" class="uri">https://logproc-stage-ucsb-1.test.dataone.org/metrics</a> documentation: <a href="https://app.swaggerhub.com/apis/nenuji/data-metrics/1.0.0.3" class="uri">https://app.swaggerhub.com/apis/nenuji/data-metrics/1.0.0.3</a></p>
<div class="cell">
<details>
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb3"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb3-1"><a href="#cb3-1" aria-hidden="true" tabindex="-1"></a>{</span>
<span id="cb3-2"><a href="#cb3-2" aria-hidden="true" tabindex="-1"></a>  <span class="st">"metricsPage"</span><span class="sc">:</span>{</span>
<span id="cb3-3"><a href="#cb3-3" aria-hidden="true" tabindex="-1"></a>    <span class="st">"total"</span><span class="sc">:</span><span class="dv">0</span>,</span>
<span id="cb3-4"><a href="#cb3-4" aria-hidden="true" tabindex="-1"></a>    <span class="st">"start"</span><span class="sc">:</span><span class="dv">0</span>,</span>
<span id="cb3-5"><a href="#cb3-5" aria-hidden="true" tabindex="-1"></a>    <span class="st">"count"</span><span class="sc">:</span><span class="dv">0</span></span>
<span id="cb3-6"><a href="#cb3-6" aria-hidden="true" tabindex="-1"></a>  },</span>
<span id="cb3-7"><a href="#cb3-7" aria-hidden="true" tabindex="-1"></a>  <span class="st">"metrics"</span><span class="sc">:</span>[<span class="st">"citations"</span>],</span>
<span id="cb3-8"><a href="#cb3-8" aria-hidden="true" tabindex="-1"></a>  <span class="st">"filterBy"</span><span class="sc">:</span>[{</span>
<span id="cb3-9"><a href="#cb3-9" aria-hidden="true" tabindex="-1"></a>    <span class="st">"filterType"</span><span class="sc">:</span><span class="st">"repository"</span>,</span>
<span id="cb3-10"><a href="#cb3-10" aria-hidden="true" tabindex="-1"></a>    <span class="st">"values"</span><span class="sc">:</span>[<span class="st">"urn:node:ARCTIC"</span>],</span>
<span id="cb3-11"><a href="#cb3-11" aria-hidden="true" tabindex="-1"></a>    <span class="st">"interpretAs"</span><span class="sc">:</span><span class="st">"list"</span></span>
<span id="cb3-12"><a href="#cb3-12" aria-hidden="true" tabindex="-1"></a>  },</span>
<span id="cb3-13"><a href="#cb3-13" aria-hidden="true" tabindex="-1"></a>  {</span>
<span id="cb3-14"><a href="#cb3-14" aria-hidden="true" tabindex="-1"></a>    <span class="st">"filterType"</span><span class="sc">:</span><span class="st">"month"</span>,</span>
<span id="cb3-15"><a href="#cb3-15" aria-hidden="true" tabindex="-1"></a>    <span class="st">"values"</span><span class="sc">:</span>[<span class="st">"01/01/2012"</span>,</span>
<span id="cb3-16"><a href="#cb3-16" aria-hidden="true" tabindex="-1"></a>              <span class="st">"05/24/2022"</span>],</span>
<span id="cb3-17"><a href="#cb3-17" aria-hidden="true" tabindex="-1"></a>    <span class="st">"interpretAs"</span><span class="sc">:</span><span class="st">"range"</span></span>
<span id="cb3-18"><a href="#cb3-18" aria-hidden="true" tabindex="-1"></a>  }],</span>
<span id="cb3-19"><a href="#cb3-19" aria-hidden="true" tabindex="-1"></a>  <span class="st">"groupBy"</span><span class="sc">:</span>[<span class="st">"month"</span>]</span>
<span id="cb3-20"><a href="#cb3-20" aria-hidden="true" tabindex="-1"></a>}</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
</div>
<p>Example request:</p>
<div class="cell">
<details>
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb4"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb4-1"><a href="#cb4-1" aria-hidden="true" tabindex="-1"></a>https<span class="sc">:</span><span class="er">//</span>logproc<span class="sc">-</span>stage<span class="sc">-</span>ucsb<span class="fl">-1.</span>test.dataone.org<span class="sc">/</span>metrics?metricsRequest<span class="ot">=</span>{<span class="sc">%22metricsPage%</span><span class="dv">22</span><span class="sc">:</span>{<span class="sc">%22total%</span><span class="dv">22</span><span class="sc">:</span><span class="dv">0</span>,<span class="sc">%22start%</span><span class="dv">22</span><span class="sc">:</span><span class="dv">0</span>,<span class="sc">%22count%</span><span class="dv">22</span><span class="sc">:</span><span class="dv">0</span>},<span class="sc">%22metrics%</span><span class="dv">22</span><span class="sc">:</span>[<span class="sc">%22citations%</span><span class="dv">22</span>],<span class="sc">%22filterBy%</span><span class="dv">22</span><span class="sc">:</span>[{<span class="sc">%22filterType%</span><span class="dv">22</span><span class="sc">:%22repository%</span><span class="dv">22</span>,<span class="sc">%22values%</span><span class="dv">22</span><span class="sc">:</span>[<span class="sc">%22urn:node:ARCTIC%</span><span class="dv">22</span>],<span class="sc">%22interpretAs%</span><span class="dv">22</span><span class="sc">:%22list%</span><span class="dv">22</span>},{<span class="sc">%22filterType%</span><span class="dv">22</span><span class="sc">:%22month%</span><span class="dv">22</span>,<span class="sc">%22values%</span><span class="dv">22</span><span class="sc">:</span>[<span class="sc">%2201/01/2012%</span><span class="dv">22</span>,<span class="sc">%2205/24/2022%</span><span class="dv">22</span>],<span class="sc">%22interpretAs%</span><span class="dv">22</span><span class="sc">:%22range%</span><span class="dv">22</span>}],<span class="sc">%22groupBy%</span><span class="dv">22</span><span class="sc">:</span>[<span class="sc">%22month%</span><span class="dv">22</span>]</span>
<span id="cb4-2"><a href="#cb4-2" aria-hidden="true" tabindex="-1"></a>}</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
</div>
<p>Function to retrieve dataset citations generated by DataOne metrics service (from Jeanette Clark):</p>
<div class="cell">
<details>
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb5"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb5-1"><a href="#cb5-1" aria-hidden="true" tabindex="-1"></a>metrics_citations <span class="ot">&lt;-</span> <span class="cf">function</span>(<span class="at">from =</span> <span class="fu">as.POSIXct</span>(<span class="st">"2010-01-01"</span>), <span class="at">to =</span> <span class="fu">as.POSIXct</span>(<span class="fu">Sys.Date</span>())){</span>
<span id="cb5-2"><a href="#cb5-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb5-3"><a href="#cb5-3" aria-hidden="true" tabindex="-1"></a>    from <span class="ot">&lt;-</span> <span class="fu">as.Date</span>(from); to <span class="ot">&lt;-</span> <span class="fu">as.Date</span>(to)</span>
<span id="cb5-4"><a href="#cb5-4" aria-hidden="true" tabindex="-1"></a>    from_q <span class="ot">&lt;-</span> <span class="fu">paste</span>(stringr<span class="sc">::</span><span class="fu">str_pad</span>(lubridate<span class="sc">::</span><span class="fu">month</span>(from), <span class="dv">2</span>, <span class="at">side =</span> <span class="st">"left"</span>, <span class="at">pad =</span> <span class="st">"0"</span>),</span>
<span id="cb5-5"><a href="#cb5-5" aria-hidden="true" tabindex="-1"></a>                    stringr<span class="sc">::</span><span class="fu">str_pad</span>(lubridate<span class="sc">::</span><span class="fu">day</span>(from), <span class="dv">2</span>, <span class="at">side =</span> <span class="st">"left"</span>, <span class="at">pad =</span> <span class="st">"0"</span>),</span>
<span id="cb5-6"><a href="#cb5-6" aria-hidden="true" tabindex="-1"></a>                    stringr<span class="sc">::</span><span class="fu">str_pad</span>(lubridate<span class="sc">::</span><span class="fu">year</span>(from), <span class="dv">2</span>, <span class="at">side =</span> <span class="st">"left"</span>, <span class="at">pad =</span> <span class="st">"0"</span>),</span>
<span id="cb5-7"><a href="#cb5-7" aria-hidden="true" tabindex="-1"></a>                    <span class="at">sep =</span> <span class="st">"/"</span>)</span>
<span id="cb5-8"><a href="#cb5-8" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb5-9"><a href="#cb5-9" aria-hidden="true" tabindex="-1"></a>    to_q <span class="ot">&lt;-</span> <span class="fu">paste</span>(stringr<span class="sc">::</span><span class="fu">str_pad</span>(lubridate<span class="sc">::</span><span class="fu">month</span>(to), <span class="dv">2</span>, <span class="at">side =</span> <span class="st">"left"</span>, <span class="at">pad =</span> <span class="st">"0"</span>),</span>
<span id="cb5-10"><a href="#cb5-10" aria-hidden="true" tabindex="-1"></a>                  stringr<span class="sc">::</span><span class="fu">str_pad</span>(lubridate<span class="sc">::</span><span class="fu">day</span>(to), <span class="dv">2</span>, <span class="at">side =</span> <span class="st">"left"</span>, <span class="at">pad =</span> <span class="st">"0"</span>),</span>
<span id="cb5-11"><a href="#cb5-11" aria-hidden="true" tabindex="-1"></a>                  stringr<span class="sc">::</span><span class="fu">str_pad</span>(lubridate<span class="sc">::</span><span class="fu">year</span>(to), <span class="dv">2</span>, <span class="at">side =</span> <span class="st">"left"</span>, <span class="at">pad =</span> <span class="st">"0"</span>),</span>
<span id="cb5-12"><a href="#cb5-12" aria-hidden="true" tabindex="-1"></a>                  <span class="at">sep =</span> <span class="st">"/"</span>)</span>
<span id="cb5-13"><a href="#cb5-13" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb5-14"><a href="#cb5-14" aria-hidden="true" tabindex="-1"></a>    d <span class="ot">&lt;-</span> jsonlite<span class="sc">::</span><span class="fu">fromJSON</span>(<span class="fu">paste0</span>(<span class="st">'https://logproc-stage-ucsb-1.test.dataone.org/metrics?q={%22metricsPage%22:{%22total%22:0,%22start%22:0,%22count%22:0},%22metrics%22:[%22citations%22],%22filterBy%22:[{%22filterType%22:%22repository%22,%22values%22:[%22urn:node:ARCTIC%22],%22interpretAs%22:%22list%22},{%22filterType%22:%22month%22,%22values%22:[%22'</span>, from_q,<span class="st">'%22,%22'</span>, to_q, <span class="st">'%22],%22interpretAs%22:%22range%22}],%22groupBy%22:[%22month%22]}'</span>))</span>
<span id="cb5-15"><a href="#cb5-15" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb5-16"><a href="#cb5-16" aria-hidden="true" tabindex="-1"></a>    output_json <span class="ot">&lt;-</span> d<span class="sc">$</span>resultDetails<span class="sc">$</span>citations <span class="co"># pulls citation info</span></span>
<span id="cb5-17"><a href="#cb5-17" aria-hidden="true" tabindex="-1"></a>    output_df <span class="ot">&lt;-</span> <span class="fu">as.data.frame</span>(<span class="fu">do.call</span>(rbind, output_json), <span class="at">row.names =</span> <span class="cn">FALSE</span>) <span class="co"># binds nested cit info into dataframe</span></span>
<span id="cb5-18"><a href="#cb5-18" aria-hidden="true" tabindex="-1"></a>   <span class="co"># output_clean &lt;- rownames_to_column(output_df, var = "citation_id") # converts row names to column</span></span>
<span id="cb5-19"><a href="#cb5-19" aria-hidden="true" tabindex="-1"></a>    <span class="fu">return</span>(output_df)</span>
<span id="cb5-20"><a href="#cb5-20" aria-hidden="true" tabindex="-1"></a>}</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
</div>
<div class="cell" data-hash="index_cache/html/adc_citations_c6a964399b0aa461122144c3caea853a">
<details>
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb6"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb6-1"><a href="#cb6-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Run ADC API Get call, unnest target_id results to individual columns</span></span>
<span id="cb6-2"><a href="#cb6-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb6-3"><a href="#cb6-3" aria-hidden="true" tabindex="-1"></a>dataone_cit <span class="ot">&lt;-</span> <span class="fu">metrics_citations</span>()</span>
<span id="cb6-4"><a href="#cb6-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb6-5"><a href="#cb6-5" aria-hidden="true" tabindex="-1"></a>dataone_cit <span class="ot">&lt;-</span> tidyr<span class="sc">::</span><span class="fu">unnest</span>(dataone_cit,</span>
<span id="cb6-6"><a href="#cb6-6" aria-hidden="true" tabindex="-1"></a>                          <span class="at">cols =</span> <span class="fu">c</span>(target_id, source_id, source_url,</span>
<span id="cb6-7"><a href="#cb6-7" aria-hidden="true" tabindex="-1"></a>                                   link_publication_date, origin, title,</span>
<span id="cb6-8"><a href="#cb6-8" aria-hidden="true" tabindex="-1"></a>                                   publisher, journal, volume, page, year_of_publishing))</span>
<span id="cb6-9"><a href="#cb6-9" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb6-10"><a href="#cb6-10" aria-hidden="true" tabindex="-1"></a><span class="fu">write_csv</span>(dataone_cit, <span class="fu">file.path</span>(output_directory,</span>
<span id="cb6-11"><a href="#cb6-11" aria-hidden="true" tabindex="-1"></a>                                 <span class="fu">paste0</span>(<span class="st">"dataone_metrics_cit_"</span>, <span class="fu">Sys.Date</span>(),<span class="st">".csv"</span>)))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
</div>
</section>
<section id="get-all-adc-dois-from-solr-query" class="level3">
<h3 class="anchored" data-anchor-id="get-all-adc-dois-from-solr-query">2. Get all ADC DOIs from SOLR query</h3>
<p>DataOne metrics API can only provide data package DOIs with citations, and can not provide a comprehensive list of all data package DOIs contained within the ADC. To search through all the repository metadata we query the DataONE search index (Apache SOLR search engine). SOLR is the same underlying mechanism that DataONE uses in the online tool and can create complex logical query conditions.</p>
<div class="cell" data-hash="index_cache/html/SOLR_query_f2cb75e567d6e03d040f1503e15691b5">
<details>
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb7"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb7-1"><a href="#cb7-1" aria-hidden="true" tabindex="-1"></a><span class="co"># complete list of searchable values</span></span>
<span id="cb7-2"><a href="#cb7-2" aria-hidden="true" tabindex="-1"></a><span class="co">#getQueryEngineDescription(cn, "solr")</span></span>
<span id="cb7-3"><a href="#cb7-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb7-4"><a href="#cb7-4" aria-hidden="true" tabindex="-1"></a><span class="co"># set coordinationg node</span></span>
<span id="cb7-5"><a href="#cb7-5" aria-hidden="true" tabindex="-1"></a>cn <span class="ot">&lt;-</span> dataone<span class="sc">::</span><span class="fu">CNode</span>(<span class="st">"PROD"</span>)</span>
<span id="cb7-6"><a href="#cb7-6" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb7-7"><a href="#cb7-7" aria-hidden="true" tabindex="-1"></a><span class="co"># point to specific member node</span></span>
<span id="cb7-8"><a href="#cb7-8" aria-hidden="true" tabindex="-1"></a>mn <span class="ot">&lt;-</span> dataone<span class="sc">::</span><span class="fu">getMNode</span>(cn, <span class="st">"urn:node:ARCTIC"</span>)</span>
<span id="cb7-9"><a href="#cb7-9" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb7-10"><a href="#cb7-10" aria-hidden="true" tabindex="-1"></a><span class="co"># set up Solr query parameters</span></span>
<span id="cb7-11"><a href="#cb7-11" aria-hidden="true" tabindex="-1"></a>queryParamList <span class="ot">&lt;-</span> <span class="fu">list</span>(<span class="at">q=</span><span class="st">"id:doi*"</span>, </span>
<span id="cb7-12"><a href="#cb7-12" aria-hidden="true" tabindex="-1"></a>                       <span class="at">fl=</span><span class="st">"id,title,dateUploaded,datasource"</span>,</span>
<span id="cb7-13"><a href="#cb7-13" aria-hidden="true" tabindex="-1"></a>                       <span class="at">start =</span><span class="st">"0"</span>,</span>
<span id="cb7-14"><a href="#cb7-14" aria-hidden="true" tabindex="-1"></a>                       <span class="at">rows =</span> <span class="st">"100000"</span>)</span>
<span id="cb7-15"><a href="#cb7-15" aria-hidden="true" tabindex="-1"></a><span class="co"># use `q = "identifier:doi* AND (*:* NOT obsoletedBy:*)"` to only include current versions of data packages </span></span>
<span id="cb7-16"><a href="#cb7-16" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb7-17"><a href="#cb7-17" aria-hidden="true" tabindex="-1"></a><span class="co"># send query to Solr, return results as dataframe</span></span>
<span id="cb7-18"><a href="#cb7-18" aria-hidden="true" tabindex="-1"></a>solr_adc_result <span class="ot">&lt;-</span> dataone<span class="sc">::</span><span class="fu">query</span>(mn, <span class="at">solrQuery=</span>queryParamList, <span class="at">as=</span><span class="st">"data.frame"</span>, <span class="at">parse=</span><span class="cn">FALSE</span>)</span>
<span id="cb7-19"><a href="#cb7-19" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb7-20"><a href="#cb7-20" aria-hidden="true" tabindex="-1"></a><span class="fu">write.csv</span>(solr_adc_result, <span class="fu">file.path</span>(output_directory, </span>
<span id="cb7-21"><a href="#cb7-21" aria-hidden="true" tabindex="-1"></a>                                     <span class="fu">paste0</span>(<span class="st">"solr_adc_"</span>, <span class="fu">Sys.Date</span>(), <span class="st">".csv"</span>)))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
</div>
</section>
<section id="run-all-adc-dataset-dois-through-scythe-libraries" class="level3">
<h3 class="anchored" data-anchor-id="run-all-adc-dataset-dois-through-scythe-libraries">3. Run all ADC dataset DOIs through <code>scythe</code> libraries</h3>
<div class="cell">
<details>
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb8"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb8-1"><a href="#cb8-1" aria-hidden="true" tabindex="-1"></a><span class="co"># create vector of all ADC DOIs from solr query `result`</span></span>
<span id="cb8-2"><a href="#cb8-2" aria-hidden="true" tabindex="-1"></a>adc_all_dois <span class="ot">&lt;-</span> <span class="fu">c</span>(solr_adc_result<span class="sc">$</span>id)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
</div>
<p>APIs can have request rate limits. These specific rates are often found in the API documentation or the API response headers. If request rate limits are exceeded, API queries will fail.</p>
<div class="cell">
<details>
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb9"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb9-1"><a href="#cb9-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Scopus request Limits</span></span>
<span id="cb9-2"><a href="#cb9-2" aria-hidden="true" tabindex="-1"></a>key_scopus <span class="ot">&lt;-</span> scythe<span class="sc">::</span><span class="fu">scythe_get_key</span>(<span class="st">"scopus"</span>)</span>
<span id="cb9-3"><a href="#cb9-3" aria-hidden="true" tabindex="-1"></a>url <span class="ot">&lt;-</span> <span class="fu">paste0</span>(<span class="st">"https://api.elsevier.com/content/search/scopus?query=ALL:"</span>,</span>
<span id="cb9-4"><a href="#cb9-4" aria-hidden="true" tabindex="-1"></a>  <span class="st">"10.18739/A2M32N95V"</span>,</span>
<span id="cb9-5"><a href="#cb9-5" aria-hidden="true" tabindex="-1"></a>  <span class="fu">paste</span>(<span class="st">"&amp;APIKey="</span>, key_scopus, <span class="at">sep =</span> <span class="st">""</span>))</span>
<span id="cb9-6"><a href="#cb9-6" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb9-7"><a href="#cb9-7" aria-hidden="true" tabindex="-1"></a><span class="fu">curlGetHeaders</span>(url)</span>
<span id="cb9-8"><a href="#cb9-8" aria-hidden="true" tabindex="-1"></a><span class="co"># [15:17] shows "X-RateLimit-Limit:", "X-RateLimit-Remaining:", and "X-RateLimit-Reset:" (Unix epoch is the number of seconds that have elapsed since January 1, 1970 at midnight UTC time minus the leap seconds)</span></span>
<span id="cb9-9"><a href="#cb9-9" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb9-10"><a href="#cb9-10" aria-hidden="true" tabindex="-1"></a><span class="co"># Springer request Limits</span></span>
<span id="cb9-11"><a href="#cb9-11" aria-hidden="true" tabindex="-1"></a><span class="co"># 300 calls/min and 5000/day</span></span>
<span id="cb9-12"><a href="#cb9-12" aria-hidden="true" tabindex="-1"></a><span class="co"># not found in response header, received email from springer that I was exceeding their rates above</span></span>
<span id="cb9-13"><a href="#cb9-13" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb9-14"><a href="#cb9-14" aria-hidden="true" tabindex="-1"></a><span class="co">#key_spring &lt;- scythe::scythe_get_key("springer")</span></span>
<span id="cb9-15"><a href="#cb9-15" aria-hidden="true" tabindex="-1"></a><span class="co">#url_spring &lt;- paste0("http://api.springernature.com/meta/v2/json?q=doi:10.1007/BF00627098&amp;api_key=", key_spring)</span></span>
<span id="cb9-16"><a href="#cb9-16" aria-hidden="true" tabindex="-1"></a><span class="co">#curlGetHeaders(url_spring)</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
</div>
<p>Run each library search in parallel in separate background jobs to keep console available to work with. By default the <code>job::job()</code> imports the global environment into the background job.</p>
<div class="callout-note callout callout-style-default callout-captioned">
<div class="callout-header d-flex align-content-center">
<div class="callout-icon-container">
<i class="callout-icon"></i>
</div>
<div class="callout-caption-container flex-fill">
Note
</div>
</div>
<div class="callout-body-container callout-body">
<p><code>scythe::scythe_set_key()</code> is a wrapper for the <code>key_ring</code> package. An interactive password prompt is required to access the API keys stored in <code>key_ring</code>. This <em>does not work</em> within a background job environment; your keyring needs to be temporarily unlocked with <code>keyring::keyring_unlock("scythe", "your password")</code> replace <code>password</code> with your actual keyring password.</p>
</div>
</div>
<div class="callout-warning callout callout-style-default callout-captioned">
<div class="callout-header d-flex align-content-center">
<div class="callout-icon-container">
<i class="callout-icon"></i>
</div>
<div class="callout-caption-container flex-fill">
Warning
</div>
</div>
<div class="callout-body-container callout-body">
<p>Be careful not to save, commit, or push your personal keyring password.</p>
</div>
</div>
<div class="cell">
<details>
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb10"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb10-1"><a href="#cb10-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Run each source/library search in a separate background job. Running a for loop will return incomplete results if API query fails, which is better than loosing all progress because of a single error in a single vector call.  </span></span>
<span id="cb10-2"><a href="#cb10-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb10-3"><a href="#cb10-3" aria-hidden="true" tabindex="-1"></a>key <span class="ot">&lt;-</span> <span class="st">"password"</span></span>
<span id="cb10-4"><a href="#cb10-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb10-5"><a href="#cb10-5" aria-hidden="true" tabindex="-1"></a><span class="co"># Set up empty results data.frames</span></span>
<span id="cb10-6"><a href="#cb10-6" aria-hidden="true" tabindex="-1"></a>citations_scopus <span class="ot">&lt;-</span> <span class="fu">data.frame</span>()</span>
<span id="cb10-7"><a href="#cb10-7" aria-hidden="true" tabindex="-1"></a>citations_springer <span class="ot">&lt;-</span> <span class="fu">data.frame</span>()</span>
<span id="cb10-8"><a href="#cb10-8" aria-hidden="true" tabindex="-1"></a>citations_plos <span class="ot">&lt;-</span> <span class="fu">data.frame</span>()</span>
<span id="cb10-9"><a href="#cb10-9" aria-hidden="true" tabindex="-1"></a>citations_xdd <span class="ot">&lt;-</span> <span class="fu">data.frame</span>()</span>
<span id="cb10-10"><a href="#cb10-10" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb10-11"><a href="#cb10-11" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb10-12"><a href="#cb10-12" aria-hidden="true" tabindex="-1"></a><span class="do">######### Scopus</span></span>
<span id="cb10-13"><a href="#cb10-13" aria-hidden="true" tabindex="-1"></a>job<span class="sc">::</span><span class="fu">job</span>({</span>
<span id="cb10-14"><a href="#cb10-14" aria-hidden="true" tabindex="-1"></a>  <span class="cf">for</span> (i <span class="cf">in</span> <span class="fu">seq_along</span>(adc_all_dois)) {</span>
<span id="cb10-15"><a href="#cb10-15" aria-hidden="true" tabindex="-1"></a>    <span class="co"># access API keys within background job environment</span></span>
<span id="cb10-16"><a href="#cb10-16" aria-hidden="true" tabindex="-1"></a>    keyring<span class="sc">::</span><span class="fu">keyring_unlock</span>(<span class="st">"scythe"</span>, key)</span>
<span id="cb10-17"><a href="#cb10-17" aria-hidden="true" tabindex="-1"></a>    <span class="co"># suppress errors and continue loop iteration</span></span>
<span id="cb10-18"><a href="#cb10-18" aria-hidden="true" tabindex="-1"></a>    result <span class="ot">&lt;-</span> <span class="fu">tryCatch</span>(citation <span class="ot">&lt;-</span> scythe<span class="sc">::</span><span class="fu">citation_search</span>(adc_all_dois[i], <span class="st">"scopus"</span>),</span>
<span id="cb10-19"><a href="#cb10-19" aria-hidden="true" tabindex="-1"></a>                       <span class="at">error =</span> <span class="cf">function</span>(err) {</span>
<span id="cb10-20"><a href="#cb10-20" aria-hidden="true" tabindex="-1"></a>                         <span class="fu">data.frame</span>(<span class="st">"article_id"</span> <span class="ot">=</span> <span class="cn">NA</span>,</span>
<span id="cb10-21"><a href="#cb10-21" aria-hidden="true" tabindex="-1"></a>                                    <span class="st">"article_title"</span> <span class="ot">=</span> <span class="cn">NA</span>,</span>
<span id="cb10-22"><a href="#cb10-22" aria-hidden="true" tabindex="-1"></a>                                    <span class="st">"dataset_id"</span> <span class="ot">=</span> adc_all_dois[i],</span>
<span id="cb10-23"><a href="#cb10-23" aria-hidden="true" tabindex="-1"></a>                                    <span class="st">"source"</span> <span class="ot">=</span> <span class="fu">paste0</span>(<span class="st">"scopus "</span>, <span class="fu">as.character</span>(err)))</span>
<span id="cb10-24"><a href="#cb10-24" aria-hidden="true" tabindex="-1"></a>                         }</span>
<span id="cb10-25"><a href="#cb10-25" aria-hidden="true" tabindex="-1"></a>                       )</span>
<span id="cb10-26"><a href="#cb10-26" aria-hidden="true" tabindex="-1"></a>    citations_scopus <span class="ot">&lt;-</span> <span class="fu">rbind</span>(citations_scopus, result)</span>
<span id="cb10-27"><a href="#cb10-27" aria-hidden="true" tabindex="-1"></a>  }</span>
<span id="cb10-28"><a href="#cb10-28" aria-hidden="true" tabindex="-1"></a>}, <span class="at">title =</span> <span class="fu">paste0</span>(<span class="st">"scopus citation search "</span>, <span class="fu">Sys.time</span>()))</span>
<span id="cb10-29"><a href="#cb10-29" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb10-30"><a href="#cb10-30" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb10-31"><a href="#cb10-31" aria-hidden="true" tabindex="-1"></a><span class="do">######### PLOS</span></span>
<span id="cb10-32"><a href="#cb10-32" aria-hidden="true" tabindex="-1"></a>job<span class="sc">::</span><span class="fu">job</span>({</span>
<span id="cb10-33"><a href="#cb10-33" aria-hidden="true" tabindex="-1"></a>  <span class="cf">for</span> (i <span class="cf">in</span> <span class="fu">seq_along</span>(adc_all_dois)) {</span>
<span id="cb10-34"><a href="#cb10-34" aria-hidden="true" tabindex="-1"></a>    <span class="co"># access API keys within background job environment</span></span>
<span id="cb10-35"><a href="#cb10-35" aria-hidden="true" tabindex="-1"></a>    keyring<span class="sc">::</span><span class="fu">keyring_unlock</span>(<span class="st">"scythe"</span>, key)</span>
<span id="cb10-36"><a href="#cb10-36" aria-hidden="true" tabindex="-1"></a>    <span class="co"># suppress errors and continue loop iteration</span></span>
<span id="cb10-37"><a href="#cb10-37" aria-hidden="true" tabindex="-1"></a>    result <span class="ot">&lt;-</span> <span class="fu">tryCatch</span>(citation <span class="ot">&lt;-</span> scythe<span class="sc">::</span><span class="fu">citation_search</span>(adc_all_dois[i], <span class="st">"plos"</span>),</span>
<span id="cb10-38"><a href="#cb10-38" aria-hidden="true" tabindex="-1"></a>                       <span class="at">error =</span> <span class="cf">function</span>(err) {</span>
<span id="cb10-39"><a href="#cb10-39" aria-hidden="true" tabindex="-1"></a>                         <span class="fu">data.frame</span>(<span class="st">"article_id"</span> <span class="ot">=</span> <span class="cn">NA</span>,</span>
<span id="cb10-40"><a href="#cb10-40" aria-hidden="true" tabindex="-1"></a>                                    <span class="st">"article_title"</span> <span class="ot">=</span> <span class="cn">NA</span>,</span>
<span id="cb10-41"><a href="#cb10-41" aria-hidden="true" tabindex="-1"></a>                                    <span class="st">"dataset_id"</span> <span class="ot">=</span> adc_all_dois[i],</span>
<span id="cb10-42"><a href="#cb10-42" aria-hidden="true" tabindex="-1"></a>                                    <span class="st">"source"</span> <span class="ot">=</span> <span class="fu">paste0</span>(<span class="st">"plos"</span>, <span class="fu">as.character</span>(err)))</span>
<span id="cb10-43"><a href="#cb10-43" aria-hidden="true" tabindex="-1"></a>                         }</span>
<span id="cb10-44"><a href="#cb10-44" aria-hidden="true" tabindex="-1"></a>                       )</span>
<span id="cb10-45"><a href="#cb10-45" aria-hidden="true" tabindex="-1"></a>    citations_plos <span class="ot">&lt;-</span> <span class="fu">rbind</span>(citations_plos, result)</span>
<span id="cb10-46"><a href="#cb10-46" aria-hidden="true" tabindex="-1"></a>    }</span>
<span id="cb10-47"><a href="#cb10-47" aria-hidden="true" tabindex="-1"></a>}, <span class="at">title =</span> <span class="fu">paste0</span>(<span class="st">"plos citation search "</span>, <span class="fu">Sys.time</span>()))</span>
<span id="cb10-48"><a href="#cb10-48" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb10-49"><a href="#cb10-49" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb10-50"><a href="#cb10-50" aria-hidden="true" tabindex="-1"></a><span class="do">########## XDD</span></span>
<span id="cb10-51"><a href="#cb10-51" aria-hidden="true" tabindex="-1"></a>job<span class="sc">::</span><span class="fu">job</span>({</span>
<span id="cb10-52"><a href="#cb10-52" aria-hidden="true" tabindex="-1"></a>  <span class="cf">for</span> (i <span class="cf">in</span> <span class="fu">seq_along</span>(adc_all_dois)) {</span>
<span id="cb10-53"><a href="#cb10-53" aria-hidden="true" tabindex="-1"></a>    <span class="co"># access API keys within background job environment</span></span>
<span id="cb10-54"><a href="#cb10-54" aria-hidden="true" tabindex="-1"></a>    keyring<span class="sc">::</span><span class="fu">keyring_unlock</span>(<span class="st">"scythe"</span>, key)</span>
<span id="cb10-55"><a href="#cb10-55" aria-hidden="true" tabindex="-1"></a>    <span class="co"># suppress errors and continue loop iteration</span></span>
<span id="cb10-56"><a href="#cb10-56" aria-hidden="true" tabindex="-1"></a>    result <span class="ot">&lt;-</span> <span class="fu">tryCatch</span>(citation <span class="ot">&lt;-</span> scythe<span class="sc">::</span><span class="fu">citation_search</span>(adc_all_dois[i], <span class="st">"xdd"</span>),</span>
<span id="cb10-57"><a href="#cb10-57" aria-hidden="true" tabindex="-1"></a>                       <span class="at">error =</span> <span class="cf">function</span>(err) {</span>
<span id="cb10-58"><a href="#cb10-58" aria-hidden="true" tabindex="-1"></a>                         <span class="fu">data.frame</span>(<span class="st">"article_id"</span> <span class="ot">=</span> <span class="cn">NA</span>,</span>
<span id="cb10-59"><a href="#cb10-59" aria-hidden="true" tabindex="-1"></a>                                    <span class="st">"article_title"</span> <span class="ot">=</span> <span class="cn">NA</span>,</span>
<span id="cb10-60"><a href="#cb10-60" aria-hidden="true" tabindex="-1"></a>                                    <span class="st">"dataset_id"</span> <span class="ot">=</span> adc_all_dois[i],</span>
<span id="cb10-61"><a href="#cb10-61" aria-hidden="true" tabindex="-1"></a>                                    <span class="st">"source"</span> <span class="ot">=</span> <span class="fu">paste0</span>(<span class="st">"xdd"</span>, <span class="fu">as.character</span>(err)))</span>
<span id="cb10-62"><a href="#cb10-62" aria-hidden="true" tabindex="-1"></a>                         }</span>
<span id="cb10-63"><a href="#cb10-63" aria-hidden="true" tabindex="-1"></a>                       )</span>
<span id="cb10-64"><a href="#cb10-64" aria-hidden="true" tabindex="-1"></a>    citations_xdd <span class="ot">&lt;-</span> <span class="fu">rbind</span>(citations_xdd, result)</span>
<span id="cb10-65"><a href="#cb10-65" aria-hidden="true" tabindex="-1"></a>    }</span>
<span id="cb10-66"><a href="#cb10-66" aria-hidden="true" tabindex="-1"></a>}, <span class="at">title =</span> <span class="fu">paste0</span>(<span class="st">"xdd citation search "</span>, <span class="fu">Sys.time</span>()))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
</div>
<p>Springers API query limits affected how we ran our search. We decided to break the list of ADC DOIs into &lt; 5,000 DOI chunks and run each chunk manually through the API with 24hrs in between the last query and starting the next DOI chunk. We could have changed the base <code>scythe</code> function <code>citation_search_springer()</code> to slow down to accommodate both request limits, but this would substantially slow down the function and make smaller DOIs queries slow and cumbersome.</p>
<div class="cell">
<details>
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb11"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb11-1"><a href="#cb11-1" aria-hidden="true" tabindex="-1"></a><span class="do">######### Springer</span></span>
<span id="cb11-2"><a href="#cb11-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb11-3"><a href="#cb11-3" aria-hidden="true" tabindex="-1"></a><span class="co"># divide ADC corpus into chunks less than Springer's 5,000/day request limit</span></span>
<span id="cb11-4"><a href="#cb11-4" aria-hidden="true" tabindex="-1"></a>springer_limit <span class="ot">&lt;-</span> <span class="dv">4995</span></span>
<span id="cb11-5"><a href="#cb11-5" aria-hidden="true" tabindex="-1"></a><span class="fu">length</span>(adc_all_dois) <span class="sc">/</span> springer_limit</span>
<span id="cb11-6"><a href="#cb11-6" aria-hidden="true" tabindex="-1"></a>chunk_1 <span class="ot">&lt;-</span> adc_all_dois[<span class="dv">1</span><span class="sc">:</span>springer_limit]</span>
<span id="cb11-7"><a href="#cb11-7" aria-hidden="true" tabindex="-1"></a>chunk_2 <span class="ot">&lt;-</span> adc_all_dois[springer_limit<span class="sc">:</span>(springer_limit<span class="sc">*</span><span class="dv">2</span>)]</span>
<span id="cb11-8"><a href="#cb11-8" aria-hidden="true" tabindex="-1"></a>chunk_3 <span class="ot">&lt;-</span> adc_all_dois[(springer_limit<span class="sc">*</span><span class="dv">2</span>)<span class="sc">:</span><span class="fu">length</span>(adc_all_dois)]</span>
<span id="cb11-9"><a href="#cb11-9" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb11-10"><a href="#cb11-10" aria-hidden="true" tabindex="-1"></a><span class="co"># change "chunk_x" object to search next chunk of DOIs. Must wait 24 hrs from last request. </span></span>
<span id="cb11-11"><a href="#cb11-11" aria-hidden="true" tabindex="-1"></a>doi_chunk <span class="ot">=</span> chunk_1</span>
<span id="cb11-12"><a href="#cb11-12" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb11-13"><a href="#cb11-13" aria-hidden="true" tabindex="-1"></a>job<span class="sc">::</span><span class="fu">job</span>({</span>
<span id="cb11-14"><a href="#cb11-14" aria-hidden="true" tabindex="-1"></a>  <span class="cf">for</span> (i <span class="cf">in</span> <span class="fu">seq_along</span>(doi_chunk)){ </span>
<span id="cb11-15"><a href="#cb11-15" aria-hidden="true" tabindex="-1"></a>    <span class="co"># access API keys within background job environment</span></span>
<span id="cb11-16"><a href="#cb11-16" aria-hidden="true" tabindex="-1"></a>    keyring<span class="sc">::</span><span class="fu">keyring_unlock</span>(<span class="st">"scythe"</span>, key)</span>
<span id="cb11-17"><a href="#cb11-17" aria-hidden="true" tabindex="-1"></a>    <span class="co"># suppress errors and continue loop iteration</span></span>
<span id="cb11-18"><a href="#cb11-18" aria-hidden="true" tabindex="-1"></a>    result <span class="ot">&lt;-</span> <span class="fu">tryCatch</span>(citation <span class="ot">&lt;-</span> scythe<span class="sc">::</span><span class="fu">citation_search</span>(doi_chunk[i], <span class="st">"springer"</span>),</span>
<span id="cb11-19"><a href="#cb11-19" aria-hidden="true" tabindex="-1"></a>                       <span class="at">error =</span> <span class="cf">function</span>(err) {</span>
<span id="cb11-20"><a href="#cb11-20" aria-hidden="true" tabindex="-1"></a>                         <span class="fu">data.frame</span>(<span class="st">"article_id"</span> <span class="ot">=</span> <span class="cn">NA</span>,</span>
<span id="cb11-21"><a href="#cb11-21" aria-hidden="true" tabindex="-1"></a>                                    <span class="st">"article_title"</span> <span class="ot">=</span> <span class="cn">NA</span>,</span>
<span id="cb11-22"><a href="#cb11-22" aria-hidden="true" tabindex="-1"></a>                                    <span class="st">"dataset_id"</span> <span class="ot">=</span> doi_chunk[i],</span>
<span id="cb11-23"><a href="#cb11-23" aria-hidden="true" tabindex="-1"></a>                                    <span class="st">"source"</span> <span class="ot">=</span> <span class="fu">paste0</span>(<span class="st">"springer "</span>, <span class="fu">as.character</span>(err)))</span>
<span id="cb11-24"><a href="#cb11-24" aria-hidden="true" tabindex="-1"></a>                         }</span>
<span id="cb11-25"><a href="#cb11-25" aria-hidden="true" tabindex="-1"></a>                       )</span>
<span id="cb11-26"><a href="#cb11-26" aria-hidden="true" tabindex="-1"></a>    citations_springer <span class="ot">&lt;-</span> <span class="fu">rbind</span>(citations_springer, result)</span>
<span id="cb11-27"><a href="#cb11-27" aria-hidden="true" tabindex="-1"></a>    }</span>
<span id="cb11-28"><a href="#cb11-28" aria-hidden="true" tabindex="-1"></a>}, <span class="at">title =</span> <span class="fu">paste0</span>(<span class="st">"springer citation search"</span>, <span class="fu">Sys.time</span>())</span>
<span id="cb11-29"><a href="#cb11-29" aria-hidden="true" tabindex="-1"></a>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
</div>
</section>
<section id="dealing-with-api-request-errors" class="level3">
<h3 class="anchored" data-anchor-id="dealing-with-api-request-errors">4. Dealing with API request errors</h3>
<p>The <code>tryCatch()</code> functions in the above search <code>for</code> loops records errors produced from any API request. The corresponding DOIs can be aggregated and rerun through <code>scythe</code>. The code below does this. When running the DOIs with HTTP errors through Scopus a second time we discovered a small bug in the <code>scythe</code> code which was subsequently fixed.</p>
<div class="cell">
<details>
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb12"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb12-1"><a href="#cb12-1" aria-hidden="true" tabindex="-1"></a>doi_error_scopus <span class="ot">&lt;-</span> citations_scopus[<span class="fu">is.na</span>(citations_scopus<span class="sc">$</span>article_id),<span class="st">"dataset_id"</span>]<span class="sc">$</span>dataset_id</span>
<span id="cb12-2"><a href="#cb12-2" aria-hidden="true" tabindex="-1"></a>doi_error_springer <span class="ot">&lt;-</span> citations_springer[<span class="fu">is.na</span>(citations_springer<span class="sc">$</span>article_id), <span class="st">"dataset_id"</span>]<span class="sc">$</span>dataset_id <span class="co"># no errors</span></span>
<span id="cb12-3"><a href="#cb12-3" aria-hidden="true" tabindex="-1"></a>doi_error_plos <span class="ot">&lt;-</span> citations_plos[<span class="fu">is.na</span>(citations_plos<span class="sc">$</span>article_id), <span class="st">"dataset_id"</span>]<span class="sc">$</span>dataset_id</span>
<span id="cb12-4"><a href="#cb12-4" aria-hidden="true" tabindex="-1"></a>doi_error_xdd <span class="ot">&lt;-</span> citations_xdd[<span class="fu">is.na</span>(citations_xdd<span class="sc">$</span>article_id), <span class="st">"dataset_id"</span>]<span class="sc">$</span>dataset_id <span class="co"># no errors</span></span>
<span id="cb12-5"><a href="#cb12-5" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb12-6"><a href="#cb12-6" aria-hidden="true" tabindex="-1"></a><span class="do">######### Scopus # this isn't working</span></span>
<span id="cb12-7"><a href="#cb12-7" aria-hidden="true" tabindex="-1"></a>citations_error_scopus <span class="ot">&lt;-</span> <span class="fu">data.frame</span>()</span>
<span id="cb12-8"><a href="#cb12-8" aria-hidden="true" tabindex="-1"></a>job<span class="sc">::</span><span class="fu">job</span>({</span>
<span id="cb12-9"><a href="#cb12-9" aria-hidden="true" tabindex="-1"></a>  <span class="cf">for</span> (i <span class="cf">in</span> <span class="fu">seq_along</span>(doi_error_scopus)) {</span>
<span id="cb12-10"><a href="#cb12-10" aria-hidden="true" tabindex="-1"></a>    <span class="co"># access API keys within background job environment</span></span>
<span id="cb12-11"><a href="#cb12-11" aria-hidden="true" tabindex="-1"></a>    keyring<span class="sc">::</span><span class="fu">keyring_unlock</span>(<span class="st">"scythe"</span>, key)</span>
<span id="cb12-12"><a href="#cb12-12" aria-hidden="true" tabindex="-1"></a>    <span class="co"># suppress errors and continue loop iteration</span></span>
<span id="cb12-13"><a href="#cb12-13" aria-hidden="true" tabindex="-1"></a>    result <span class="ot">&lt;-</span> <span class="fu">tryCatch</span>(citation <span class="ot">&lt;-</span> scythe<span class="sc">::</span><span class="fu">citation_search</span>(doi_error_scopus[i], <span class="st">"scopus"</span>),</span>
<span id="cb12-14"><a href="#cb12-14" aria-hidden="true" tabindex="-1"></a>                       <span class="at">error =</span> <span class="cf">function</span>(err) {</span>
<span id="cb12-15"><a href="#cb12-15" aria-hidden="true" tabindex="-1"></a>                         <span class="fu">data.frame</span>(<span class="st">"article_id"</span> <span class="ot">=</span> <span class="cn">NA</span>,</span>
<span id="cb12-16"><a href="#cb12-16" aria-hidden="true" tabindex="-1"></a>                                    <span class="st">"article_title"</span> <span class="ot">=</span> <span class="cn">NA</span>,</span>
<span id="cb12-17"><a href="#cb12-17" aria-hidden="true" tabindex="-1"></a>                                    <span class="st">"dataset_id"</span> <span class="ot">=</span> doi_error_scopus[i],</span>
<span id="cb12-18"><a href="#cb12-18" aria-hidden="true" tabindex="-1"></a>                                    <span class="st">"source"</span> <span class="ot">=</span> <span class="fu">paste0</span>(<span class="st">"scopus "</span>, <span class="fu">as.character</span>(err)))</span>
<span id="cb12-19"><a href="#cb12-19" aria-hidden="true" tabindex="-1"></a>                         }</span>
<span id="cb12-20"><a href="#cb12-20" aria-hidden="true" tabindex="-1"></a>                       )</span>
<span id="cb12-21"><a href="#cb12-21" aria-hidden="true" tabindex="-1"></a>    citations_error_scopus <span class="ot">&lt;-</span> <span class="fu">rbind</span>(citations_error_scopus, result)</span>
<span id="cb12-22"><a href="#cb12-22" aria-hidden="true" tabindex="-1"></a>  }</span>
<span id="cb12-23"><a href="#cb12-23" aria-hidden="true" tabindex="-1"></a>}, <span class="at">title =</span> <span class="fu">paste0</span>(<span class="st">"scopus error citation search "</span>, <span class="fu">Sys.time</span>()))</span>
<span id="cb12-24"><a href="#cb12-24" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb12-25"><a href="#cb12-25" aria-hidden="true" tabindex="-1"></a><span class="co"># save search results from errored DOI</span></span>
<span id="cb12-26"><a href="#cb12-26" aria-hidden="true" tabindex="-1"></a><span class="fu">write_csv</span>(citations_error_scopus, <span class="st">"./output/scythe_2022-07-14_scopus_error.csv"</span>)</span>
<span id="cb12-27"><a href="#cb12-27" aria-hidden="true" tabindex="-1"></a><span class="co"># add error citations results to main scopus results data.frame</span></span>
<span id="cb12-28"><a href="#cb12-28" aria-hidden="true" tabindex="-1"></a>citations_scopus <span class="ot">&lt;-</span> <span class="fu">rbind</span>(citations_scopus, citations_error_scopus)</span>
<span id="cb12-29"><a href="#cb12-29" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb12-30"><a href="#cb12-30" aria-hidden="true" tabindex="-1"></a><span class="do">######### PLOS</span></span>
<span id="cb12-31"><a href="#cb12-31" aria-hidden="true" tabindex="-1"></a>citations_error_plos <span class="ot">&lt;-</span> <span class="fu">data.frame</span>()</span>
<span id="cb12-32"><a href="#cb12-32" aria-hidden="true" tabindex="-1"></a>job<span class="sc">::</span><span class="fu">job</span>({</span>
<span id="cb12-33"><a href="#cb12-33" aria-hidden="true" tabindex="-1"></a>  <span class="cf">for</span> (i <span class="cf">in</span> <span class="fu">seq_along</span>(doi_error_plos)) {</span>
<span id="cb12-34"><a href="#cb12-34" aria-hidden="true" tabindex="-1"></a>    <span class="co"># access API keys within background job environment</span></span>
<span id="cb12-35"><a href="#cb12-35" aria-hidden="true" tabindex="-1"></a>    keyring<span class="sc">::</span><span class="fu">keyring_unlock</span>(<span class="st">"scythe"</span>, key)</span>
<span id="cb12-36"><a href="#cb12-36" aria-hidden="true" tabindex="-1"></a>    <span class="co"># suppress errors and continue loop iteration</span></span>
<span id="cb12-37"><a href="#cb12-37" aria-hidden="true" tabindex="-1"></a>    result <span class="ot">&lt;-</span> <span class="fu">tryCatch</span>(citation <span class="ot">&lt;-</span> scythe<span class="sc">::</span><span class="fu">citation_search</span>(doi_error_plos[i], <span class="st">"plos"</span>),</span>
<span id="cb12-38"><a href="#cb12-38" aria-hidden="true" tabindex="-1"></a>                       <span class="at">error =</span> <span class="cf">function</span>(err) {</span>
<span id="cb12-39"><a href="#cb12-39" aria-hidden="true" tabindex="-1"></a>                         <span class="fu">data.frame</span>(<span class="st">"article_id"</span> <span class="ot">=</span> <span class="cn">NA</span>,</span>
<span id="cb12-40"><a href="#cb12-40" aria-hidden="true" tabindex="-1"></a>                                    <span class="st">"article_title"</span> <span class="ot">=</span> <span class="cn">NA</span>,</span>
<span id="cb12-41"><a href="#cb12-41" aria-hidden="true" tabindex="-1"></a>                                    <span class="st">"dataset_id"</span> <span class="ot">=</span> doi_error_plos[i],</span>
<span id="cb12-42"><a href="#cb12-42" aria-hidden="true" tabindex="-1"></a>                                    <span class="st">"source"</span> <span class="ot">=</span> <span class="fu">paste0</span>(<span class="st">"plos"</span>, <span class="fu">as.character</span>(err)))</span>
<span id="cb12-43"><a href="#cb12-43" aria-hidden="true" tabindex="-1"></a>                         }</span>
<span id="cb12-44"><a href="#cb12-44" aria-hidden="true" tabindex="-1"></a>                       )</span>
<span id="cb12-45"><a href="#cb12-45" aria-hidden="true" tabindex="-1"></a>    citations_error_plos <span class="ot">&lt;-</span> <span class="fu">rbind</span>(citations_error_plos, result)</span>
<span id="cb12-46"><a href="#cb12-46" aria-hidden="true" tabindex="-1"></a>    }</span>
<span id="cb12-47"><a href="#cb12-47" aria-hidden="true" tabindex="-1"></a>}, <span class="at">title =</span> <span class="fu">paste0</span>(<span class="st">"plos error citation search "</span>, <span class="fu">Sys.time</span>()))</span>
<span id="cb12-48"><a href="#cb12-48" aria-hidden="true" tabindex="-1"></a><span class="co"># empty dataframe return means no citations found and no HTTP errors</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
</div>
<div class="cell">
<details>
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb13"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb13-1"><a href="#cb13-1" aria-hidden="true" tabindex="-1"></a><span class="do">## Save results as .csv's to project output folder</span></span>
<span id="cb13-2"><a href="#cb13-2" aria-hidden="true" tabindex="-1"></a>date <span class="ot">&lt;-</span> <span class="st">"2022-07-14"</span></span>
<span id="cb13-3"><a href="#cb13-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb13-4"><a href="#cb13-4" aria-hidden="true" tabindex="-1"></a><span class="fu">write.csv</span>(citations_scopus,</span>
<span id="cb13-5"><a href="#cb13-5" aria-hidden="true" tabindex="-1"></a>          <span class="fu">file.path</span>(output_directory, <span class="fu">paste0</span>(<span class="st">"scythe_"</span>, date, <span class="st">"_scopus_all.csv"</span>)),</span>
<span id="cb13-6"><a href="#cb13-6" aria-hidden="true" tabindex="-1"></a>          <span class="at">row.names =</span> F)</span>
<span id="cb13-7"><a href="#cb13-7" aria-hidden="true" tabindex="-1"></a><span class="fu">write.csv</span>(citations_springer,</span>
<span id="cb13-8"><a href="#cb13-8" aria-hidden="true" tabindex="-1"></a>          <span class="fu">file.path</span>(output_directory, <span class="fu">paste0</span>(<span class="st">"scythe_"</span>, date, <span class="st">"_springer_all.csv"</span>)),</span>
<span id="cb13-9"><a href="#cb13-9" aria-hidden="true" tabindex="-1"></a>          <span class="at">row.names =</span> F)</span>
<span id="cb13-10"><a href="#cb13-10" aria-hidden="true" tabindex="-1"></a><span class="fu">write.csv</span>(citations_plos,</span>
<span id="cb13-11"><a href="#cb13-11" aria-hidden="true" tabindex="-1"></a>          <span class="fu">file.path</span>(output_directory, <span class="fu">paste0</span>(<span class="st">"scythe_"</span>, date, <span class="st">"_plos_all.csv"</span>)),</span>
<span id="cb13-12"><a href="#cb13-12" aria-hidden="true" tabindex="-1"></a>          <span class="at">row.names =</span> F)</span>
<span id="cb13-13"><a href="#cb13-13" aria-hidden="true" tabindex="-1"></a><span class="fu">write.csv</span>(citations_xdd,</span>
<span id="cb13-14"><a href="#cb13-14" aria-hidden="true" tabindex="-1"></a>          <span class="fu">file.path</span>(output_directory, <span class="fu">paste0</span>(<span class="st">"scythe_"</span>, date, <span class="st">"_xdd_all.csv"</span>)),</span>
<span id="cb13-15"><a href="#cb13-15" aria-hidden="true" tabindex="-1"></a>          <span class="at">row.names =</span> F)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
</div>
</section>
<section id="calculate-citation-source-overlap" class="level3">
<h3 class="anchored" data-anchor-id="calculate-citation-source-overlap">5. Calculate citation source overlap</h3>
<p>We evaluated the redundancy in citations found among sources by matching citations between source search results. A citation is defined by the unique combination of <code>article_id</code> and <code>dataset_id</code>. Percent overlap is the percent of total citations found in a source also found in a second source.</p>
<div class="cell">
<details>
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb14"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb14-1"><a href="#cb14-1" aria-hidden="true" tabindex="-1"></a>scythe_cit <span class="ot">&lt;-</span></span>
<span id="cb14-2"><a href="#cb14-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">rbind</span>(citations_scopus,</span>
<span id="cb14-3"><a href="#cb14-3" aria-hidden="true" tabindex="-1"></a>        citations_springer,</span>
<span id="cb14-4"><a href="#cb14-4" aria-hidden="true" tabindex="-1"></a>        citations_plos,</span>
<span id="cb14-5"><a href="#cb14-5" aria-hidden="true" tabindex="-1"></a>        citations_xdd) <span class="sc">%&gt;%</span></span>
<span id="cb14-6"><a href="#cb14-6" aria-hidden="true" tabindex="-1"></a>  <span class="fu">filter</span>(<span class="sc">!</span><span class="fu">is.na</span>(article_id)) <span class="co"># remove NA/error observations</span></span>
<span id="cb14-7"><a href="#cb14-7" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb14-8"><a href="#cb14-8" aria-hidden="true" tabindex="-1"></a><span class="fu">write_csv</span>(scythe_cit, <span class="fu">file.path</span>(output_directory, <span class="fu">paste0</span>(<span class="st">"scythe_"</span>, date, <span class="st">"_citations_all.csv"</span>)))</span>
<span id="cb14-9"><a href="#cb14-9" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb14-10"><a href="#cb14-10" aria-hidden="true" tabindex="-1"></a>scythe_sum <span class="ot">&lt;-</span> scythe_cit <span class="sc">%&gt;%</span></span>
<span id="cb14-11"><a href="#cb14-11" aria-hidden="true" tabindex="-1"></a>  <span class="fu">group_by</span>(source) <span class="sc">%&gt;%</span></span>
<span id="cb14-12"><a href="#cb14-12" aria-hidden="true" tabindex="-1"></a>  <span class="fu">summarise</span>(<span class="st">"total_citations_found"</span> <span class="ot">=</span> <span class="fu">n</span>())</span>
<span id="cb14-13"><a href="#cb14-13" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb14-14"><a href="#cb14-14" aria-hidden="true" tabindex="-1"></a><span class="co"># match article_id and dataset_id columns among results</span></span>
<span id="cb14-15"><a href="#cb14-15" aria-hidden="true" tabindex="-1"></a>overlap_plos_scopus <span class="ot">&lt;-</span></span>
<span id="cb14-16"><a href="#cb14-16" aria-hidden="true" tabindex="-1"></a>  <span class="fu">inner_join</span>(citations_plos,</span>
<span id="cb14-17"><a href="#cb14-17" aria-hidden="true" tabindex="-1"></a>             citations_scopus,</span>
<span id="cb14-18"><a href="#cb14-18" aria-hidden="true" tabindex="-1"></a>             <span class="at">by =</span> <span class="fu">c</span>(<span class="st">"article_id"</span>, <span class="st">"dataset_id"</span>))</span>
<span id="cb14-19"><a href="#cb14-19" aria-hidden="true" tabindex="-1"></a>overlap_plos_springer <span class="ot">&lt;-</span></span>
<span id="cb14-20"><a href="#cb14-20" aria-hidden="true" tabindex="-1"></a>  <span class="fu">inner_join</span>(citations_plos,</span>
<span id="cb14-21"><a href="#cb14-21" aria-hidden="true" tabindex="-1"></a>             citations_springer,</span>
<span id="cb14-22"><a href="#cb14-22" aria-hidden="true" tabindex="-1"></a>             <span class="at">by =</span> <span class="fu">c</span>(<span class="st">"article_id"</span>, <span class="st">"dataset_id"</span>))</span>
<span id="cb14-23"><a href="#cb14-23" aria-hidden="true" tabindex="-1"></a>overlap_plos_xdd <span class="ot">&lt;-</span></span>
<span id="cb14-24"><a href="#cb14-24" aria-hidden="true" tabindex="-1"></a>  <span class="fu">inner_join</span>(citations_plos,</span>
<span id="cb14-25"><a href="#cb14-25" aria-hidden="true" tabindex="-1"></a>             citations_xdd,</span>
<span id="cb14-26"><a href="#cb14-26" aria-hidden="true" tabindex="-1"></a>             <span class="at">by =</span> <span class="fu">c</span>(<span class="st">"article_id"</span>, <span class="st">"dataset_id"</span>))</span>
<span id="cb14-27"><a href="#cb14-27" aria-hidden="true" tabindex="-1"></a>overlap_scopus_springer <span class="ot">&lt;-</span></span>
<span id="cb14-28"><a href="#cb14-28" aria-hidden="true" tabindex="-1"></a>  <span class="fu">inner_join</span>(citations_scopus,</span>
<span id="cb14-29"><a href="#cb14-29" aria-hidden="true" tabindex="-1"></a>             citations_springer,</span>
<span id="cb14-30"><a href="#cb14-30" aria-hidden="true" tabindex="-1"></a>             <span class="at">by =</span> <span class="fu">c</span>(<span class="st">"article_id"</span>, <span class="st">"dataset_id"</span>))</span>
<span id="cb14-31"><a href="#cb14-31" aria-hidden="true" tabindex="-1"></a>overlap_scopus_xdd <span class="ot">&lt;-</span></span>
<span id="cb14-32"><a href="#cb14-32" aria-hidden="true" tabindex="-1"></a>  <span class="fu">inner_join</span>(citations_scopus,</span>
<span id="cb14-33"><a href="#cb14-33" aria-hidden="true" tabindex="-1"></a>             citations_xdd,</span>
<span id="cb14-34"><a href="#cb14-34" aria-hidden="true" tabindex="-1"></a>             <span class="at">by =</span> <span class="fu">c</span>(<span class="st">"article_id"</span>, <span class="st">"dataset_id"</span>))</span>
<span id="cb14-35"><a href="#cb14-35" aria-hidden="true" tabindex="-1"></a>overlap_springer_xdd <span class="ot">&lt;-</span></span>
<span id="cb14-36"><a href="#cb14-36" aria-hidden="true" tabindex="-1"></a>  <span class="fu">inner_join</span>(citations_springer,</span>
<span id="cb14-37"><a href="#cb14-37" aria-hidden="true" tabindex="-1"></a>             citations_xdd,</span>
<span id="cb14-38"><a href="#cb14-38" aria-hidden="true" tabindex="-1"></a>             <span class="at">by =</span> <span class="fu">c</span>(<span class="st">"article_id"</span>, <span class="st">"dataset_id"</span>))</span>
<span id="cb14-39"><a href="#cb14-39" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb14-40"><a href="#cb14-40" aria-hidden="true" tabindex="-1"></a><span class="co"># function to calculate percent of source citations also found in a second source</span></span>
<span id="cb14-41"><a href="#cb14-41" aria-hidden="true" tabindex="-1"></a>calc_prct_overlap <span class="ot">&lt;-</span> <span class="cf">function</span>(source_1, source_2) {</span>
<span id="cb14-42"><a href="#cb14-42" aria-hidden="true" tabindex="-1"></a>  pairs <span class="ot">&lt;-</span></span>
<span id="cb14-43"><a href="#cb14-43" aria-hidden="true" tabindex="-1"></a>    <span class="fu">inner_join</span>(source_1, source_2, <span class="at">by =</span> <span class="fu">c</span>(<span class="st">"article_id"</span>, <span class="st">"dataset_id"</span>))</span>
<span id="cb14-44"><a href="#cb14-44" aria-hidden="true" tabindex="-1"></a>  overlap <span class="ot">&lt;-</span></span>
<span id="cb14-45"><a href="#cb14-45" aria-hidden="true" tabindex="-1"></a>    <span class="fu">nrow</span>(pairs) <span class="sc">/</span> <span class="fu">nrow</span>(source_1) <span class="co"># percent of source_1 total also found in source_2 (pairs)</span></span>
<span id="cb14-46"><a href="#cb14-46" aria-hidden="true" tabindex="-1"></a>  <span class="fu">return</span>(overlap)</span>
<span id="cb14-47"><a href="#cb14-47" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb14-48"><a href="#cb14-48" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb14-49"><a href="#cb14-49" aria-hidden="true" tabindex="-1"></a>scythe_overlap_sum <span class="ot">&lt;-</span> scythe_cit <span class="sc">%&gt;%</span></span>
<span id="cb14-50"><a href="#cb14-50" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="st">"citation_df"</span> <span class="ot">=</span> <span class="fu">ifelse</span>(</span>
<span id="cb14-51"><a href="#cb14-51" aria-hidden="true" tabindex="-1"></a>    source <span class="sc">==</span> <span class="st">"plos"</span>,</span>
<span id="cb14-52"><a href="#cb14-52" aria-hidden="true" tabindex="-1"></a>    <span class="st">"citations_plos"</span>,</span>
<span id="cb14-53"><a href="#cb14-53" aria-hidden="true" tabindex="-1"></a>    <span class="fu">ifelse</span>(</span>
<span id="cb14-54"><a href="#cb14-54" aria-hidden="true" tabindex="-1"></a>      source <span class="sc">==</span> <span class="st">"scopus"</span>,</span>
<span id="cb14-55"><a href="#cb14-55" aria-hidden="true" tabindex="-1"></a>      <span class="st">"citations_scopus"</span>,</span>
<span id="cb14-56"><a href="#cb14-56" aria-hidden="true" tabindex="-1"></a>      <span class="fu">ifelse</span>(source <span class="sc">==</span> <span class="st">"springer"</span>, <span class="st">"citations_springer"</span>, <span class="st">"citations_xdd"</span>)</span>
<span id="cb14-57"><a href="#cb14-57" aria-hidden="true" tabindex="-1"></a>    )</span>
<span id="cb14-58"><a href="#cb14-58" aria-hidden="true" tabindex="-1"></a>  )) <span class="sc">%&gt;%</span></span>
<span id="cb14-59"><a href="#cb14-59" aria-hidden="true" tabindex="-1"></a>  <span class="fu">group_by</span>(source, citation_df) <span class="sc">%&gt;%</span></span>
<span id="cb14-60"><a href="#cb14-60" aria-hidden="true" tabindex="-1"></a>  <span class="fu">summarise</span>(</span>
<span id="cb14-61"><a href="#cb14-61" aria-hidden="true" tabindex="-1"></a>    <span class="st">"total_citations"</span> <span class="ot">=</span> <span class="fu">n</span>(),</span>
<span id="cb14-62"><a href="#cb14-62" aria-hidden="true" tabindex="-1"></a>    <span class="st">"prct_in_plos"</span> <span class="ot">=</span> <span class="fu">calc_prct_overlap</span>(<span class="fu">eval</span>(<span class="fu">parse</span>(<span class="at">text =</span> citation_df)), </span>
<span id="cb14-63"><a href="#cb14-63" aria-hidden="true" tabindex="-1"></a>                                              citations_plos),</span>
<span id="cb14-64"><a href="#cb14-64" aria-hidden="true" tabindex="-1"></a>    <span class="st">"prct_in_scopus"</span> <span class="ot">=</span> <span class="fu">calc_prct_overlap</span>(<span class="fu">eval</span>(<span class="fu">parse</span>(<span class="at">text =</span> citation_df)), </span>
<span id="cb14-65"><a href="#cb14-65" aria-hidden="true" tabindex="-1"></a>                                                citations_scopus),</span>
<span id="cb14-66"><a href="#cb14-66" aria-hidden="true" tabindex="-1"></a>    <span class="st">"prct_in_springer"</span> <span class="ot">=</span> <span class="fu">calc_prct_overlap</span>(<span class="fu">eval</span>(<span class="fu">parse</span>(<span class="at">text =</span> citation_df)), </span>
<span id="cb14-67"><a href="#cb14-67" aria-hidden="true" tabindex="-1"></a>                                                  citations_springer),</span>
<span id="cb14-68"><a href="#cb14-68" aria-hidden="true" tabindex="-1"></a>    <span class="st">"prct_in_xdd"</span> <span class="ot">=</span> <span class="fu">calc_prct_overlap</span>(<span class="fu">eval</span>(<span class="fu">parse</span>(<span class="at">text =</span> citation_df)), </span>
<span id="cb14-69"><a href="#cb14-69" aria-hidden="true" tabindex="-1"></a>                                             citations_xdd)</span>
<span id="cb14-70"><a href="#cb14-70" aria-hidden="true" tabindex="-1"></a>  ) <span class="sc">%&gt;%</span></span>
<span id="cb14-71"><a href="#cb14-71" aria-hidden="true" tabindex="-1"></a>  <span class="fu">select</span>(<span class="dv">1</span>, <span class="dv">3</span><span class="sc">:</span><span class="dv">7</span>)</span>
<span id="cb14-72"><a href="#cb14-72" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb14-73"><a href="#cb14-73" aria-hidden="true" tabindex="-1"></a><span class="co"># Save summary table to output folder</span></span>
<span id="cb14-74"><a href="#cb14-74" aria-hidden="true" tabindex="-1"></a><span class="fu">write.csv</span>(scythe_overlap_sum,</span>
<span id="cb14-75"><a href="#cb14-75" aria-hidden="true" tabindex="-1"></a>          <span class="fu">file.path</span>(</span>
<span id="cb14-76"><a href="#cb14-76" aria-hidden="true" tabindex="-1"></a>            output_directory,</span>
<span id="cb14-77"><a href="#cb14-77" aria-hidden="true" tabindex="-1"></a>            <span class="fu">paste0</span>(<span class="st">"scythe_"</span>, date, <span class="st">"_prct_overlap.csv"</span>)</span>
<span id="cb14-78"><a href="#cb14-78" aria-hidden="true" tabindex="-1"></a>          ),</span>
<span id="cb14-79"><a href="#cb14-79" aria-hidden="true" tabindex="-1"></a>          <span class="at">row.names =</span> F)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
</div>
</section>
<section id="how-many-completely-unique-citations-found-in-each-source" class="level3">
<h3 class="anchored" data-anchor-id="how-many-completely-unique-citations-found-in-each-source">6. How many completely unique citations found in each source?</h3>
<div class="cell">
<details>
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb15"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb15-1"><a href="#cb15-1" aria-hidden="true" tabindex="-1"></a>citations_plos <span class="ot">&lt;-</span> readr<span class="sc">::</span><span class="fu">read_csv</span>(<span class="fu">file.path</span>(output_directory, <span class="st">"scythe_2022-07-14_plos.csv"</span>))</span>
<span id="cb15-2"><a href="#cb15-2" aria-hidden="true" tabindex="-1"></a>citations_scopus <span class="ot">&lt;-</span> readr<span class="sc">::</span><span class="fu">read_csv</span>(<span class="fu">file.path</span>(output_directory, <span class="st">"scythe_2022-07-14_scopus.csv"</span>))</span>
<span id="cb15-3"><a href="#cb15-3" aria-hidden="true" tabindex="-1"></a>citations_springer <span class="ot">&lt;-</span> readr<span class="sc">::</span><span class="fu">read_csv</span>(<span class="fu">file.path</span>(output_directory, <span class="st">"scythe_2022-07-14_springer.csv"</span>))</span>
<span id="cb15-4"><a href="#cb15-4" aria-hidden="true" tabindex="-1"></a>citations_xdd <span class="ot">&lt;-</span> readr<span class="sc">::</span><span class="fu">read_csv</span>(<span class="fu">file.path</span>(output_directory, <span class="st">"scythe_2022-07-14_xdd.csv"</span>))</span>
<span id="cb15-5"><a href="#cb15-5" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb15-6"><a href="#cb15-6" aria-hidden="true" tabindex="-1"></a>unique_plos <span class="ot">&lt;-</span> citations_plos <span class="sc">%&gt;%</span> </span>
<span id="cb15-7"><a href="#cb15-7" aria-hidden="true" tabindex="-1"></a>  <span class="fu">anti_join</span>(citations_scopus, <span class="at">by =</span> <span class="fu">c</span>(<span class="st">"article_id"</span>, <span class="st">"dataset_id"</span>)) <span class="sc">%&gt;%</span> </span>
<span id="cb15-8"><a href="#cb15-8" aria-hidden="true" tabindex="-1"></a>  <span class="fu">anti_join</span>(citations_springer, <span class="at">by =</span> <span class="fu">c</span>(<span class="st">"article_id"</span>, <span class="st">"dataset_id"</span>)) <span class="sc">%&gt;%</span> </span>
<span id="cb15-9"><a href="#cb15-9" aria-hidden="true" tabindex="-1"></a>  <span class="fu">anti_join</span>(citations_xdd, <span class="at">by =</span> <span class="fu">c</span>(<span class="st">"article_id"</span>, <span class="st">"dataset_id"</span>)) <span class="sc">%&gt;%</span> </span>
<span id="cb15-10"><a href="#cb15-10" aria-hidden="true" tabindex="-1"></a>  <span class="fu">filter</span>(<span class="sc">!</span><span class="fu">is.na</span>(article_id))</span>
<span id="cb15-11"><a href="#cb15-11" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb15-12"><a href="#cb15-12" aria-hidden="true" tabindex="-1"></a>unique_scopus <span class="ot">&lt;-</span> citations_scopus <span class="sc">%&gt;%</span> </span>
<span id="cb15-13"><a href="#cb15-13" aria-hidden="true" tabindex="-1"></a>  <span class="fu">anti_join</span>(citations_plos, <span class="at">by =</span> <span class="fu">c</span>(<span class="st">"article_id"</span>, <span class="st">"dataset_id"</span>)) <span class="sc">%&gt;%</span> </span>
<span id="cb15-14"><a href="#cb15-14" aria-hidden="true" tabindex="-1"></a>  <span class="fu">anti_join</span>(citations_springer, <span class="at">by =</span> <span class="fu">c</span>(<span class="st">"article_id"</span>, <span class="st">"dataset_id"</span>)) <span class="sc">%&gt;%</span> </span>
<span id="cb15-15"><a href="#cb15-15" aria-hidden="true" tabindex="-1"></a>  <span class="fu">anti_join</span>(citations_xdd, <span class="at">by =</span> <span class="fu">c</span>(<span class="st">"article_id"</span>, <span class="st">"dataset_id"</span>)) <span class="sc">%&gt;%</span> </span>
<span id="cb15-16"><a href="#cb15-16" aria-hidden="true" tabindex="-1"></a>  <span class="fu">filter</span>(<span class="sc">!</span><span class="fu">is.na</span>(article_id))</span>
<span id="cb15-17"><a href="#cb15-17" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb15-18"><a href="#cb15-18" aria-hidden="true" tabindex="-1"></a>unique_springer <span class="ot">&lt;-</span> citations_springer <span class="sc">%&gt;%</span> </span>
<span id="cb15-19"><a href="#cb15-19" aria-hidden="true" tabindex="-1"></a>  <span class="fu">anti_join</span>(citations_plos, <span class="at">by =</span> <span class="fu">c</span>(<span class="st">"article_id"</span>, <span class="st">"dataset_id"</span>)) <span class="sc">%&gt;%</span> </span>
<span id="cb15-20"><a href="#cb15-20" aria-hidden="true" tabindex="-1"></a>  <span class="fu">anti_join</span>(citations_scopus, <span class="at">by =</span> <span class="fu">c</span>(<span class="st">"article_id"</span>, <span class="st">"dataset_id"</span>)) <span class="sc">%&gt;%</span> </span>
<span id="cb15-21"><a href="#cb15-21" aria-hidden="true" tabindex="-1"></a>  <span class="fu">anti_join</span>(citations_xdd, <span class="at">by =</span> <span class="fu">c</span>(<span class="st">"article_id"</span>, <span class="st">"dataset_id"</span>)) <span class="sc">%&gt;%</span> </span>
<span id="cb15-22"><a href="#cb15-22" aria-hidden="true" tabindex="-1"></a>  <span class="fu">filter</span>(<span class="sc">!</span><span class="fu">is.na</span>(article_id))</span>
<span id="cb15-23"><a href="#cb15-23" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb15-24"><a href="#cb15-24" aria-hidden="true" tabindex="-1"></a>unique_xdd <span class="ot">&lt;-</span> citations_xdd <span class="sc">%&gt;%</span> </span>
<span id="cb15-25"><a href="#cb15-25" aria-hidden="true" tabindex="-1"></a>  <span class="fu">anti_join</span>(citations_plos, <span class="at">by =</span> <span class="fu">c</span>(<span class="st">"article_id"</span>, <span class="st">"dataset_id"</span>)) <span class="sc">%&gt;%</span> </span>
<span id="cb15-26"><a href="#cb15-26" aria-hidden="true" tabindex="-1"></a>  <span class="fu">anti_join</span>(citations_scopus, <span class="at">by =</span> <span class="fu">c</span>(<span class="st">"article_id"</span>, <span class="st">"dataset_id"</span>)) <span class="sc">%&gt;%</span> </span>
<span id="cb15-27"><a href="#cb15-27" aria-hidden="true" tabindex="-1"></a>  <span class="fu">anti_join</span>(citations_springer, <span class="at">by =</span> <span class="fu">c</span>(<span class="st">"article_id"</span>, <span class="st">"dataset_id"</span>)) <span class="sc">%&gt;%</span> </span>
<span id="cb15-28"><a href="#cb15-28" aria-hidden="true" tabindex="-1"></a>  <span class="fu">filter</span>(<span class="sc">!</span><span class="fu">is.na</span>(article_id))</span>
<span id="cb15-29"><a href="#cb15-29" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb15-30"><a href="#cb15-30" aria-hidden="true" tabindex="-1"></a><span class="co"># combine unique citation tables</span></span>
<span id="cb15-31"><a href="#cb15-31" aria-hidden="true" tabindex="-1"></a>unique_citations <span class="ot">&lt;-</span> <span class="fu">rbind</span>(unique_plos, unique_scopus, unique_springer, unique_xdd)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
</div>
</section>
<section id="compare-scythe-results-to-dataone-metrics-citations" class="level3">
<h3 class="anchored" data-anchor-id="compare-scythe-results-to-dataone-metrics-citations">7. Compare <code>scythe</code> results to DataOne Metrics citations</h3>
<p><code>dataone_met_cit</code> came from the SOLR query, it has 626 observations. <code>dataone_cit_source</code> came from Rushiraj with 2035 observations. I am still confused on the back end set up of how these citations are truely being generated. <code>dataone_cit_source</code> has the record of how citations entered the DataOne Metrics Service: <code>Crossref</code>, <code>Metrics Service Ingest</code>, and ORCID. I believe <code>Metrics Service Ingest</code> is previous <code>scythe</code> runs. Nonetheless, I can cross compare the <code>scythe</code> citation results with both DataONe metrics citation lists and look at the distribution of citation sources.</p>
<div class="cell">
<details>
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb16"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb16-1"><a href="#cb16-1" aria-hidden="true" tabindex="-1"></a>dataone_met_cit <span class="ot">&lt;-</span> readr<span class="sc">::</span><span class="fu">read_csv</span>(<span class="fu">file.path</span>(output_directory, <span class="st">"dataone_metrics_cit_2022-07-08.csv"</span>))</span>
<span id="cb16-2"><a href="#cb16-2" aria-hidden="true" tabindex="-1"></a>scythe_cit <span class="ot">&lt;-</span> readr<span class="sc">::</span><span class="fu">read_csv</span>(<span class="fu">file.path</span>(output_directory, <span class="st">"scythe_2022-07-14_citations_all.csv"</span>))</span>
<span id="cb16-3"><a href="#cb16-3" aria-hidden="true" tabindex="-1"></a>dataone_cit_source <span class="ot">&lt;-</span> readr<span class="sc">::</span><span class="fu">read_csv</span>(<span class="fu">file.path</span>(<span class="st">"data/dataone_citations_reporter.csv"</span>))</span>
<span id="cb16-4"><a href="#cb16-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb16-5"><a href="#cb16-5" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb16-6"><a href="#cb16-6" aria-hidden="true" tabindex="-1"></a><span class="co"># source_id = 'Unique identifier to the source dataset / document / article that cited the target dataset '</span></span>
<span id="cb16-7"><a href="#cb16-7" aria-hidden="true" tabindex="-1"></a><span class="co"># target_id = 'Unique identifier to the target DATAONE dataset. This is the dataset that was cited.'</span></span>
<span id="cb16-8"><a href="#cb16-8" aria-hidden="true" tabindex="-1"></a>dataone_met_cit <span class="ot">&lt;-</span> dataone_met_cit <span class="sc">%&gt;%</span> </span>
<span id="cb16-9"><a href="#cb16-9" aria-hidden="true" tabindex="-1"></a>  <span class="fu">rename</span>(<span class="st">"article_id"</span> <span class="ot">=</span> source_id, <span class="co"># rename dataone metrics citations columns to match scythe results</span></span>
<span id="cb16-10"><a href="#cb16-10" aria-hidden="true" tabindex="-1"></a>         <span class="st">"dataset_id"</span> <span class="ot">=</span> target_id) <span class="sc">%&gt;%</span> </span>
<span id="cb16-11"><a href="#cb16-11" aria-hidden="true" tabindex="-1"></a>  <span class="fu">select</span>(article_id, dataset_id)</span>
<span id="cb16-12"><a href="#cb16-12" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb16-13"><a href="#cb16-13" aria-hidden="true" tabindex="-1"></a><span class="co"># only show citations found by scythe that do not already appear in the DataOne Metrics service</span></span>
<span id="cb16-14"><a href="#cb16-14" aria-hidden="true" tabindex="-1"></a>scythe_cit_new1 <span class="ot">&lt;-</span> <span class="fu">anti_join</span>(scythe_cit, dataone_met_cit, <span class="at">by =</span> <span class="fu">c</span>(<span class="st">"article_id"</span>, <span class="st">"dataset_id"</span>)) <span class="sc">%&gt;%</span> </span>
<span id="cb16-15"><a href="#cb16-15" aria-hidden="true" tabindex="-1"></a>  <span class="fu">na.omit</span>()</span>
<span id="cb16-16"><a href="#cb16-16" aria-hidden="true" tabindex="-1"></a><span class="co"># 897 new scythe citations </span></span>
<span id="cb16-17"><a href="#cb16-17" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb16-18"><a href="#cb16-18" aria-hidden="true" tabindex="-1"></a><span class="co"># scythe::write_citation_pairs(scythe_citations_new, </span></span>
<span id="cb16-19"><a href="#cb16-19" aria-hidden="true" tabindex="-1"></a><span class="co">#                              path = paste0("./output/scythe_", date,"_citation_pairs.json"))</span></span>
<span id="cb16-20"><a href="#cb16-20" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb16-21"><a href="#cb16-21" aria-hidden="true" tabindex="-1"></a><span class="co"># clean up dataone citation reporter csv. Remove extra ' from character strings</span></span>
<span id="cb16-22"><a href="#cb16-22" aria-hidden="true" tabindex="-1"></a>dataone_cit_source <span class="ot">&lt;-</span> <span class="fu">as.data.frame</span>(<span class="fu">lapply</span>(dataone_cit_source, gsub, <span class="at">pattern =</span> <span class="st">"*'*"</span>, <span class="at">replacement =</span> <span class="st">""</span>))</span>
<span id="cb16-23"><a href="#cb16-23" aria-hidden="true" tabindex="-1"></a>dataone_cit_source <span class="sc">%&lt;&gt;%</span></span>
<span id="cb16-24"><a href="#cb16-24" aria-hidden="true" tabindex="-1"></a>  <span class="fu">rename</span>(<span class="st">"article_id"</span> <span class="ot">=</span> source_id, <span class="co"># rename dataone metrics citations columns to match scythe results</span></span>
<span id="cb16-25"><a href="#cb16-25" aria-hidden="true" tabindex="-1"></a>         <span class="st">"dataset_id"</span> <span class="ot">=</span> target_id)</span>
<span id="cb16-26"><a href="#cb16-26" aria-hidden="true" tabindex="-1"></a>scythe_cit_new2 <span class="ot">&lt;-</span> <span class="fu">anti_join</span>(scythe_cit, dataone_cit_source, <span class="at">by =</span> <span class="fu">c</span>(<span class="st">"article_id"</span>, <span class="st">"dataset_id"</span>)) <span class="sc">%&gt;%</span> </span>
<span id="cb16-27"><a href="#cb16-27" aria-hidden="true" tabindex="-1"></a>  <span class="fu">na.omit</span>()</span>
<span id="cb16-28"><a href="#cb16-28" aria-hidden="true" tabindex="-1"></a><span class="co"># have 886 new scythe citations not found in dataone metrics</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
</div>
</section>
</section>
<section id="results" class="level2">
<h2 class="anchored" data-anchor-id="results">Results</h2>
<ol type="1">
<li><p>Does the addition of the xDD digital library to the Scythe package improve the quality and scope of citations in the ADC?</p>
<ul>
<li>How many unique citations were found in xDD and not in any of the other sources?</li>
</ul></li>
</ol>
<div class="cell">
<div class="cell-output-display">
<div id="tbl-unique" class="anchored">
<table class="table table-sm table-striped">
<caption>Table&nbsp;1: Number of citations only found within each source</caption>
<thead>
<tr class="header">
<th style="text-align: left;">Source</th>
<th style="text-align: right;">Unique Citations</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td style="text-align: left;">PLOS</td>
<td style="text-align: right;">27</td>
</tr>
<tr class="even">
<td style="text-align: left;">Scopus</td>
<td style="text-align: right;">453</td>
</tr>
<tr class="odd">
<td style="text-align: left;">Springer</td>
<td style="text-align: right;">105</td>
</tr>
<tr class="even">
<td style="text-align: left;">xDD</td>
<td style="text-align: right;">202</td>
</tr>
<tr class="odd">
<td style="text-align: left;">Total</td>
<td style="text-align: right;">787</td>
</tr>
</tbody>
</table>
</div>
</div>
</div>
<p>xDD found 202 unique citations not found in Scoupus, Springer, or PLOS digital libraries. The total number of unique citations returned by <code>scythe</code> is 787. ## new to DataOne Metric service (should be CrossRef &amp; ORCID reports in <code>dataone_citations_reporter.csv</code>)</p>
<ol start="2" type="1">
<li>Does increasing the number of sources we are searching result in more complete coverage (quality)?</li>
</ol>
<div class="cell">
<div class="cell-output-display">
<div id="tbl-overlap" class="anchored">
<table class="table table-sm table-striped">
<caption>Table&nbsp;2: Percent overlap between Scythe sources</caption>
<colgroup>
<col style="width: 12%">
<col style="width: 22%">
<col style="width: 14%">
<col style="width: 17%">
<col style="width: 20%">
<col style="width: 12%">
</colgroup>
<thead>
<tr class="header">
<th style="text-align: left;">Source</th>
<th style="text-align: right;">Total Citations</th>
<th style="text-align: right;">% in PLOS</th>
<th style="text-align: right;">% in Scopus</th>
<th style="text-align: right;">% in Springer</th>
<th style="text-align: right;">% in xDD</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td style="text-align: left;">PLOS</td>
<td style="text-align: right;">38</td>
<td style="text-align: right;">1.000</td>
<td style="text-align: right;">0.177</td>
<td style="text-align: right;">0.000</td>
<td style="text-align: right;">0.000</td>
</tr>
<tr class="even">
<td style="text-align: left;">Scopus</td>
<td style="text-align: right;">644</td>
<td style="text-align: right;">0.017</td>
<td style="text-align: right;">1.000</td>
<td style="text-align: right;">0.092</td>
<td style="text-align: right;">0.185</td>
</tr>
<tr class="odd">
<td style="text-align: left;">Springer</td>
<td style="text-align: right;">166</td>
<td style="text-align: right;">0.000</td>
<td style="text-align: right;">0.361</td>
<td style="text-align: right;">1.000</td>
<td style="text-align: right;">0.006</td>
</tr>
<tr class="even">
<td style="text-align: left;">xDD</td>
<td style="text-align: right;">323</td>
<td style="text-align: right;">0.000</td>
<td style="text-align: right;">0.372</td>
<td style="text-align: right;">0.003</td>
<td style="text-align: right;">1.000</td>
</tr>
</tbody>
</table>
</div>
</div>
</div>
<ol start="3" type="1">
<li><p>Does the prevalence of data citations differ among disciplines (enviro vs SS)?</p>
<ul>
<li>Use ADC discipline classifications</li>
<li>Dataset citations are rare, N of classifications varies widely, need to control for sampling biases <a href="https://zenodo.org/record/4730857#.YoaQ2WDMKrM" class="uri">https://zenodo.org/record/4730857#.YoaQ2WDMKrM</a></li>
</ul></li>
<li><p>Total number of citations is extremely useful. Ground truth analysis - for a small number of datasets manually search through literature for citations.</p></li>
<li><p>Do usage metrics (downloads and views) correlate well with citation metrics?</p></li>
</ol>
</section>
<section id="next-steps" class="level2">
<h2 class="anchored" data-anchor-id="next-steps">Next Steps</h2>
<pre><code>-   Analysis by discipline</code></pre>
<p><a href="https://bioportal.bioontology.org/ontologies/ADCAD/?p=classes&amp;conceptid=root">Root of ADC discipline semantics annotations</a> Classes/ID is where to look for query specifics. Heres an example SOLR query that looks for two of those disciplines: <code>https://cn.dataone.org/cn/v2/query/solr/?q=sem_annotation:*ADCAD_00077+OR+sem_annotation:*ADCAD_00005&amp;fl=identifier,formatId,sem_annotation</code> - Matt Need to list every single SS ID in query list, not set up to query umbrella SS ID just yet</p>
<div class="cell">
<details>
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb18"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb18-1"><a href="#cb18-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Run second Solr query to pull semantic annotations for 2022_08_10 DOIs</span></span>
<span id="cb18-2"><a href="#cb18-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb18-3"><a href="#cb18-3" aria-hidden="true" tabindex="-1"></a><span class="co"># set coordinationg node</span></span>
<span id="cb18-4"><a href="#cb18-4" aria-hidden="true" tabindex="-1"></a>cn <span class="ot">&lt;-</span> dataone<span class="sc">::</span><span class="fu">CNode</span>(<span class="st">"PROD"</span>)</span>
<span id="cb18-5"><a href="#cb18-5" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb18-6"><a href="#cb18-6" aria-hidden="true" tabindex="-1"></a><span class="co"># point to specific member node</span></span>
<span id="cb18-7"><a href="#cb18-7" aria-hidden="true" tabindex="-1"></a>mn <span class="ot">&lt;-</span> dataone<span class="sc">::</span><span class="fu">getMNode</span>(cn, <span class="st">"urn:node:ARCTIC"</span>)</span>
<span id="cb18-8"><a href="#cb18-8" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb18-9"><a href="#cb18-9" aria-hidden="true" tabindex="-1"></a><span class="co"># set up Solr query parameters</span></span>
<span id="cb18-10"><a href="#cb18-10" aria-hidden="true" tabindex="-1"></a>queryParamList <span class="ot">&lt;-</span> <span class="fu">list</span>(<span class="at">q =</span> <span class="st">"id:doi* AND (*:* NOT obsoletedBy:*)"</span>,</span>
<span id="cb18-11"><a href="#cb18-11" aria-hidden="true" tabindex="-1"></a>                       <span class="at">fl =</span> <span class="st">"id,title,dateUploaded,datasource,sem_annotation"</span>,</span>
<span id="cb18-12"><a href="#cb18-12" aria-hidden="true" tabindex="-1"></a>                       <span class="at">start =</span><span class="st">"0"</span>,</span>
<span id="cb18-13"><a href="#cb18-13" aria-hidden="true" tabindex="-1"></a>                       <span class="at">rows =</span> <span class="st">"100000"</span>)</span>
<span id="cb18-14"><a href="#cb18-14" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb18-15"><a href="#cb18-15" aria-hidden="true" tabindex="-1"></a><span class="co"># send query to Solr, return results as dataframe. parse = T returns list column, F returns chr value</span></span>
<span id="cb18-16"><a href="#cb18-16" aria-hidden="true" tabindex="-1"></a>solr_adc_sem <span class="ot">&lt;-</span> dataone<span class="sc">::</span><span class="fu">query</span>(mn, <span class="at">solrQuery=</span>queryParamList, <span class="at">as=</span><span class="st">"data.frame"</span>, <span class="at">parse=</span>T)</span>
<span id="cb18-17"><a href="#cb18-17" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb18-18"><a href="#cb18-18" aria-hidden="true" tabindex="-1"></a><span class="co"># read in csv with coded discipline ontology</span></span>
<span id="cb18-19"><a href="#cb18-19" aria-hidden="true" tabindex="-1"></a>adc_disc <span class="ot">&lt;-</span> <span class="fu">read.csv</span>(<span class="st">"https://raw.githubusercontent.com/NCEAS/adc-disciplines/main/adc-disciplines.csv"</span>) <span class="sc">%&gt;%</span> </span>
<span id="cb18-20"><a href="#cb18-20" aria-hidden="true" tabindex="-1"></a>  <span class="co"># use ontology id to build id url - add required amount of 0s to create 5 digit suffix</span></span>
<span id="cb18-21"><a href="#cb18-21" aria-hidden="true" tabindex="-1"></a>    <span class="fu">mutate</span>(<span class="at">an_uri =</span> <span class="fu">paste0</span>(<span class="st">"https://purl.dataone.org/odo/ADCAD_"</span>, </span>
<span id="cb18-22"><a href="#cb18-22" aria-hidden="true" tabindex="-1"></a>                           stringr<span class="sc">::</span><span class="fu">str_pad</span>(id, <span class="dv">5</span>, <span class="st">"left"</span>, <span class="at">pad =</span> <span class="st">"0"</span>)))</span>
<span id="cb18-23"><a href="#cb18-23" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb18-24"><a href="#cb18-24" aria-hidden="true" tabindex="-1"></a>solr_adc_sem<span class="sc">$</span>category <span class="ot">&lt;-</span> purrr<span class="sc">::</span><span class="fu">map</span>(solr_adc_sem<span class="sc">$</span>sem_annotation, <span class="cf">function</span>(x){</span>
<span id="cb18-25"><a href="#cb18-25" aria-hidden="true" tabindex="-1"></a>    t <span class="ot">&lt;-</span> <span class="fu">grep</span>(<span class="st">"*ADCAD*"</span>, x, <span class="at">value =</span> <span class="cn">TRUE</span>)</span>
<span id="cb18-26"><a href="#cb18-26" aria-hidden="true" tabindex="-1"></a>    cats <span class="ot">&lt;-</span> <span class="fu">c</span>()</span>
<span id="cb18-27"><a href="#cb18-27" aria-hidden="true" tabindex="-1"></a>    <span class="cf">for</span> (i <span class="cf">in</span> <span class="dv">1</span><span class="sc">:</span><span class="fu">length</span>(t)){</span>
<span id="cb18-28"><a href="#cb18-28" aria-hidden="true" tabindex="-1"></a>        z <span class="ot">&lt;-</span> <span class="fu">which</span>(adc_disc<span class="sc">$</span>an_uri <span class="sc">==</span> t[i])</span>
<span id="cb18-29"><a href="#cb18-29" aria-hidden="true" tabindex="-1"></a>        cats[i] <span class="ot">&lt;-</span> adc_disc<span class="sc">$</span>discipline[z]</span>
<span id="cb18-30"><a href="#cb18-30" aria-hidden="true" tabindex="-1"></a>        </span>
<span id="cb18-31"><a href="#cb18-31" aria-hidden="true" tabindex="-1"></a>    }</span>
<span id="cb18-32"><a href="#cb18-32" aria-hidden="true" tabindex="-1"></a>    <span class="fu">return</span>(cats)</span>
<span id="cb18-33"><a href="#cb18-33" aria-hidden="true" tabindex="-1"></a>})</span>
<span id="cb18-34"><a href="#cb18-34" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb18-35"><a href="#cb18-35" aria-hidden="true" tabindex="-1"></a><span class="co"># extract discipline categories from single column to populate new columns</span></span>
<span id="cb18-36"><a href="#cb18-36" aria-hidden="true" tabindex="-1"></a>adc_disc_wide <span class="ot">&lt;-</span> solr_adc_sem <span class="sc">%&gt;%</span> </span>
<span id="cb18-37"><a href="#cb18-37" aria-hidden="true" tabindex="-1"></a>    <span class="fu">unnest_wider</span>(category, <span class="at">names_sep =</span><span class="st">"_"</span>) <span class="sc">%&gt;%</span> </span>
<span id="cb18-38"><a href="#cb18-38" aria-hidden="true" tabindex="-1"></a>    <span class="fu">select</span>(<span class="sc">-</span>sem_annotation)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
</div>
<div class="cell">
<details>
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb19"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb19-1"><a href="#cb19-1" aria-hidden="true" tabindex="-1"></a><span class="co"># key from old discipline categories to new ADCAD ontology - approved matches</span></span>
<span id="cb19-2"><a href="#cb19-2" aria-hidden="true" tabindex="-1"></a>themes <span class="ot">&lt;-</span> <span class="fu">read_csv</span>(<span class="fu">file.path</span>(<span class="st">"data/old_themes_ADCAD_key.csv"</span>))</span>
<span id="cb19-3"><a href="#cb19-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb19-4"><a href="#cb19-4" aria-hidden="true" tabindex="-1"></a><span class="co"># read in csv with previous classifications</span></span>
<span id="cb19-5"><a href="#cb19-5" aria-hidden="true" tabindex="-1"></a>old_cat <span class="ot">&lt;-</span> <span class="fu">read.csv</span>(<span class="fu">file.path</span>(<span class="st">"data/dataset_categorization.csv"</span>))</span>
<span id="cb19-6"><a href="#cb19-6" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb19-7"><a href="#cb19-7" aria-hidden="true" tabindex="-1"></a><span class="co"># replace old theme categories with new ADCAD ontology terms.</span></span>
<span id="cb19-8"><a href="#cb19-8" aria-hidden="true" tabindex="-1"></a><span class="co"># only replacing terms that don't need review (themes df), leave the rest. </span></span>
<span id="cb19-9"><a href="#cb19-9" aria-hidden="true" tabindex="-1"></a>new_cat <span class="ot">&lt;-</span> old_cat <span class="sc">%&gt;%</span> </span>
<span id="cb19-10"><a href="#cb19-10" aria-hidden="true" tabindex="-1"></a>  <span class="fu">select</span>(url, id)</span>
<span id="cb19-11"><a href="#cb19-11" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb19-12"><a href="#cb19-12" aria-hidden="true" tabindex="-1"></a><span class="cf">for</span>(i <span class="cf">in</span> <span class="fu">colnames</span>(old_cat[<span class="dv">7</span><span class="sc">:</span><span class="dv">11</span>])) {</span>
<span id="cb19-13"><a href="#cb19-13" aria-hidden="true" tabindex="-1"></a>  <span class="co"># sequence through column names</span></span>
<span id="cb19-14"><a href="#cb19-14" aria-hidden="true" tabindex="-1"></a>  new_cat[[i]] <span class="ot">&lt;-</span> purrr<span class="sc">::</span><span class="fu">map</span>(old_cat[[i]], <span class="cf">function</span>(old_theme) {</span>
<span id="cb19-15"><a href="#cb19-15" aria-hidden="true" tabindex="-1"></a>    <span class="cf">if</span> (old_theme <span class="sc">%in%</span> themes<span class="sc">$</span>old) {</span>
<span id="cb19-16"><a href="#cb19-16" aria-hidden="true" tabindex="-1"></a>      <span class="co"># replace if old theme is listed</span></span>
<span id="cb19-17"><a href="#cb19-17" aria-hidden="true" tabindex="-1"></a>      new_theme <span class="ot">&lt;-</span></span>
<span id="cb19-18"><a href="#cb19-18" aria-hidden="true" tabindex="-1"></a>        themes<span class="sc">$</span>ADCAD[<span class="fu">which</span>(themes<span class="sc">$</span>old <span class="sc">==</span> old_theme)] <span class="co"># get corresponding new disc</span></span>
<span id="cb19-19"><a href="#cb19-19" aria-hidden="true" tabindex="-1"></a>      <span class="fu">return</span>(new_theme) <span class="co"># use disc ontology term to populate column</span></span>
<span id="cb19-20"><a href="#cb19-20" aria-hidden="true" tabindex="-1"></a>    } <span class="cf">else</span>{</span>
<span id="cb19-21"><a href="#cb19-21" aria-hidden="true" tabindex="-1"></a>      <span class="cf">if</span> (old_theme <span class="sc">==</span> <span class="st">""</span>) {</span>
<span id="cb19-22"><a href="#cb19-22" aria-hidden="true" tabindex="-1"></a>        old_theme <span class="ot">=</span> <span class="cn">NA</span></span>
<span id="cb19-23"><a href="#cb19-23" aria-hidden="true" tabindex="-1"></a>      }</span>
<span id="cb19-24"><a href="#cb19-24" aria-hidden="true" tabindex="-1"></a>      <span class="fu">return</span>(old_theme)</span>
<span id="cb19-25"><a href="#cb19-25" aria-hidden="true" tabindex="-1"></a>    } <span class="co"># keep old_theme if review is needed</span></span>
<span id="cb19-26"><a href="#cb19-26" aria-hidden="true" tabindex="-1"></a>  })</span>
<span id="cb19-27"><a href="#cb19-27" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb19-28"><a href="#cb19-28" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb19-29"><a href="#cb19-29" aria-hidden="true" tabindex="-1"></a><span class="co"># unnest list columns</span></span>
<span id="cb19-30"><a href="#cb19-30" aria-hidden="true" tabindex="-1"></a>new_cat <span class="sc">%&lt;&gt;%</span> </span>
<span id="cb19-31"><a href="#cb19-31" aria-hidden="true" tabindex="-1"></a>  <span class="fu">unnest</span>(<span class="at">cols =</span> <span class="fu">c</span>(<span class="st">"theme1"</span>, <span class="st">"theme2"</span>, <span class="st">"theme3"</span>, <span class="st">"theme4"</span>, <span class="st">"theme5"</span>))</span>
<span id="cb19-32"><a href="#cb19-32" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb19-33"><a href="#cb19-33" aria-hidden="true" tabindex="-1"></a><span class="co"># Add re-categorization to solr query results (adc_disc_wide)</span></span>
<span id="cb19-34"><a href="#cb19-34" aria-hidden="true" tabindex="-1"></a>adc_disc_new <span class="ot">&lt;-</span> adc_disc_wide <span class="sc">%&gt;%</span> </span>
<span id="cb19-35"><a href="#cb19-35" aria-hidden="true" tabindex="-1"></a>  <span class="fu">left_join</span>(new_cat, <span class="at">by =</span> <span class="st">"id"</span>) <span class="sc">%&gt;%</span> </span>
<span id="cb19-36"><a href="#cb19-36" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">url =</span> url)</span>
<span id="cb19-37"><a href="#cb19-37" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb19-38"><a href="#cb19-38" aria-hidden="true" tabindex="-1"></a><span class="co"># check if there is any overlapping entries between theme1 &amp; category_1 etc.</span></span>
<span id="cb19-39"><a href="#cb19-39" aria-hidden="true" tabindex="-1"></a><span class="co"># overlap_cat1 &lt;- adc_disc_new %&gt;%</span></span>
<span id="cb19-40"><a href="#cb19-40" aria-hidden="true" tabindex="-1"></a><span class="co">#   filter(!is.na(theme1) &amp; !is.na(category_1))</span></span>
<span id="cb19-41"><a href="#cb19-41" aria-hidden="true" tabindex="-1"></a><span class="co"># </span></span>
<span id="cb19-42"><a href="#cb19-42" aria-hidden="true" tabindex="-1"></a><span class="co"># overlap_cat2 &lt;- adc_disc_new %&gt;%</span></span>
<span id="cb19-43"><a href="#cb19-43" aria-hidden="true" tabindex="-1"></a><span class="co">#   filter(!is.na(theme2) &amp; !is.na(category_2))</span></span>
<span id="cb19-44"><a href="#cb19-44" aria-hidden="true" tabindex="-1"></a><span class="co"># </span></span>
<span id="cb19-45"><a href="#cb19-45" aria-hidden="true" tabindex="-1"></a><span class="co"># overlap_cat3 &lt;- adc_disc_new %&gt;%</span></span>
<span id="cb19-46"><a href="#cb19-46" aria-hidden="true" tabindex="-1"></a><span class="co">#   filter(!is.na(theme3) &amp; !is.na(category_3))</span></span>
<span id="cb19-47"><a href="#cb19-47" aria-hidden="true" tabindex="-1"></a><span class="co"># </span></span>
<span id="cb19-48"><a href="#cb19-48" aria-hidden="true" tabindex="-1"></a><span class="co"># overlap_cat4 &lt;- adc_disc_new %&gt;%</span></span>
<span id="cb19-49"><a href="#cb19-49" aria-hidden="true" tabindex="-1"></a><span class="co">#   filter(!is.na(theme4) &amp; !is.na(category_4))</span></span>
<span id="cb19-50"><a href="#cb19-50" aria-hidden="true" tabindex="-1"></a><span class="co"># </span></span>
<span id="cb19-51"><a href="#cb19-51" aria-hidden="true" tabindex="-1"></a><span class="co"># overlap_cat5 &lt;- adc_disc_new %&gt;%</span></span>
<span id="cb19-52"><a href="#cb19-52" aria-hidden="true" tabindex="-1"></a><span class="co">#   filter(!is.na(theme5) &amp; !is.na(category_5))</span></span>
<span id="cb19-53"><a href="#cb19-53" aria-hidden="true" tabindex="-1"></a><span class="co"># ^^ No overlap between two datasets</span></span>
<span id="cb19-54"><a href="#cb19-54" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb19-55"><a href="#cb19-55" aria-hidden="true" tabindex="-1"></a><span class="co"># Combine discipline category columns + DOI</span></span>
<span id="cb19-56"><a href="#cb19-56" aria-hidden="true" tabindex="-1"></a>adc_disc_ADCAD <span class="ot">&lt;-</span> adc_disc_new <span class="sc">%&gt;%</span> </span>
<span id="cb19-57"><a href="#cb19-57" aria-hidden="true" tabindex="-1"></a>  <span class="fu">transmute</span>(<span class="at">url =</span> url,</span>
<span id="cb19-58"><a href="#cb19-58" aria-hidden="true" tabindex="-1"></a>            <span class="at">id =</span> id,</span>
<span id="cb19-59"><a href="#cb19-59" aria-hidden="true" tabindex="-1"></a>            <span class="at">title =</span> title,</span>
<span id="cb19-60"><a href="#cb19-60" aria-hidden="true" tabindex="-1"></a>            <span class="at">disc_cat_1 =</span> <span class="fu">ifelse</span>(<span class="sc">!</span><span class="fu">is.na</span>(category_1), category_1, theme1),</span>
<span id="cb19-61"><a href="#cb19-61" aria-hidden="true" tabindex="-1"></a>            <span class="at">disc_cat_2 =</span> <span class="fu">ifelse</span>(<span class="sc">!</span><span class="fu">is.na</span>(category_2), category_2, theme2),</span>
<span id="cb19-62"><a href="#cb19-62" aria-hidden="true" tabindex="-1"></a>            <span class="at">disc_cat_3 =</span> <span class="fu">ifelse</span>(<span class="sc">!</span><span class="fu">is.na</span>(category_3), category_3, theme3),</span>
<span id="cb19-63"><a href="#cb19-63" aria-hidden="true" tabindex="-1"></a>            <span class="at">disc_cat_4 =</span> <span class="fu">ifelse</span>(<span class="sc">!</span><span class="fu">is.na</span>(category_4), category_4, theme4),</span>
<span id="cb19-64"><a href="#cb19-64" aria-hidden="true" tabindex="-1"></a>            <span class="at">disc_cat_5 =</span> <span class="fu">ifelse</span>(<span class="sc">!</span><span class="fu">is.na</span>(category_5), category_5, theme5)</span>
<span id="cb19-65"><a href="#cb19-65" aria-hidden="true" tabindex="-1"></a>  )</span>
<span id="cb19-66"><a href="#cb19-66" aria-hidden="true" tabindex="-1"></a><span class="co"># Save results</span></span>
<span id="cb19-67"><a href="#cb19-67" aria-hidden="true" tabindex="-1"></a><span class="co"># write.csv(adc_disc_ADCAD, "./output/ADC_ADCAD_disciplines.csv", row.names = F)</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
</div>


<!-- -->

</section>

</main> <!-- /main -->
<script id="quarto-html-after-body" type="application/javascript">
window.document.addEventListener("DOMContentLoaded", function (event) {
  const toggleBodyColorMode = (bsSheetEl) => {
    const mode = bsSheetEl.getAttribute("data-mode");
    const bodyEl = window.document.querySelector("body");
    if (mode === "dark") {
      bodyEl.classList.add("quarto-dark");
      bodyEl.classList.remove("quarto-light");
    } else {
      bodyEl.classList.add("quarto-light");
      bodyEl.classList.remove("quarto-dark");
    }
  }
  const toggleBodyColorPrimary = () => {
    const bsSheetEl = window.document.querySelector("link#quarto-bootstrap");
    if (bsSheetEl) {
      toggleBodyColorMode(bsSheetEl);
    }
  }
  toggleBodyColorPrimary();  
  const icon = "";
  const anchorJS = new window.AnchorJS();
  anchorJS.options = {
    placement: 'right',
    icon: icon
  };
  anchorJS.add('.anchored');
  const clipboard = new window.ClipboardJS('.code-copy-button', {
    target: function(trigger) {
      return trigger.previousElementSibling;
    }
  });
  clipboard.on('success', function(e) {
    // button target
    const button = e.trigger;
    // don't keep focus
    button.blur();
    // flash "checked"
    button.classList.add('code-copy-button-checked');
    var currentTitle = button.getAttribute("title");
    button.setAttribute("title", "Copied!");
    setTimeout(function() {
      button.setAttribute("title", currentTitle);
      button.classList.remove('code-copy-button-checked');
    }, 1000);
    // clear code selection
    e.clearSelection();
  });
  const viewSource = window.document.getElementById('quarto-view-source') ||
                     window.document.getElementById('quarto-code-tools-source');
  if (viewSource) {
    const sourceUrl = viewSource.getAttribute("data-quarto-source-url");
    viewSource.addEventListener("click", function(e) {
      if (sourceUrl) {
        // rstudio viewer pane
        if (/\bcapabilities=\b/.test(window.location)) {
          window.open(sourceUrl);
        } else {
          window.location.href = sourceUrl;
        }
      } else {
        const modal = new bootstrap.Modal(document.getElementById('quarto-embedded-source-code-modal'));
        modal.show();
      }
      return false;
    });
  }
  function toggleCodeHandler(show) {
    return function(e) {
      const detailsSrc = window.document.querySelectorAll(".cell > details > .sourceCode");
      for (let i=0; i<detailsSrc.length; i++) {
        const details = detailsSrc[i].parentElement;
        if (show) {
          details.open = true;
        } else {
          details.removeAttribute("open");
        }
      }
      const cellCodeDivs = window.document.querySelectorAll(".cell > .sourceCode");
      const fromCls = show ? "hidden" : "unhidden";
      const toCls = show ? "unhidden" : "hidden";
      for (let i=0; i<cellCodeDivs.length; i++) {
        const codeDiv = cellCodeDivs[i];
        if (codeDiv.classList.contains(fromCls)) {
          codeDiv.classList.remove(fromCls);
          codeDiv.classList.add(toCls);
        } 
      }
      return false;
    }
  }
  const hideAllCode = window.document.getElementById("quarto-hide-all-code");
  if (hideAllCode) {
    hideAllCode.addEventListener("click", toggleCodeHandler(false));
  }
  const showAllCode = window.document.getElementById("quarto-show-all-code");
  if (showAllCode) {
    showAllCode.addEventListener("click", toggleCodeHandler(true));
  }
  function tippyHover(el, contentFn) {
    const config = {
      allowHTML: true,
      content: contentFn,
      maxWidth: 500,
      delay: 100,
      arrow: false,
      appendTo: function(el) {
          return el.parentElement;
      },
      interactive: true,
      interactiveBorder: 10,
      theme: 'quarto',
      placement: 'bottom-start'
    };
    window.tippy(el, config); 
  }
  const noterefs = window.document.querySelectorAll('a[role="doc-noteref"]');
  for (var i=0; i<noterefs.length; i++) {
    const ref = noterefs[i];
    tippyHover(ref, function() {
      // use id or data attribute instead here
      let href = ref.getAttribute('data-footnote-href') || ref.getAttribute('href');
      try { href = new URL(href).hash; } catch {}
      const id = href.replace(/^#\/?/, "");
      const note = window.document.getElementById(id);
      return note.innerHTML;
    });
  }
  var bibliorefs = window.document.querySelectorAll('a[role="doc-biblioref"]');
  for (var i=0; i<bibliorefs.length; i++) {
    const ref = bibliorefs[i];
    const cites = ref.parentNode.getAttribute('data-cites').split(' ');
    tippyHover(ref, function() {
      var popup = window.document.createElement('div');
      cites.forEach(function(cite) {
        var citeDiv = window.document.createElement('div');
        citeDiv.classList.add('hanging-indent');
        citeDiv.classList.add('csl-entry');
        var biblioDiv = window.document.getElementById('ref-' + cite);
        if (biblioDiv) {
          citeDiv.innerHTML = biblioDiv.innerHTML;
        }
        popup.appendChild(citeDiv);
      });
      return popup.innerHTML;
    });
  }
});
</script><div class="modal fade" id="quarto-embedded-source-code-modal" tabindex="-1" aria-labelledby="quarto-embedded-source-code-modal-label" aria-hidden="true"><div class="modal-dialog modal-dialog-scrollable"><div class="modal-content"><div class="modal-header"><h5 class="modal-title" id="quarto-embedded-source-code-modal-label">Source Code</h5><button class="btn-close" data-bs-dismiss="modal"></button></div><div class="modal-body"><div class="">
<div class="sourceCode" id="cb20" data-shortcodes="false"><pre class="sourceCode markdown code-with-copy"><code class="sourceCode markdown"><span id="cb20-1"><a href="#cb20-1" aria-hidden="true" tabindex="-1"></a><span class="co">---</span></span>
<span id="cb20-2"><a href="#cb20-2" aria-hidden="true" tabindex="-1"></a><span class="an">title:</span><span class="co"> "Searching for Elusive Arctic Dataset Citations"</span></span>
<span id="cb20-3"><a href="#cb20-3" aria-hidden="true" tabindex="-1"></a><span class="an">subtitle:</span><span class="co"> "Arctice Data Center Data Fellowship Project 2022"</span></span>
<span id="cb20-4"><a href="#cb20-4" aria-hidden="true" tabindex="-1"></a><span class="an">author:</span><span class="co"> "Althea Marks"</span></span>
<span id="cb20-5"><a href="#cb20-5" aria-hidden="true" tabindex="-1"></a><span class="an">date:</span><span class="co"> "`r Sys.Date()`"</span></span>
<span id="cb20-6"><a href="#cb20-6" aria-hidden="true" tabindex="-1"></a><span class="an">theme:</span><span class="co"> cosmo </span></span>
<span id="cb20-7"><a href="#cb20-7" aria-hidden="true" tabindex="-1"></a><span class="an">code-tools:</span><span class="co"> true</span></span>
<span id="cb20-8"><a href="#cb20-8" aria-hidden="true" tabindex="-1"></a><span class="an">toc:</span><span class="co"> true</span></span>
<span id="cb20-9"><a href="#cb20-9" aria-hidden="true" tabindex="-1"></a><span class="co">---</span></span>
<span id="cb20-10"><a href="#cb20-10" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb20-11"><a href="#cb20-11" aria-hidden="true" tabindex="-1"></a><span class="fu">## Purpose</span></span>
<span id="cb20-12"><a href="#cb20-12" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb20-13"><a href="#cb20-13" aria-hidden="true" tabindex="-1"></a>Run ADC DOIs through <span class="in">`scythe`</span> &amp; compare to known DataONE metrics citations. Known ADC citations have mixed origins including DataCite, pervious <span class="in">`scythe`</span> runs, and mannual additions via the ADC UI.</span>
<span id="cb20-14"><a href="#cb20-14" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb20-15"><a href="#cb20-15" aria-hidden="true" tabindex="-1"></a><span class="fu">## Questions</span></span>
<span id="cb20-16"><a href="#cb20-16" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb20-17"><a href="#cb20-17" aria-hidden="true" tabindex="-1"></a>1)  Does the addition of the <span class="co">[</span><span class="ot">xDD</span><span class="co">](https://geodeepdive.org/)</span> digital library to the <span class="co">[</span><span class="ot">Scythe package</span><span class="co">](https://github.com/DataONEorg/scythe/tree/main)</span> improve the quality and scope of citations in the ADC?</span>
<span id="cb20-18"><a href="#cb20-18" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb20-19"><a href="#cb20-19" aria-hidden="true" tabindex="-1"></a>2)  Does increasing the number of sources we are searching result in more complete coverage (quality)?</span>
<span id="cb20-20"><a href="#cb20-20" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb20-21"><a href="#cb20-21" aria-hidden="true" tabindex="-1"></a><span class="in">    -   Overlap in citation among sources</span></span>
<span id="cb20-22"><a href="#cb20-22" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb20-23"><a href="#cb20-23" aria-hidden="true" tabindex="-1"></a><span class="in">    -   Species ratification curve inspired - start to get to a point where we can estimate the actual amount of citation out there. Dataset citations are rare enough the technique may not be applicable. Rarefaction.</span></span>
<span id="cb20-24"><a href="#cb20-24" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb20-25"><a href="#cb20-25" aria-hidden="true" tabindex="-1"></a><span class="in">    &gt; The calculation of species richness for a given number of samples is based on the rarefaction curve. The rarefaction curve is a plot of the number of species against the number of samples. This curve is created by randomly re-sampling the pool of N samples several times and then plotting the average number of species found on each sample. Generally, it initially grows rapidly (as the most common species are found) and then slightly flattens (as the rarest species remain to be sampled). [source](https://www.cd-genomics.com/microbioseq/rarefaction-curve-a-measure-of-species-richness-and-diversity.html)</span></span>
<span id="cb20-26"><a href="#cb20-26" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb20-27"><a href="#cb20-27" aria-hidden="true" tabindex="-1"></a><span class="in">    *Would this be sampling the entireity of ADC DOIs?*</span></span>
<span id="cb20-28"><a href="#cb20-28" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb20-29"><a href="#cb20-29" aria-hidden="true" tabindex="-1"></a>3)  Does the prevalence of data citations differ among disciplines (enviro vs SS)?</span>
<span id="cb20-30"><a href="#cb20-30" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb20-31"><a href="#cb20-31" aria-hidden="true" tabindex="-1"></a><span class="in">    -   Use ADC dicipline classifications</span></span>
<span id="cb20-32"><a href="#cb20-32" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb20-33"><a href="#cb20-33" aria-hidden="true" tabindex="-1"></a><span class="in">    -   Dataset citations are rare, N of classifications varies widely, need to control for sampling biases &lt;https://zenodo.org/record/4730857#.YoaQ2WDMKrM&gt;</span></span>
<span id="cb20-34"><a href="#cb20-34" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb20-35"><a href="#cb20-35" aria-hidden="true" tabindex="-1"></a><span class="co">&lt;!-- --&gt;</span></span>
<span id="cb20-36"><a href="#cb20-36" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb20-37"><a href="#cb20-37" aria-hidden="true" tabindex="-1"></a>4)  Total number of citations is extremely useful. Ground truth analysis - for a small number of datasets manually search through literature for citations.</span>
<span id="cb20-38"><a href="#cb20-38" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb20-39"><a href="#cb20-39" aria-hidden="true" tabindex="-1"></a>5)  Do usage metrics (downloads and views) correlate well with citation metrics?</span>
<span id="cb20-40"><a href="#cb20-40" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb20-41"><a href="#cb20-41" aria-hidden="true" tabindex="-1"></a><span class="fu">## Methods Overview</span></span>
<span id="cb20-42"><a href="#cb20-42" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb20-43"><a href="#cb20-43" aria-hidden="true" tabindex="-1"></a>1)  Gather existing/known ADC dataset citations picked up by the automated DataONE metrics API</span>
<span id="cb20-44"><a href="#cb20-44" aria-hidden="true" tabindex="-1"></a>2)  Get a list of all ADC dataset DOIs</span>
<span id="cb20-45"><a href="#cb20-45" aria-hidden="true" tabindex="-1"></a>3)  Run all ADC dataset DOIs through <span class="in">`scythe`</span> libraries</span>
<span id="cb20-46"><a href="#cb20-46" aria-hidden="true" tabindex="-1"></a>4)  Review HTTP errors and rerun</span>
<span id="cb20-47"><a href="#cb20-47" aria-hidden="true" tabindex="-1"></a>5)  Calculate citation source overlap</span>
<span id="cb20-48"><a href="#cb20-48" aria-hidden="true" tabindex="-1"></a>6)  Compare citations from <span class="in">`scythe`</span> to DataONE metrics</span>
<span id="cb20-49"><a href="#cb20-49" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb20-50"><a href="#cb20-50" aria-hidden="true" tabindex="-1"></a><span class="fu">## Setup</span></span>
<span id="cb20-51"><a href="#cb20-51" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb20-52"><a href="#cb20-52" aria-hidden="true" tabindex="-1"></a><span class="in">```{r setup, include=F}</span></span>
<span id="cb20-53"><a href="#cb20-53" aria-hidden="true" tabindex="-1"></a>knitr<span class="sc">::</span>opts_chunk<span class="sc">$</span><span class="fu">set</span>(<span class="at">echo =</span> <span class="cn">TRUE</span>, <span class="at">eval =</span> <span class="cn">FALSE</span>, <span class="at">message =</span> <span class="cn">FALSE</span>)</span>
<span id="cb20-54"><a href="#cb20-54" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb20-55"><a href="#cb20-55" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb20-56"><a href="#cb20-56" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb20-57"><a href="#cb20-57" aria-hidden="true" tabindex="-1"></a><span class="in">```{r directories, eval=TRUE}</span></span>
<span id="cb20-58"><a href="#cb20-58" aria-hidden="true" tabindex="-1"></a><span class="co">#| code-fold: true</span></span>
<span id="cb20-59"><a href="#cb20-59" aria-hidden="true" tabindex="-1"></a><span class="fu">dir.create</span>(<span class="at">path =</span> <span class="st">"./output"</span>, <span class="at">showWarnings =</span> F)</span>
<span id="cb20-60"><a href="#cb20-60" aria-hidden="true" tabindex="-1"></a>output_directory <span class="ot">&lt;-</span> <span class="fu">file.path</span>(<span class="st">"./output"</span>)</span>
<span id="cb20-61"><a href="#cb20-61" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb20-62"><a href="#cb20-62" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb20-63"><a href="#cb20-63" aria-hidden="true" tabindex="-1"></a><span class="in">```{r package_library, eval=TRUE}</span></span>
<span id="cb20-64"><a href="#cb20-64" aria-hidden="true" tabindex="-1"></a><span class="co">#| code-fold: true</span></span>
<span id="cb20-65"><a href="#cb20-65" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb20-66"><a href="#cb20-66" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(readr)</span>
<span id="cb20-67"><a href="#cb20-67" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(jsonlite)</span>
<span id="cb20-68"><a href="#cb20-68" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(tidyr)</span>
<span id="cb20-69"><a href="#cb20-69" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(dplyr)</span>
<span id="cb20-70"><a href="#cb20-70" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(dataone)</span>
<span id="cb20-71"><a href="#cb20-71" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(job)</span>
<span id="cb20-72"><a href="#cb20-72" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(magrittr)</span>
<span id="cb20-73"><a href="#cb20-73" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(readr)</span>
<span id="cb20-74"><a href="#cb20-74" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(stringr)</span>
<span id="cb20-75"><a href="#cb20-75" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(purrr)</span>
<span id="cb20-76"><a href="#cb20-76" aria-hidden="true" tabindex="-1"></a><span class="co"># library(scythe) # published version of package</span></span>
<span id="cb20-77"><a href="#cb20-77" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb20-78"><a href="#cb20-78" aria-hidden="true" tabindex="-1"></a><span class="co"># install development version of scythe package with added xdd library</span></span>
<span id="cb20-79"><a href="#cb20-79" aria-hidden="true" tabindex="-1"></a>devtools<span class="sc">::</span><span class="fu">install_github</span>(<span class="st">"dataoneorg/scythe@develop"</span>)</span>
<span id="cb20-80"><a href="#cb20-80" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb20-81"><a href="#cb20-81" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb20-82"><a href="#cb20-82" aria-hidden="true" tabindex="-1"></a><span class="fu">## Analysis</span></span>
<span id="cb20-83"><a href="#cb20-83" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb20-84"><a href="#cb20-84" aria-hidden="true" tabindex="-1"></a><span class="fu">### 1. Retrieve all ADC citations with GET API request body</span></span>
<span id="cb20-85"><a href="#cb20-85" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb20-86"><a href="#cb20-86" aria-hidden="true" tabindex="-1"></a>metrics service production endpoint: <span class="ot">&lt;https://logproc-stage-ucsb-1.test.dataone.org/metrics&gt;</span> documentation: <span class="ot">&lt;https://app.swaggerhub.com/apis/nenuji/data-metrics/1.0.0.3&gt;</span></span>
<span id="cb20-87"><a href="#cb20-87" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb20-88"><a href="#cb20-88" aria-hidden="true" tabindex="-1"></a><span class="in">```{r get_request_citations}</span></span>
<span id="cb20-89"><a href="#cb20-89" aria-hidden="true" tabindex="-1"></a><span class="co">#| code-fold: true</span></span>
<span id="cb20-90"><a href="#cb20-90" aria-hidden="true" tabindex="-1"></a>{</span>
<span id="cb20-91"><a href="#cb20-91" aria-hidden="true" tabindex="-1"></a>  <span class="st">"metricsPage"</span><span class="sc">:</span>{</span>
<span id="cb20-92"><a href="#cb20-92" aria-hidden="true" tabindex="-1"></a>    <span class="st">"total"</span><span class="sc">:</span><span class="dv">0</span>,</span>
<span id="cb20-93"><a href="#cb20-93" aria-hidden="true" tabindex="-1"></a>    <span class="st">"start"</span><span class="sc">:</span><span class="dv">0</span>,</span>
<span id="cb20-94"><a href="#cb20-94" aria-hidden="true" tabindex="-1"></a>    <span class="st">"count"</span><span class="sc">:</span><span class="dv">0</span></span>
<span id="cb20-95"><a href="#cb20-95" aria-hidden="true" tabindex="-1"></a>  },</span>
<span id="cb20-96"><a href="#cb20-96" aria-hidden="true" tabindex="-1"></a>  <span class="st">"metrics"</span><span class="sc">:</span>[<span class="st">"citations"</span>],</span>
<span id="cb20-97"><a href="#cb20-97" aria-hidden="true" tabindex="-1"></a>  <span class="st">"filterBy"</span><span class="sc">:</span>[{</span>
<span id="cb20-98"><a href="#cb20-98" aria-hidden="true" tabindex="-1"></a>    <span class="st">"filterType"</span><span class="sc">:</span><span class="st">"repository"</span>,</span>
<span id="cb20-99"><a href="#cb20-99" aria-hidden="true" tabindex="-1"></a>    <span class="st">"values"</span><span class="sc">:</span>[<span class="st">"urn:node:ARCTIC"</span>],</span>
<span id="cb20-100"><a href="#cb20-100" aria-hidden="true" tabindex="-1"></a>    <span class="st">"interpretAs"</span><span class="sc">:</span><span class="st">"list"</span></span>
<span id="cb20-101"><a href="#cb20-101" aria-hidden="true" tabindex="-1"></a>  },</span>
<span id="cb20-102"><a href="#cb20-102" aria-hidden="true" tabindex="-1"></a>  {</span>
<span id="cb20-103"><a href="#cb20-103" aria-hidden="true" tabindex="-1"></a>    <span class="st">"filterType"</span><span class="sc">:</span><span class="st">"month"</span>,</span>
<span id="cb20-104"><a href="#cb20-104" aria-hidden="true" tabindex="-1"></a>    <span class="st">"values"</span><span class="sc">:</span>[<span class="st">"01/01/2012"</span>,</span>
<span id="cb20-105"><a href="#cb20-105" aria-hidden="true" tabindex="-1"></a>              <span class="st">"05/24/2022"</span>],</span>
<span id="cb20-106"><a href="#cb20-106" aria-hidden="true" tabindex="-1"></a>    <span class="st">"interpretAs"</span><span class="sc">:</span><span class="st">"range"</span></span>
<span id="cb20-107"><a href="#cb20-107" aria-hidden="true" tabindex="-1"></a>  }],</span>
<span id="cb20-108"><a href="#cb20-108" aria-hidden="true" tabindex="-1"></a>  <span class="st">"groupBy"</span><span class="sc">:</span>[<span class="st">"month"</span>]</span>
<span id="cb20-109"><a href="#cb20-109" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb20-110"><a href="#cb20-110" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb20-111"><a href="#cb20-111" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb20-112"><a href="#cb20-112" aria-hidden="true" tabindex="-1"></a>Example request:</span>
<span id="cb20-113"><a href="#cb20-113" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb20-114"><a href="#cb20-114" aria-hidden="true" tabindex="-1"></a><span class="in">```{r example_request}</span></span>
<span id="cb20-115"><a href="#cb20-115" aria-hidden="true" tabindex="-1"></a><span class="co">#| code-fold: true</span></span>
<span id="cb20-116"><a href="#cb20-116" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb20-117"><a href="#cb20-117" aria-hidden="true" tabindex="-1"></a>https<span class="sc">:</span><span class="er">//</span>logproc<span class="sc">-</span>stage<span class="sc">-</span>ucsb<span class="fl">-1.</span>test.dataone.org<span class="sc">/</span>metrics?metricsRequest<span class="ot">=</span>{<span class="sc">%22metricsPage%</span><span class="dv">22</span><span class="sc">:</span>{<span class="sc">%22total%</span><span class="dv">22</span><span class="sc">:</span><span class="dv">0</span>,<span class="sc">%22start%</span><span class="dv">22</span><span class="sc">:</span><span class="dv">0</span>,<span class="sc">%22count%</span><span class="dv">22</span><span class="sc">:</span><span class="dv">0</span>},<span class="sc">%22metrics%</span><span class="dv">22</span><span class="sc">:</span>[<span class="sc">%22citations%</span><span class="dv">22</span>],<span class="sc">%22filterBy%</span><span class="dv">22</span><span class="sc">:</span>[{<span class="sc">%22filterType%</span><span class="dv">22</span><span class="sc">:%22repository%</span><span class="dv">22</span>,<span class="sc">%22values%</span><span class="dv">22</span><span class="sc">:</span>[<span class="sc">%22urn:node:ARCTIC%</span><span class="dv">22</span>],<span class="sc">%22interpretAs%</span><span class="dv">22</span><span class="sc">:%22list%</span><span class="dv">22</span>},{<span class="sc">%22filterType%</span><span class="dv">22</span><span class="sc">:%22month%</span><span class="dv">22</span>,<span class="sc">%22values%</span><span class="dv">22</span><span class="sc">:</span>[<span class="sc">%2201/01/2012%</span><span class="dv">22</span>,<span class="sc">%2205/24/2022%</span><span class="dv">22</span>],<span class="sc">%22interpretAs%</span><span class="dv">22</span><span class="sc">:%22range%</span><span class="dv">22</span>}],<span class="sc">%22groupBy%</span><span class="dv">22</span><span class="sc">:</span>[<span class="sc">%22month%</span><span class="dv">22</span>]</span>
<span id="cb20-118"><a href="#cb20-118" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb20-119"><a href="#cb20-119" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb20-120"><a href="#cb20-120" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb20-121"><a href="#cb20-121" aria-hidden="true" tabindex="-1"></a>Function to retrieve dataset citations generated by DataOne metrics service (from Jeanette Clark):</span>
<span id="cb20-122"><a href="#cb20-122" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb20-123"><a href="#cb20-123" aria-hidden="true" tabindex="-1"></a><span class="in">```{r adc_metrics_citations_function}</span></span>
<span id="cb20-124"><a href="#cb20-124" aria-hidden="true" tabindex="-1"></a><span class="co">#| code-fold: true</span></span>
<span id="cb20-125"><a href="#cb20-125" aria-hidden="true" tabindex="-1"></a>metrics_citations <span class="ot">&lt;-</span> <span class="cf">function</span>(<span class="at">from =</span> <span class="fu">as.POSIXct</span>(<span class="st">"2010-01-01"</span>), <span class="at">to =</span> <span class="fu">as.POSIXct</span>(<span class="fu">Sys.Date</span>())){</span>
<span id="cb20-126"><a href="#cb20-126" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb20-127"><a href="#cb20-127" aria-hidden="true" tabindex="-1"></a>    from <span class="ot">&lt;-</span> <span class="fu">as.Date</span>(from); to <span class="ot">&lt;-</span> <span class="fu">as.Date</span>(to)</span>
<span id="cb20-128"><a href="#cb20-128" aria-hidden="true" tabindex="-1"></a>    from_q <span class="ot">&lt;-</span> <span class="fu">paste</span>(stringr<span class="sc">::</span><span class="fu">str_pad</span>(lubridate<span class="sc">::</span><span class="fu">month</span>(from), <span class="dv">2</span>, <span class="at">side =</span> <span class="st">"left"</span>, <span class="at">pad =</span> <span class="st">"0"</span>),</span>
<span id="cb20-129"><a href="#cb20-129" aria-hidden="true" tabindex="-1"></a>                    stringr<span class="sc">::</span><span class="fu">str_pad</span>(lubridate<span class="sc">::</span><span class="fu">day</span>(from), <span class="dv">2</span>, <span class="at">side =</span> <span class="st">"left"</span>, <span class="at">pad =</span> <span class="st">"0"</span>),</span>
<span id="cb20-130"><a href="#cb20-130" aria-hidden="true" tabindex="-1"></a>                    stringr<span class="sc">::</span><span class="fu">str_pad</span>(lubridate<span class="sc">::</span><span class="fu">year</span>(from), <span class="dv">2</span>, <span class="at">side =</span> <span class="st">"left"</span>, <span class="at">pad =</span> <span class="st">"0"</span>),</span>
<span id="cb20-131"><a href="#cb20-131" aria-hidden="true" tabindex="-1"></a>                    <span class="at">sep =</span> <span class="st">"/"</span>)</span>
<span id="cb20-132"><a href="#cb20-132" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb20-133"><a href="#cb20-133" aria-hidden="true" tabindex="-1"></a>    to_q <span class="ot">&lt;-</span> <span class="fu">paste</span>(stringr<span class="sc">::</span><span class="fu">str_pad</span>(lubridate<span class="sc">::</span><span class="fu">month</span>(to), <span class="dv">2</span>, <span class="at">side =</span> <span class="st">"left"</span>, <span class="at">pad =</span> <span class="st">"0"</span>),</span>
<span id="cb20-134"><a href="#cb20-134" aria-hidden="true" tabindex="-1"></a>                  stringr<span class="sc">::</span><span class="fu">str_pad</span>(lubridate<span class="sc">::</span><span class="fu">day</span>(to), <span class="dv">2</span>, <span class="at">side =</span> <span class="st">"left"</span>, <span class="at">pad =</span> <span class="st">"0"</span>),</span>
<span id="cb20-135"><a href="#cb20-135" aria-hidden="true" tabindex="-1"></a>                  stringr<span class="sc">::</span><span class="fu">str_pad</span>(lubridate<span class="sc">::</span><span class="fu">year</span>(to), <span class="dv">2</span>, <span class="at">side =</span> <span class="st">"left"</span>, <span class="at">pad =</span> <span class="st">"0"</span>),</span>
<span id="cb20-136"><a href="#cb20-136" aria-hidden="true" tabindex="-1"></a>                  <span class="at">sep =</span> <span class="st">"/"</span>)</span>
<span id="cb20-137"><a href="#cb20-137" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb20-138"><a href="#cb20-138" aria-hidden="true" tabindex="-1"></a>    d <span class="ot">&lt;-</span> jsonlite<span class="sc">::</span><span class="fu">fromJSON</span>(<span class="fu">paste0</span>(<span class="st">'https://logproc-stage-ucsb-1.test.dataone.org/metrics?q={%22metricsPage%22:{%22total%22:0,%22start%22:0,%22count%22:0},%22metrics%22:[%22citations%22],%22filterBy%22:[{%22filterType%22:%22repository%22,%22values%22:[%22urn:node:ARCTIC%22],%22interpretAs%22:%22list%22},{%22filterType%22:%22month%22,%22values%22:[%22'</span>, from_q,<span class="st">'%22,%22'</span>, to_q, <span class="st">'%22],%22interpretAs%22:%22range%22}],%22groupBy%22:[%22month%22]}'</span>))</span>
<span id="cb20-139"><a href="#cb20-139" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb20-140"><a href="#cb20-140" aria-hidden="true" tabindex="-1"></a>    output_json <span class="ot">&lt;-</span> d<span class="sc">$</span>resultDetails<span class="sc">$</span>citations <span class="co"># pulls citation info</span></span>
<span id="cb20-141"><a href="#cb20-141" aria-hidden="true" tabindex="-1"></a>    output_df <span class="ot">&lt;-</span> <span class="fu">as.data.frame</span>(<span class="fu">do.call</span>(rbind, output_json), <span class="at">row.names =</span> <span class="cn">FALSE</span>) <span class="co"># binds nested cit info into dataframe</span></span>
<span id="cb20-142"><a href="#cb20-142" aria-hidden="true" tabindex="-1"></a>   <span class="co"># output_clean &lt;- rownames_to_column(output_df, var = "citation_id") # converts row names to column</span></span>
<span id="cb20-143"><a href="#cb20-143" aria-hidden="true" tabindex="-1"></a>    <span class="fu">return</span>(output_df)</span>
<span id="cb20-144"><a href="#cb20-144" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb20-145"><a href="#cb20-145" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb20-146"><a href="#cb20-146" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb20-147"><a href="#cb20-147" aria-hidden="true" tabindex="-1"></a><span class="in">```{r adc_citations, cache=TRUE}</span></span>
<span id="cb20-148"><a href="#cb20-148" aria-hidden="true" tabindex="-1"></a><span class="co">#| code-fold: true</span></span>
<span id="cb20-149"><a href="#cb20-149" aria-hidden="true" tabindex="-1"></a><span class="co"># Run ADC API Get call, unnest target_id results to individual columns</span></span>
<span id="cb20-150"><a href="#cb20-150" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb20-151"><a href="#cb20-151" aria-hidden="true" tabindex="-1"></a>dataone_cit <span class="ot">&lt;-</span> <span class="fu">metrics_citations</span>()</span>
<span id="cb20-152"><a href="#cb20-152" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb20-153"><a href="#cb20-153" aria-hidden="true" tabindex="-1"></a>dataone_cit <span class="ot">&lt;-</span> tidyr<span class="sc">::</span><span class="fu">unnest</span>(dataone_cit,</span>
<span id="cb20-154"><a href="#cb20-154" aria-hidden="true" tabindex="-1"></a>                          <span class="at">cols =</span> <span class="fu">c</span>(target_id, source_id, source_url,</span>
<span id="cb20-155"><a href="#cb20-155" aria-hidden="true" tabindex="-1"></a>                                   link_publication_date, origin, title,</span>
<span id="cb20-156"><a href="#cb20-156" aria-hidden="true" tabindex="-1"></a>                                   publisher, journal, volume, page, year_of_publishing))</span>
<span id="cb20-157"><a href="#cb20-157" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb20-158"><a href="#cb20-158" aria-hidden="true" tabindex="-1"></a><span class="fu">write_csv</span>(dataone_cit, <span class="fu">file.path</span>(output_directory,</span>
<span id="cb20-159"><a href="#cb20-159" aria-hidden="true" tabindex="-1"></a>                                 <span class="fu">paste0</span>(<span class="st">"dataone_metrics_cit_"</span>, <span class="fu">Sys.Date</span>(),<span class="st">".csv"</span>)))</span>
<span id="cb20-160"><a href="#cb20-160" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb20-161"><a href="#cb20-161" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb20-162"><a href="#cb20-162" aria-hidden="true" tabindex="-1"></a><span class="fu">### 2. Get all ADC DOIs from SOLR query</span></span>
<span id="cb20-163"><a href="#cb20-163" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb20-164"><a href="#cb20-164" aria-hidden="true" tabindex="-1"></a>DataOne metrics API can only provide data package DOIs with citations, and can not provide a comprehensive list of all data package DOIs contained within the ADC. To search through all the repository metadata we query the DataONE search index (Apache SOLR search engine). SOLR is the same underlying mechanism that DataONE uses in the online tool and can create complex logical query conditions.</span>
<span id="cb20-165"><a href="#cb20-165" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb20-166"><a href="#cb20-166" aria-hidden="true" tabindex="-1"></a><span class="in">```{r SOLR_query, cache=TRUE}</span></span>
<span id="cb20-167"><a href="#cb20-167" aria-hidden="true" tabindex="-1"></a><span class="co">#| code-fold: true</span></span>
<span id="cb20-168"><a href="#cb20-168" aria-hidden="true" tabindex="-1"></a><span class="co"># complete list of searchable values</span></span>
<span id="cb20-169"><a href="#cb20-169" aria-hidden="true" tabindex="-1"></a><span class="co">#getQueryEngineDescription(cn, "solr")</span></span>
<span id="cb20-170"><a href="#cb20-170" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb20-171"><a href="#cb20-171" aria-hidden="true" tabindex="-1"></a><span class="co"># set coordinationg node</span></span>
<span id="cb20-172"><a href="#cb20-172" aria-hidden="true" tabindex="-1"></a>cn <span class="ot">&lt;-</span> dataone<span class="sc">::</span><span class="fu">CNode</span>(<span class="st">"PROD"</span>)</span>
<span id="cb20-173"><a href="#cb20-173" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb20-174"><a href="#cb20-174" aria-hidden="true" tabindex="-1"></a><span class="co"># point to specific member node</span></span>
<span id="cb20-175"><a href="#cb20-175" aria-hidden="true" tabindex="-1"></a>mn <span class="ot">&lt;-</span> dataone<span class="sc">::</span><span class="fu">getMNode</span>(cn, <span class="st">"urn:node:ARCTIC"</span>)</span>
<span id="cb20-176"><a href="#cb20-176" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb20-177"><a href="#cb20-177" aria-hidden="true" tabindex="-1"></a><span class="co"># set up Solr query parameters</span></span>
<span id="cb20-178"><a href="#cb20-178" aria-hidden="true" tabindex="-1"></a>queryParamList <span class="ot">&lt;-</span> <span class="fu">list</span>(<span class="at">q=</span><span class="st">"id:doi*"</span>, </span>
<span id="cb20-179"><a href="#cb20-179" aria-hidden="true" tabindex="-1"></a>                       <span class="at">fl=</span><span class="st">"id,title,dateUploaded,datasource"</span>,</span>
<span id="cb20-180"><a href="#cb20-180" aria-hidden="true" tabindex="-1"></a>                       <span class="at">start =</span><span class="st">"0"</span>,</span>
<span id="cb20-181"><a href="#cb20-181" aria-hidden="true" tabindex="-1"></a>                       <span class="at">rows =</span> <span class="st">"100000"</span>)</span>
<span id="cb20-182"><a href="#cb20-182" aria-hidden="true" tabindex="-1"></a><span class="co"># use `q = "identifier:doi* AND (*:* NOT obsoletedBy:*)"` to only include current versions of data packages </span></span>
<span id="cb20-183"><a href="#cb20-183" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb20-184"><a href="#cb20-184" aria-hidden="true" tabindex="-1"></a><span class="co"># send query to Solr, return results as dataframe</span></span>
<span id="cb20-185"><a href="#cb20-185" aria-hidden="true" tabindex="-1"></a>solr_adc_result <span class="ot">&lt;-</span> dataone<span class="sc">::</span><span class="fu">query</span>(mn, <span class="at">solrQuery=</span>queryParamList, <span class="at">as=</span><span class="st">"data.frame"</span>, <span class="at">parse=</span><span class="cn">FALSE</span>)</span>
<span id="cb20-186"><a href="#cb20-186" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb20-187"><a href="#cb20-187" aria-hidden="true" tabindex="-1"></a><span class="fu">write.csv</span>(solr_adc_result, <span class="fu">file.path</span>(output_directory, </span>
<span id="cb20-188"><a href="#cb20-188" aria-hidden="true" tabindex="-1"></a>                                     <span class="fu">paste0</span>(<span class="st">"solr_adc_"</span>, <span class="fu">Sys.Date</span>(), <span class="st">".csv"</span>)))</span>
<span id="cb20-189"><a href="#cb20-189" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb20-190"><a href="#cb20-190" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb20-191"><a href="#cb20-191" aria-hidden="true" tabindex="-1"></a><span class="fu">### 3. Run all ADC dataset DOIs through `scythe` libraries</span></span>
<span id="cb20-192"><a href="#cb20-192" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb20-193"><a href="#cb20-193" aria-hidden="true" tabindex="-1"></a><span class="in">```{r All_ADC_DOIs}</span></span>
<span id="cb20-194"><a href="#cb20-194" aria-hidden="true" tabindex="-1"></a><span class="co">#| code-fold: true</span></span>
<span id="cb20-195"><a href="#cb20-195" aria-hidden="true" tabindex="-1"></a><span class="co"># create vector of all ADC DOIs from solr query `result`</span></span>
<span id="cb20-196"><a href="#cb20-196" aria-hidden="true" tabindex="-1"></a>adc_all_dois <span class="ot">&lt;-</span> <span class="fu">c</span>(solr_adc_result<span class="sc">$</span>id)</span>
<span id="cb20-197"><a href="#cb20-197" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb20-198"><a href="#cb20-198" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb20-199"><a href="#cb20-199" aria-hidden="true" tabindex="-1"></a>APIs can have request rate limits. These specific rates are often found in the API documentation or the API response headers. If request rate limits are exceeded, API queries will fail.</span>
<span id="cb20-200"><a href="#cb20-200" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb20-201"><a href="#cb20-201" aria-hidden="true" tabindex="-1"></a><span class="in">```{r get_API_rate_limits}</span></span>
<span id="cb20-202"><a href="#cb20-202" aria-hidden="true" tabindex="-1"></a><span class="co">#| code-fold: true</span></span>
<span id="cb20-203"><a href="#cb20-203" aria-hidden="true" tabindex="-1"></a><span class="co"># Scopus request Limits</span></span>
<span id="cb20-204"><a href="#cb20-204" aria-hidden="true" tabindex="-1"></a>key_scopus <span class="ot">&lt;-</span> scythe<span class="sc">::</span><span class="fu">scythe_get_key</span>(<span class="st">"scopus"</span>)</span>
<span id="cb20-205"><a href="#cb20-205" aria-hidden="true" tabindex="-1"></a>url <span class="ot">&lt;-</span> <span class="fu">paste0</span>(<span class="st">"https://api.elsevier.com/content/search/scopus?query=ALL:"</span>,</span>
<span id="cb20-206"><a href="#cb20-206" aria-hidden="true" tabindex="-1"></a>  <span class="st">"10.18739/A2M32N95V"</span>,</span>
<span id="cb20-207"><a href="#cb20-207" aria-hidden="true" tabindex="-1"></a>  <span class="fu">paste</span>(<span class="st">"&amp;APIKey="</span>, key_scopus, <span class="at">sep =</span> <span class="st">""</span>))</span>
<span id="cb20-208"><a href="#cb20-208" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb20-209"><a href="#cb20-209" aria-hidden="true" tabindex="-1"></a><span class="fu">curlGetHeaders</span>(url)</span>
<span id="cb20-210"><a href="#cb20-210" aria-hidden="true" tabindex="-1"></a><span class="co"># [15:17] shows "X-RateLimit-Limit:", "X-RateLimit-Remaining:", and "X-RateLimit-Reset:" (Unix epoch is the number of seconds that have elapsed since January 1, 1970 at midnight UTC time minus the leap seconds)</span></span>
<span id="cb20-211"><a href="#cb20-211" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb20-212"><a href="#cb20-212" aria-hidden="true" tabindex="-1"></a><span class="co"># Springer request Limits</span></span>
<span id="cb20-213"><a href="#cb20-213" aria-hidden="true" tabindex="-1"></a><span class="co"># 300 calls/min and 5000/day</span></span>
<span id="cb20-214"><a href="#cb20-214" aria-hidden="true" tabindex="-1"></a><span class="co"># not found in response header, received email from springer that I was exceeding their rates above</span></span>
<span id="cb20-215"><a href="#cb20-215" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb20-216"><a href="#cb20-216" aria-hidden="true" tabindex="-1"></a><span class="co">#key_spring &lt;- scythe::scythe_get_key("springer")</span></span>
<span id="cb20-217"><a href="#cb20-217" aria-hidden="true" tabindex="-1"></a><span class="co">#url_spring &lt;- paste0("http://api.springernature.com/meta/v2/json?q=doi:10.1007/BF00627098&amp;api_key=", key_spring)</span></span>
<span id="cb20-218"><a href="#cb20-218" aria-hidden="true" tabindex="-1"></a><span class="co">#curlGetHeaders(url_spring)</span></span>
<span id="cb20-219"><a href="#cb20-219" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb20-220"><a href="#cb20-220" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb20-221"><a href="#cb20-221" aria-hidden="true" tabindex="-1"></a>Run each library search in parallel in separate background jobs to keep console available to work with. By default the <span class="in">`job::job()`</span> imports the global environment into the background job.</span>
<span id="cb20-222"><a href="#cb20-222" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb20-223"><a href="#cb20-223" aria-hidden="true" tabindex="-1"></a>::: callout-note</span>
<span id="cb20-224"><a href="#cb20-224" aria-hidden="true" tabindex="-1"></a><span class="in">`scythe::scythe_set_key()`</span> is a wrapper for the <span class="in">`key_ring`</span> package. An interactive password prompt is required to access the API keys stored in <span class="in">`key_ring`</span>. This *does not work* within a background job environment; your keyring needs to be temporarily unlocked with <span class="in">`keyring::keyring_unlock("scythe", "your password")`</span> replace <span class="in">`password`</span> with your actual keyring password.</span>
<span id="cb20-225"><a href="#cb20-225" aria-hidden="true" tabindex="-1"></a>:::</span>
<span id="cb20-226"><a href="#cb20-226" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb20-227"><a href="#cb20-227" aria-hidden="true" tabindex="-1"></a>::: callout-warning</span>
<span id="cb20-228"><a href="#cb20-228" aria-hidden="true" tabindex="-1"></a>Be careful not to save, commit, or push your personal keyring password.</span>
<span id="cb20-229"><a href="#cb20-229" aria-hidden="true" tabindex="-1"></a>:::</span>
<span id="cb20-230"><a href="#cb20-230" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb20-231"><a href="#cb20-231" aria-hidden="true" tabindex="-1"></a><span class="in">```{r citation_searches_background_jobs}</span></span>
<span id="cb20-232"><a href="#cb20-232" aria-hidden="true" tabindex="-1"></a><span class="co">#| code-fold: true</span></span>
<span id="cb20-233"><a href="#cb20-233" aria-hidden="true" tabindex="-1"></a><span class="co"># Run each source/library search in a separate background job. Running a for loop will return incomplete results if API query fails, which is better than loosing all progress because of a single error in a single vector call.  </span></span>
<span id="cb20-234"><a href="#cb20-234" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb20-235"><a href="#cb20-235" aria-hidden="true" tabindex="-1"></a>key <span class="ot">&lt;-</span> <span class="st">"password"</span></span>
<span id="cb20-236"><a href="#cb20-236" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb20-237"><a href="#cb20-237" aria-hidden="true" tabindex="-1"></a><span class="co"># Set up empty results data.frames</span></span>
<span id="cb20-238"><a href="#cb20-238" aria-hidden="true" tabindex="-1"></a>citations_scopus <span class="ot">&lt;-</span> <span class="fu">data.frame</span>()</span>
<span id="cb20-239"><a href="#cb20-239" aria-hidden="true" tabindex="-1"></a>citations_springer <span class="ot">&lt;-</span> <span class="fu">data.frame</span>()</span>
<span id="cb20-240"><a href="#cb20-240" aria-hidden="true" tabindex="-1"></a>citations_plos <span class="ot">&lt;-</span> <span class="fu">data.frame</span>()</span>
<span id="cb20-241"><a href="#cb20-241" aria-hidden="true" tabindex="-1"></a>citations_xdd <span class="ot">&lt;-</span> <span class="fu">data.frame</span>()</span>
<span id="cb20-242"><a href="#cb20-242" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb20-243"><a href="#cb20-243" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb20-244"><a href="#cb20-244" aria-hidden="true" tabindex="-1"></a><span class="do">######### Scopus</span></span>
<span id="cb20-245"><a href="#cb20-245" aria-hidden="true" tabindex="-1"></a>job<span class="sc">::</span><span class="fu">job</span>({</span>
<span id="cb20-246"><a href="#cb20-246" aria-hidden="true" tabindex="-1"></a>  <span class="cf">for</span> (i <span class="cf">in</span> <span class="fu">seq_along</span>(adc_all_dois)) {</span>
<span id="cb20-247"><a href="#cb20-247" aria-hidden="true" tabindex="-1"></a>    <span class="co"># access API keys within background job environment</span></span>
<span id="cb20-248"><a href="#cb20-248" aria-hidden="true" tabindex="-1"></a>    keyring<span class="sc">::</span><span class="fu">keyring_unlock</span>(<span class="st">"scythe"</span>, key)</span>
<span id="cb20-249"><a href="#cb20-249" aria-hidden="true" tabindex="-1"></a>    <span class="co"># suppress errors and continue loop iteration</span></span>
<span id="cb20-250"><a href="#cb20-250" aria-hidden="true" tabindex="-1"></a>    result <span class="ot">&lt;-</span> <span class="fu">tryCatch</span>(citation <span class="ot">&lt;-</span> scythe<span class="sc">::</span><span class="fu">citation_search</span>(adc_all_dois[i], <span class="st">"scopus"</span>),</span>
<span id="cb20-251"><a href="#cb20-251" aria-hidden="true" tabindex="-1"></a>                       <span class="at">error =</span> <span class="cf">function</span>(err) {</span>
<span id="cb20-252"><a href="#cb20-252" aria-hidden="true" tabindex="-1"></a>                         <span class="fu">data.frame</span>(<span class="st">"article_id"</span> <span class="ot">=</span> <span class="cn">NA</span>,</span>
<span id="cb20-253"><a href="#cb20-253" aria-hidden="true" tabindex="-1"></a>                                    <span class="st">"article_title"</span> <span class="ot">=</span> <span class="cn">NA</span>,</span>
<span id="cb20-254"><a href="#cb20-254" aria-hidden="true" tabindex="-1"></a>                                    <span class="st">"dataset_id"</span> <span class="ot">=</span> adc_all_dois[i],</span>
<span id="cb20-255"><a href="#cb20-255" aria-hidden="true" tabindex="-1"></a>                                    <span class="st">"source"</span> <span class="ot">=</span> <span class="fu">paste0</span>(<span class="st">"scopus "</span>, <span class="fu">as.character</span>(err)))</span>
<span id="cb20-256"><a href="#cb20-256" aria-hidden="true" tabindex="-1"></a>                         }</span>
<span id="cb20-257"><a href="#cb20-257" aria-hidden="true" tabindex="-1"></a>                       )</span>
<span id="cb20-258"><a href="#cb20-258" aria-hidden="true" tabindex="-1"></a>    citations_scopus <span class="ot">&lt;-</span> <span class="fu">rbind</span>(citations_scopus, result)</span>
<span id="cb20-259"><a href="#cb20-259" aria-hidden="true" tabindex="-1"></a>  }</span>
<span id="cb20-260"><a href="#cb20-260" aria-hidden="true" tabindex="-1"></a>}, <span class="at">title =</span> <span class="fu">paste0</span>(<span class="st">"scopus citation search "</span>, <span class="fu">Sys.time</span>()))</span>
<span id="cb20-261"><a href="#cb20-261" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb20-262"><a href="#cb20-262" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb20-263"><a href="#cb20-263" aria-hidden="true" tabindex="-1"></a><span class="do">######### PLOS</span></span>
<span id="cb20-264"><a href="#cb20-264" aria-hidden="true" tabindex="-1"></a>job<span class="sc">::</span><span class="fu">job</span>({</span>
<span id="cb20-265"><a href="#cb20-265" aria-hidden="true" tabindex="-1"></a>  <span class="cf">for</span> (i <span class="cf">in</span> <span class="fu">seq_along</span>(adc_all_dois)) {</span>
<span id="cb20-266"><a href="#cb20-266" aria-hidden="true" tabindex="-1"></a>    <span class="co"># access API keys within background job environment</span></span>
<span id="cb20-267"><a href="#cb20-267" aria-hidden="true" tabindex="-1"></a>    keyring<span class="sc">::</span><span class="fu">keyring_unlock</span>(<span class="st">"scythe"</span>, key)</span>
<span id="cb20-268"><a href="#cb20-268" aria-hidden="true" tabindex="-1"></a>    <span class="co"># suppress errors and continue loop iteration</span></span>
<span id="cb20-269"><a href="#cb20-269" aria-hidden="true" tabindex="-1"></a>    result <span class="ot">&lt;-</span> <span class="fu">tryCatch</span>(citation <span class="ot">&lt;-</span> scythe<span class="sc">::</span><span class="fu">citation_search</span>(adc_all_dois[i], <span class="st">"plos"</span>),</span>
<span id="cb20-270"><a href="#cb20-270" aria-hidden="true" tabindex="-1"></a>                       <span class="at">error =</span> <span class="cf">function</span>(err) {</span>
<span id="cb20-271"><a href="#cb20-271" aria-hidden="true" tabindex="-1"></a>                         <span class="fu">data.frame</span>(<span class="st">"article_id"</span> <span class="ot">=</span> <span class="cn">NA</span>,</span>
<span id="cb20-272"><a href="#cb20-272" aria-hidden="true" tabindex="-1"></a>                                    <span class="st">"article_title"</span> <span class="ot">=</span> <span class="cn">NA</span>,</span>
<span id="cb20-273"><a href="#cb20-273" aria-hidden="true" tabindex="-1"></a>                                    <span class="st">"dataset_id"</span> <span class="ot">=</span> adc_all_dois[i],</span>
<span id="cb20-274"><a href="#cb20-274" aria-hidden="true" tabindex="-1"></a>                                    <span class="st">"source"</span> <span class="ot">=</span> <span class="fu">paste0</span>(<span class="st">"plos"</span>, <span class="fu">as.character</span>(err)))</span>
<span id="cb20-275"><a href="#cb20-275" aria-hidden="true" tabindex="-1"></a>                         }</span>
<span id="cb20-276"><a href="#cb20-276" aria-hidden="true" tabindex="-1"></a>                       )</span>
<span id="cb20-277"><a href="#cb20-277" aria-hidden="true" tabindex="-1"></a>    citations_plos <span class="ot">&lt;-</span> <span class="fu">rbind</span>(citations_plos, result)</span>
<span id="cb20-278"><a href="#cb20-278" aria-hidden="true" tabindex="-1"></a>    }</span>
<span id="cb20-279"><a href="#cb20-279" aria-hidden="true" tabindex="-1"></a>}, <span class="at">title =</span> <span class="fu">paste0</span>(<span class="st">"plos citation search "</span>, <span class="fu">Sys.time</span>()))</span>
<span id="cb20-280"><a href="#cb20-280" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb20-281"><a href="#cb20-281" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb20-282"><a href="#cb20-282" aria-hidden="true" tabindex="-1"></a><span class="do">########## XDD</span></span>
<span id="cb20-283"><a href="#cb20-283" aria-hidden="true" tabindex="-1"></a>job<span class="sc">::</span><span class="fu">job</span>({</span>
<span id="cb20-284"><a href="#cb20-284" aria-hidden="true" tabindex="-1"></a>  <span class="cf">for</span> (i <span class="cf">in</span> <span class="fu">seq_along</span>(adc_all_dois)) {</span>
<span id="cb20-285"><a href="#cb20-285" aria-hidden="true" tabindex="-1"></a>    <span class="co"># access API keys within background job environment</span></span>
<span id="cb20-286"><a href="#cb20-286" aria-hidden="true" tabindex="-1"></a>    keyring<span class="sc">::</span><span class="fu">keyring_unlock</span>(<span class="st">"scythe"</span>, key)</span>
<span id="cb20-287"><a href="#cb20-287" aria-hidden="true" tabindex="-1"></a>    <span class="co"># suppress errors and continue loop iteration</span></span>
<span id="cb20-288"><a href="#cb20-288" aria-hidden="true" tabindex="-1"></a>    result <span class="ot">&lt;-</span> <span class="fu">tryCatch</span>(citation <span class="ot">&lt;-</span> scythe<span class="sc">::</span><span class="fu">citation_search</span>(adc_all_dois[i], <span class="st">"xdd"</span>),</span>
<span id="cb20-289"><a href="#cb20-289" aria-hidden="true" tabindex="-1"></a>                       <span class="at">error =</span> <span class="cf">function</span>(err) {</span>
<span id="cb20-290"><a href="#cb20-290" aria-hidden="true" tabindex="-1"></a>                         <span class="fu">data.frame</span>(<span class="st">"article_id"</span> <span class="ot">=</span> <span class="cn">NA</span>,</span>
<span id="cb20-291"><a href="#cb20-291" aria-hidden="true" tabindex="-1"></a>                                    <span class="st">"article_title"</span> <span class="ot">=</span> <span class="cn">NA</span>,</span>
<span id="cb20-292"><a href="#cb20-292" aria-hidden="true" tabindex="-1"></a>                                    <span class="st">"dataset_id"</span> <span class="ot">=</span> adc_all_dois[i],</span>
<span id="cb20-293"><a href="#cb20-293" aria-hidden="true" tabindex="-1"></a>                                    <span class="st">"source"</span> <span class="ot">=</span> <span class="fu">paste0</span>(<span class="st">"xdd"</span>, <span class="fu">as.character</span>(err)))</span>
<span id="cb20-294"><a href="#cb20-294" aria-hidden="true" tabindex="-1"></a>                         }</span>
<span id="cb20-295"><a href="#cb20-295" aria-hidden="true" tabindex="-1"></a>                       )</span>
<span id="cb20-296"><a href="#cb20-296" aria-hidden="true" tabindex="-1"></a>    citations_xdd <span class="ot">&lt;-</span> <span class="fu">rbind</span>(citations_xdd, result)</span>
<span id="cb20-297"><a href="#cb20-297" aria-hidden="true" tabindex="-1"></a>    }</span>
<span id="cb20-298"><a href="#cb20-298" aria-hidden="true" tabindex="-1"></a>}, <span class="at">title =</span> <span class="fu">paste0</span>(<span class="st">"xdd citation search "</span>, <span class="fu">Sys.time</span>()))</span>
<span id="cb20-299"><a href="#cb20-299" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb20-300"><a href="#cb20-300" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb20-301"><a href="#cb20-301" aria-hidden="true" tabindex="-1"></a>Springer's API query limits affected how we ran our search. We decided to break the list of ADC DOIs into <span class="sc">\&lt;</span> 5,000 DOI chunks and run each chunk manually through the API with 24hrs in between the last query and starting the next DOI chunk. We could have changed the base <span class="in">`scythe`</span> function <span class="in">`citation_search_springer()`</span> to slow down to accommodate both request limits, but this would substantially slow down the function and make smaller DOIs queries slow and cumbersome.</span>
<span id="cb20-302"><a href="#cb20-302" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb20-303"><a href="#cb20-303" aria-hidden="true" tabindex="-1"></a><span class="in">```{r springer_search_throttled}</span></span>
<span id="cb20-304"><a href="#cb20-304" aria-hidden="true" tabindex="-1"></a><span class="co">#| code-fold: true</span></span>
<span id="cb20-305"><a href="#cb20-305" aria-hidden="true" tabindex="-1"></a><span class="do">######### Springer</span></span>
<span id="cb20-306"><a href="#cb20-306" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb20-307"><a href="#cb20-307" aria-hidden="true" tabindex="-1"></a><span class="co"># divide ADC corpus into chunks less than Springer's 5,000/day request limit</span></span>
<span id="cb20-308"><a href="#cb20-308" aria-hidden="true" tabindex="-1"></a>springer_limit <span class="ot">&lt;-</span> <span class="dv">4995</span></span>
<span id="cb20-309"><a href="#cb20-309" aria-hidden="true" tabindex="-1"></a><span class="fu">length</span>(adc_all_dois) <span class="sc">/</span> springer_limit</span>
<span id="cb20-310"><a href="#cb20-310" aria-hidden="true" tabindex="-1"></a>chunk_1 <span class="ot">&lt;-</span> adc_all_dois[<span class="dv">1</span><span class="sc">:</span>springer_limit]</span>
<span id="cb20-311"><a href="#cb20-311" aria-hidden="true" tabindex="-1"></a>chunk_2 <span class="ot">&lt;-</span> adc_all_dois[springer_limit<span class="sc">:</span>(springer_limit<span class="sc">*</span><span class="dv">2</span>)]</span>
<span id="cb20-312"><a href="#cb20-312" aria-hidden="true" tabindex="-1"></a>chunk_3 <span class="ot">&lt;-</span> adc_all_dois[(springer_limit<span class="sc">*</span><span class="dv">2</span>)<span class="sc">:</span><span class="fu">length</span>(adc_all_dois)]</span>
<span id="cb20-313"><a href="#cb20-313" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb20-314"><a href="#cb20-314" aria-hidden="true" tabindex="-1"></a><span class="co"># change "chunk_x" object to search next chunk of DOIs. Must wait 24 hrs from last request. </span></span>
<span id="cb20-315"><a href="#cb20-315" aria-hidden="true" tabindex="-1"></a>doi_chunk <span class="ot">=</span> chunk_1</span>
<span id="cb20-316"><a href="#cb20-316" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb20-317"><a href="#cb20-317" aria-hidden="true" tabindex="-1"></a>job<span class="sc">::</span><span class="fu">job</span>({</span>
<span id="cb20-318"><a href="#cb20-318" aria-hidden="true" tabindex="-1"></a>  <span class="cf">for</span> (i <span class="cf">in</span> <span class="fu">seq_along</span>(doi_chunk)){ </span>
<span id="cb20-319"><a href="#cb20-319" aria-hidden="true" tabindex="-1"></a>    <span class="co"># access API keys within background job environment</span></span>
<span id="cb20-320"><a href="#cb20-320" aria-hidden="true" tabindex="-1"></a>    keyring<span class="sc">::</span><span class="fu">keyring_unlock</span>(<span class="st">"scythe"</span>, key)</span>
<span id="cb20-321"><a href="#cb20-321" aria-hidden="true" tabindex="-1"></a>    <span class="co"># suppress errors and continue loop iteration</span></span>
<span id="cb20-322"><a href="#cb20-322" aria-hidden="true" tabindex="-1"></a>    result <span class="ot">&lt;-</span> <span class="fu">tryCatch</span>(citation <span class="ot">&lt;-</span> scythe<span class="sc">::</span><span class="fu">citation_search</span>(doi_chunk[i], <span class="st">"springer"</span>),</span>
<span id="cb20-323"><a href="#cb20-323" aria-hidden="true" tabindex="-1"></a>                       <span class="at">error =</span> <span class="cf">function</span>(err) {</span>
<span id="cb20-324"><a href="#cb20-324" aria-hidden="true" tabindex="-1"></a>                         <span class="fu">data.frame</span>(<span class="st">"article_id"</span> <span class="ot">=</span> <span class="cn">NA</span>,</span>
<span id="cb20-325"><a href="#cb20-325" aria-hidden="true" tabindex="-1"></a>                                    <span class="st">"article_title"</span> <span class="ot">=</span> <span class="cn">NA</span>,</span>
<span id="cb20-326"><a href="#cb20-326" aria-hidden="true" tabindex="-1"></a>                                    <span class="st">"dataset_id"</span> <span class="ot">=</span> doi_chunk[i],</span>
<span id="cb20-327"><a href="#cb20-327" aria-hidden="true" tabindex="-1"></a>                                    <span class="st">"source"</span> <span class="ot">=</span> <span class="fu">paste0</span>(<span class="st">"springer "</span>, <span class="fu">as.character</span>(err)))</span>
<span id="cb20-328"><a href="#cb20-328" aria-hidden="true" tabindex="-1"></a>                         }</span>
<span id="cb20-329"><a href="#cb20-329" aria-hidden="true" tabindex="-1"></a>                       )</span>
<span id="cb20-330"><a href="#cb20-330" aria-hidden="true" tabindex="-1"></a>    citations_springer <span class="ot">&lt;-</span> <span class="fu">rbind</span>(citations_springer, result)</span>
<span id="cb20-331"><a href="#cb20-331" aria-hidden="true" tabindex="-1"></a>    }</span>
<span id="cb20-332"><a href="#cb20-332" aria-hidden="true" tabindex="-1"></a>}, <span class="at">title =</span> <span class="fu">paste0</span>(<span class="st">"springer citation search"</span>, <span class="fu">Sys.time</span>())</span>
<span id="cb20-333"><a href="#cb20-333" aria-hidden="true" tabindex="-1"></a>)</span>
<span id="cb20-334"><a href="#cb20-334" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb20-335"><a href="#cb20-335" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb20-336"><a href="#cb20-336" aria-hidden="true" tabindex="-1"></a><span class="fu">### 4. Dealing with API request errors</span></span>
<span id="cb20-337"><a href="#cb20-337" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb20-338"><a href="#cb20-338" aria-hidden="true" tabindex="-1"></a>The <span class="in">`tryCatch()`</span> functions in the above search <span class="in">`for`</span> loops records errors produced from any API request. The corresponding DOIs can be aggregated and rerun through <span class="in">`scythe`</span>. The code below does this. When running the DOIs with HTTP errors through Scopus a second time we discovered a small bug in the <span class="in">`scythe`</span> code which was subsequently fixed.</span>
<span id="cb20-339"><a href="#cb20-339" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb20-340"><a href="#cb20-340" aria-hidden="true" tabindex="-1"></a><span class="in">```{r run_failed_query_dois_again}</span></span>
<span id="cb20-341"><a href="#cb20-341" aria-hidden="true" tabindex="-1"></a><span class="co">#| code-fold: true</span></span>
<span id="cb20-342"><a href="#cb20-342" aria-hidden="true" tabindex="-1"></a>doi_error_scopus <span class="ot">&lt;-</span> citations_scopus[<span class="fu">is.na</span>(citations_scopus<span class="sc">$</span>article_id),<span class="st">"dataset_id"</span>]<span class="sc">$</span>dataset_id</span>
<span id="cb20-343"><a href="#cb20-343" aria-hidden="true" tabindex="-1"></a>doi_error_springer <span class="ot">&lt;-</span> citations_springer[<span class="fu">is.na</span>(citations_springer<span class="sc">$</span>article_id), <span class="st">"dataset_id"</span>]<span class="sc">$</span>dataset_id <span class="co"># no errors</span></span>
<span id="cb20-344"><a href="#cb20-344" aria-hidden="true" tabindex="-1"></a>doi_error_plos <span class="ot">&lt;-</span> citations_plos[<span class="fu">is.na</span>(citations_plos<span class="sc">$</span>article_id), <span class="st">"dataset_id"</span>]<span class="sc">$</span>dataset_id</span>
<span id="cb20-345"><a href="#cb20-345" aria-hidden="true" tabindex="-1"></a>doi_error_xdd <span class="ot">&lt;-</span> citations_xdd[<span class="fu">is.na</span>(citations_xdd<span class="sc">$</span>article_id), <span class="st">"dataset_id"</span>]<span class="sc">$</span>dataset_id <span class="co"># no errors</span></span>
<span id="cb20-346"><a href="#cb20-346" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb20-347"><a href="#cb20-347" aria-hidden="true" tabindex="-1"></a><span class="do">######### Scopus # this isn't working</span></span>
<span id="cb20-348"><a href="#cb20-348" aria-hidden="true" tabindex="-1"></a>citations_error_scopus <span class="ot">&lt;-</span> <span class="fu">data.frame</span>()</span>
<span id="cb20-349"><a href="#cb20-349" aria-hidden="true" tabindex="-1"></a>job<span class="sc">::</span><span class="fu">job</span>({</span>
<span id="cb20-350"><a href="#cb20-350" aria-hidden="true" tabindex="-1"></a>  <span class="cf">for</span> (i <span class="cf">in</span> <span class="fu">seq_along</span>(doi_error_scopus)) {</span>
<span id="cb20-351"><a href="#cb20-351" aria-hidden="true" tabindex="-1"></a>    <span class="co"># access API keys within background job environment</span></span>
<span id="cb20-352"><a href="#cb20-352" aria-hidden="true" tabindex="-1"></a>    keyring<span class="sc">::</span><span class="fu">keyring_unlock</span>(<span class="st">"scythe"</span>, key)</span>
<span id="cb20-353"><a href="#cb20-353" aria-hidden="true" tabindex="-1"></a>    <span class="co"># suppress errors and continue loop iteration</span></span>
<span id="cb20-354"><a href="#cb20-354" aria-hidden="true" tabindex="-1"></a>    result <span class="ot">&lt;-</span> <span class="fu">tryCatch</span>(citation <span class="ot">&lt;-</span> scythe<span class="sc">::</span><span class="fu">citation_search</span>(doi_error_scopus[i], <span class="st">"scopus"</span>),</span>
<span id="cb20-355"><a href="#cb20-355" aria-hidden="true" tabindex="-1"></a>                       <span class="at">error =</span> <span class="cf">function</span>(err) {</span>
<span id="cb20-356"><a href="#cb20-356" aria-hidden="true" tabindex="-1"></a>                         <span class="fu">data.frame</span>(<span class="st">"article_id"</span> <span class="ot">=</span> <span class="cn">NA</span>,</span>
<span id="cb20-357"><a href="#cb20-357" aria-hidden="true" tabindex="-1"></a>                                    <span class="st">"article_title"</span> <span class="ot">=</span> <span class="cn">NA</span>,</span>
<span id="cb20-358"><a href="#cb20-358" aria-hidden="true" tabindex="-1"></a>                                    <span class="st">"dataset_id"</span> <span class="ot">=</span> doi_error_scopus[i],</span>
<span id="cb20-359"><a href="#cb20-359" aria-hidden="true" tabindex="-1"></a>                                    <span class="st">"source"</span> <span class="ot">=</span> <span class="fu">paste0</span>(<span class="st">"scopus "</span>, <span class="fu">as.character</span>(err)))</span>
<span id="cb20-360"><a href="#cb20-360" aria-hidden="true" tabindex="-1"></a>                         }</span>
<span id="cb20-361"><a href="#cb20-361" aria-hidden="true" tabindex="-1"></a>                       )</span>
<span id="cb20-362"><a href="#cb20-362" aria-hidden="true" tabindex="-1"></a>    citations_error_scopus <span class="ot">&lt;-</span> <span class="fu">rbind</span>(citations_error_scopus, result)</span>
<span id="cb20-363"><a href="#cb20-363" aria-hidden="true" tabindex="-1"></a>  }</span>
<span id="cb20-364"><a href="#cb20-364" aria-hidden="true" tabindex="-1"></a>}, <span class="at">title =</span> <span class="fu">paste0</span>(<span class="st">"scopus error citation search "</span>, <span class="fu">Sys.time</span>()))</span>
<span id="cb20-365"><a href="#cb20-365" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb20-366"><a href="#cb20-366" aria-hidden="true" tabindex="-1"></a><span class="co"># save search results from errored DOI</span></span>
<span id="cb20-367"><a href="#cb20-367" aria-hidden="true" tabindex="-1"></a><span class="fu">write_csv</span>(citations_error_scopus, <span class="st">"./output/scythe_2022-07-14_scopus_error.csv"</span>)</span>
<span id="cb20-368"><a href="#cb20-368" aria-hidden="true" tabindex="-1"></a><span class="co"># add error citations results to main scopus results data.frame</span></span>
<span id="cb20-369"><a href="#cb20-369" aria-hidden="true" tabindex="-1"></a>citations_scopus <span class="ot">&lt;-</span> <span class="fu">rbind</span>(citations_scopus, citations_error_scopus)</span>
<span id="cb20-370"><a href="#cb20-370" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb20-371"><a href="#cb20-371" aria-hidden="true" tabindex="-1"></a><span class="do">######### PLOS</span></span>
<span id="cb20-372"><a href="#cb20-372" aria-hidden="true" tabindex="-1"></a>citations_error_plos <span class="ot">&lt;-</span> <span class="fu">data.frame</span>()</span>
<span id="cb20-373"><a href="#cb20-373" aria-hidden="true" tabindex="-1"></a>job<span class="sc">::</span><span class="fu">job</span>({</span>
<span id="cb20-374"><a href="#cb20-374" aria-hidden="true" tabindex="-1"></a>  <span class="cf">for</span> (i <span class="cf">in</span> <span class="fu">seq_along</span>(doi_error_plos)) {</span>
<span id="cb20-375"><a href="#cb20-375" aria-hidden="true" tabindex="-1"></a>    <span class="co"># access API keys within background job environment</span></span>
<span id="cb20-376"><a href="#cb20-376" aria-hidden="true" tabindex="-1"></a>    keyring<span class="sc">::</span><span class="fu">keyring_unlock</span>(<span class="st">"scythe"</span>, key)</span>
<span id="cb20-377"><a href="#cb20-377" aria-hidden="true" tabindex="-1"></a>    <span class="co"># suppress errors and continue loop iteration</span></span>
<span id="cb20-378"><a href="#cb20-378" aria-hidden="true" tabindex="-1"></a>    result <span class="ot">&lt;-</span> <span class="fu">tryCatch</span>(citation <span class="ot">&lt;-</span> scythe<span class="sc">::</span><span class="fu">citation_search</span>(doi_error_plos[i], <span class="st">"plos"</span>),</span>
<span id="cb20-379"><a href="#cb20-379" aria-hidden="true" tabindex="-1"></a>                       <span class="at">error =</span> <span class="cf">function</span>(err) {</span>
<span id="cb20-380"><a href="#cb20-380" aria-hidden="true" tabindex="-1"></a>                         <span class="fu">data.frame</span>(<span class="st">"article_id"</span> <span class="ot">=</span> <span class="cn">NA</span>,</span>
<span id="cb20-381"><a href="#cb20-381" aria-hidden="true" tabindex="-1"></a>                                    <span class="st">"article_title"</span> <span class="ot">=</span> <span class="cn">NA</span>,</span>
<span id="cb20-382"><a href="#cb20-382" aria-hidden="true" tabindex="-1"></a>                                    <span class="st">"dataset_id"</span> <span class="ot">=</span> doi_error_plos[i],</span>
<span id="cb20-383"><a href="#cb20-383" aria-hidden="true" tabindex="-1"></a>                                    <span class="st">"source"</span> <span class="ot">=</span> <span class="fu">paste0</span>(<span class="st">"plos"</span>, <span class="fu">as.character</span>(err)))</span>
<span id="cb20-384"><a href="#cb20-384" aria-hidden="true" tabindex="-1"></a>                         }</span>
<span id="cb20-385"><a href="#cb20-385" aria-hidden="true" tabindex="-1"></a>                       )</span>
<span id="cb20-386"><a href="#cb20-386" aria-hidden="true" tabindex="-1"></a>    citations_error_plos <span class="ot">&lt;-</span> <span class="fu">rbind</span>(citations_error_plos, result)</span>
<span id="cb20-387"><a href="#cb20-387" aria-hidden="true" tabindex="-1"></a>    }</span>
<span id="cb20-388"><a href="#cb20-388" aria-hidden="true" tabindex="-1"></a>}, <span class="at">title =</span> <span class="fu">paste0</span>(<span class="st">"plos error citation search "</span>, <span class="fu">Sys.time</span>()))</span>
<span id="cb20-389"><a href="#cb20-389" aria-hidden="true" tabindex="-1"></a><span class="co"># empty dataframe return means no citations found and no HTTP errors</span></span>
<span id="cb20-390"><a href="#cb20-390" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb20-391"><a href="#cb20-391" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb20-392"><a href="#cb20-392" aria-hidden="true" tabindex="-1"></a><span class="in">```{r save_scythe_results}</span></span>
<span id="cb20-393"><a href="#cb20-393" aria-hidden="true" tabindex="-1"></a><span class="co">#| code-fold: true</span></span>
<span id="cb20-394"><a href="#cb20-394" aria-hidden="true" tabindex="-1"></a><span class="do">## Save results as .csv's to project output folder</span></span>
<span id="cb20-395"><a href="#cb20-395" aria-hidden="true" tabindex="-1"></a>date <span class="ot">&lt;-</span> <span class="st">"2022-07-14"</span></span>
<span id="cb20-396"><a href="#cb20-396" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb20-397"><a href="#cb20-397" aria-hidden="true" tabindex="-1"></a><span class="fu">write.csv</span>(citations_scopus,</span>
<span id="cb20-398"><a href="#cb20-398" aria-hidden="true" tabindex="-1"></a>          <span class="fu">file.path</span>(output_directory, <span class="fu">paste0</span>(<span class="st">"scythe_"</span>, date, <span class="st">"_scopus_all.csv"</span>)),</span>
<span id="cb20-399"><a href="#cb20-399" aria-hidden="true" tabindex="-1"></a>          <span class="at">row.names =</span> F)</span>
<span id="cb20-400"><a href="#cb20-400" aria-hidden="true" tabindex="-1"></a><span class="fu">write.csv</span>(citations_springer,</span>
<span id="cb20-401"><a href="#cb20-401" aria-hidden="true" tabindex="-1"></a>          <span class="fu">file.path</span>(output_directory, <span class="fu">paste0</span>(<span class="st">"scythe_"</span>, date, <span class="st">"_springer_all.csv"</span>)),</span>
<span id="cb20-402"><a href="#cb20-402" aria-hidden="true" tabindex="-1"></a>          <span class="at">row.names =</span> F)</span>
<span id="cb20-403"><a href="#cb20-403" aria-hidden="true" tabindex="-1"></a><span class="fu">write.csv</span>(citations_plos,</span>
<span id="cb20-404"><a href="#cb20-404" aria-hidden="true" tabindex="-1"></a>          <span class="fu">file.path</span>(output_directory, <span class="fu">paste0</span>(<span class="st">"scythe_"</span>, date, <span class="st">"_plos_all.csv"</span>)),</span>
<span id="cb20-405"><a href="#cb20-405" aria-hidden="true" tabindex="-1"></a>          <span class="at">row.names =</span> F)</span>
<span id="cb20-406"><a href="#cb20-406" aria-hidden="true" tabindex="-1"></a><span class="fu">write.csv</span>(citations_xdd,</span>
<span id="cb20-407"><a href="#cb20-407" aria-hidden="true" tabindex="-1"></a>          <span class="fu">file.path</span>(output_directory, <span class="fu">paste0</span>(<span class="st">"scythe_"</span>, date, <span class="st">"_xdd_all.csv"</span>)),</span>
<span id="cb20-408"><a href="#cb20-408" aria-hidden="true" tabindex="-1"></a>          <span class="at">row.names =</span> F)</span>
<span id="cb20-409"><a href="#cb20-409" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb20-410"><a href="#cb20-410" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb20-411"><a href="#cb20-411" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb20-412"><a href="#cb20-412" aria-hidden="true" tabindex="-1"></a><span class="fu">### 5. Calculate citation source overlap</span></span>
<span id="cb20-413"><a href="#cb20-413" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb20-414"><a href="#cb20-414" aria-hidden="true" tabindex="-1"></a>We evaluated the redundancy in citations found among sources by matching citations between source search results. A citation is defined by the unique combination of <span class="in">`article_id`</span> and <span class="in">`dataset_id`</span>. Percent overlap is the percent of total citations found in a source also found in a second source.</span>
<span id="cb20-415"><a href="#cb20-415" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb20-416"><a href="#cb20-416" aria-hidden="true" tabindex="-1"></a><span class="in">```{r source_overlap}</span></span>
<span id="cb20-417"><a href="#cb20-417" aria-hidden="true" tabindex="-1"></a><span class="co">#| code-fold: true</span></span>
<span id="cb20-418"><a href="#cb20-418" aria-hidden="true" tabindex="-1"></a>scythe_cit <span class="ot">&lt;-</span></span>
<span id="cb20-419"><a href="#cb20-419" aria-hidden="true" tabindex="-1"></a>  <span class="fu">rbind</span>(citations_scopus,</span>
<span id="cb20-420"><a href="#cb20-420" aria-hidden="true" tabindex="-1"></a>        citations_springer,</span>
<span id="cb20-421"><a href="#cb20-421" aria-hidden="true" tabindex="-1"></a>        citations_plos,</span>
<span id="cb20-422"><a href="#cb20-422" aria-hidden="true" tabindex="-1"></a>        citations_xdd) <span class="sc">%&gt;%</span></span>
<span id="cb20-423"><a href="#cb20-423" aria-hidden="true" tabindex="-1"></a>  <span class="fu">filter</span>(<span class="sc">!</span><span class="fu">is.na</span>(article_id)) <span class="co"># remove NA/error observations</span></span>
<span id="cb20-424"><a href="#cb20-424" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb20-425"><a href="#cb20-425" aria-hidden="true" tabindex="-1"></a><span class="fu">write_csv</span>(scythe_cit, <span class="fu">file.path</span>(output_directory, <span class="fu">paste0</span>(<span class="st">"scythe_"</span>, date, <span class="st">"_citations_all.csv"</span>)))</span>
<span id="cb20-426"><a href="#cb20-426" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb20-427"><a href="#cb20-427" aria-hidden="true" tabindex="-1"></a>scythe_sum <span class="ot">&lt;-</span> scythe_cit <span class="sc">%&gt;%</span></span>
<span id="cb20-428"><a href="#cb20-428" aria-hidden="true" tabindex="-1"></a>  <span class="fu">group_by</span>(source) <span class="sc">%&gt;%</span></span>
<span id="cb20-429"><a href="#cb20-429" aria-hidden="true" tabindex="-1"></a>  <span class="fu">summarise</span>(<span class="st">"total_citations_found"</span> <span class="ot">=</span> <span class="fu">n</span>())</span>
<span id="cb20-430"><a href="#cb20-430" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb20-431"><a href="#cb20-431" aria-hidden="true" tabindex="-1"></a><span class="co"># match article_id and dataset_id columns among results</span></span>
<span id="cb20-432"><a href="#cb20-432" aria-hidden="true" tabindex="-1"></a>overlap_plos_scopus <span class="ot">&lt;-</span></span>
<span id="cb20-433"><a href="#cb20-433" aria-hidden="true" tabindex="-1"></a>  <span class="fu">inner_join</span>(citations_plos,</span>
<span id="cb20-434"><a href="#cb20-434" aria-hidden="true" tabindex="-1"></a>             citations_scopus,</span>
<span id="cb20-435"><a href="#cb20-435" aria-hidden="true" tabindex="-1"></a>             <span class="at">by =</span> <span class="fu">c</span>(<span class="st">"article_id"</span>, <span class="st">"dataset_id"</span>))</span>
<span id="cb20-436"><a href="#cb20-436" aria-hidden="true" tabindex="-1"></a>overlap_plos_springer <span class="ot">&lt;-</span></span>
<span id="cb20-437"><a href="#cb20-437" aria-hidden="true" tabindex="-1"></a>  <span class="fu">inner_join</span>(citations_plos,</span>
<span id="cb20-438"><a href="#cb20-438" aria-hidden="true" tabindex="-1"></a>             citations_springer,</span>
<span id="cb20-439"><a href="#cb20-439" aria-hidden="true" tabindex="-1"></a>             <span class="at">by =</span> <span class="fu">c</span>(<span class="st">"article_id"</span>, <span class="st">"dataset_id"</span>))</span>
<span id="cb20-440"><a href="#cb20-440" aria-hidden="true" tabindex="-1"></a>overlap_plos_xdd <span class="ot">&lt;-</span></span>
<span id="cb20-441"><a href="#cb20-441" aria-hidden="true" tabindex="-1"></a>  <span class="fu">inner_join</span>(citations_plos,</span>
<span id="cb20-442"><a href="#cb20-442" aria-hidden="true" tabindex="-1"></a>             citations_xdd,</span>
<span id="cb20-443"><a href="#cb20-443" aria-hidden="true" tabindex="-1"></a>             <span class="at">by =</span> <span class="fu">c</span>(<span class="st">"article_id"</span>, <span class="st">"dataset_id"</span>))</span>
<span id="cb20-444"><a href="#cb20-444" aria-hidden="true" tabindex="-1"></a>overlap_scopus_springer <span class="ot">&lt;-</span></span>
<span id="cb20-445"><a href="#cb20-445" aria-hidden="true" tabindex="-1"></a>  <span class="fu">inner_join</span>(citations_scopus,</span>
<span id="cb20-446"><a href="#cb20-446" aria-hidden="true" tabindex="-1"></a>             citations_springer,</span>
<span id="cb20-447"><a href="#cb20-447" aria-hidden="true" tabindex="-1"></a>             <span class="at">by =</span> <span class="fu">c</span>(<span class="st">"article_id"</span>, <span class="st">"dataset_id"</span>))</span>
<span id="cb20-448"><a href="#cb20-448" aria-hidden="true" tabindex="-1"></a>overlap_scopus_xdd <span class="ot">&lt;-</span></span>
<span id="cb20-449"><a href="#cb20-449" aria-hidden="true" tabindex="-1"></a>  <span class="fu">inner_join</span>(citations_scopus,</span>
<span id="cb20-450"><a href="#cb20-450" aria-hidden="true" tabindex="-1"></a>             citations_xdd,</span>
<span id="cb20-451"><a href="#cb20-451" aria-hidden="true" tabindex="-1"></a>             <span class="at">by =</span> <span class="fu">c</span>(<span class="st">"article_id"</span>, <span class="st">"dataset_id"</span>))</span>
<span id="cb20-452"><a href="#cb20-452" aria-hidden="true" tabindex="-1"></a>overlap_springer_xdd <span class="ot">&lt;-</span></span>
<span id="cb20-453"><a href="#cb20-453" aria-hidden="true" tabindex="-1"></a>  <span class="fu">inner_join</span>(citations_springer,</span>
<span id="cb20-454"><a href="#cb20-454" aria-hidden="true" tabindex="-1"></a>             citations_xdd,</span>
<span id="cb20-455"><a href="#cb20-455" aria-hidden="true" tabindex="-1"></a>             <span class="at">by =</span> <span class="fu">c</span>(<span class="st">"article_id"</span>, <span class="st">"dataset_id"</span>))</span>
<span id="cb20-456"><a href="#cb20-456" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb20-457"><a href="#cb20-457" aria-hidden="true" tabindex="-1"></a><span class="co"># function to calculate percent of source citations also found in a second source</span></span>
<span id="cb20-458"><a href="#cb20-458" aria-hidden="true" tabindex="-1"></a>calc_prct_overlap <span class="ot">&lt;-</span> <span class="cf">function</span>(source_1, source_2) {</span>
<span id="cb20-459"><a href="#cb20-459" aria-hidden="true" tabindex="-1"></a>  pairs <span class="ot">&lt;-</span></span>
<span id="cb20-460"><a href="#cb20-460" aria-hidden="true" tabindex="-1"></a>    <span class="fu">inner_join</span>(source_1, source_2, <span class="at">by =</span> <span class="fu">c</span>(<span class="st">"article_id"</span>, <span class="st">"dataset_id"</span>))</span>
<span id="cb20-461"><a href="#cb20-461" aria-hidden="true" tabindex="-1"></a>  overlap <span class="ot">&lt;-</span></span>
<span id="cb20-462"><a href="#cb20-462" aria-hidden="true" tabindex="-1"></a>    <span class="fu">nrow</span>(pairs) <span class="sc">/</span> <span class="fu">nrow</span>(source_1) <span class="co"># percent of source_1 total also found in source_2 (pairs)</span></span>
<span id="cb20-463"><a href="#cb20-463" aria-hidden="true" tabindex="-1"></a>  <span class="fu">return</span>(overlap)</span>
<span id="cb20-464"><a href="#cb20-464" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb20-465"><a href="#cb20-465" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb20-466"><a href="#cb20-466" aria-hidden="true" tabindex="-1"></a>scythe_overlap_sum <span class="ot">&lt;-</span> scythe_cit <span class="sc">%&gt;%</span></span>
<span id="cb20-467"><a href="#cb20-467" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="st">"citation_df"</span> <span class="ot">=</span> <span class="fu">ifelse</span>(</span>
<span id="cb20-468"><a href="#cb20-468" aria-hidden="true" tabindex="-1"></a>    source <span class="sc">==</span> <span class="st">"plos"</span>,</span>
<span id="cb20-469"><a href="#cb20-469" aria-hidden="true" tabindex="-1"></a>    <span class="st">"citations_plos"</span>,</span>
<span id="cb20-470"><a href="#cb20-470" aria-hidden="true" tabindex="-1"></a>    <span class="fu">ifelse</span>(</span>
<span id="cb20-471"><a href="#cb20-471" aria-hidden="true" tabindex="-1"></a>      source <span class="sc">==</span> <span class="st">"scopus"</span>,</span>
<span id="cb20-472"><a href="#cb20-472" aria-hidden="true" tabindex="-1"></a>      <span class="st">"citations_scopus"</span>,</span>
<span id="cb20-473"><a href="#cb20-473" aria-hidden="true" tabindex="-1"></a>      <span class="fu">ifelse</span>(source <span class="sc">==</span> <span class="st">"springer"</span>, <span class="st">"citations_springer"</span>, <span class="st">"citations_xdd"</span>)</span>
<span id="cb20-474"><a href="#cb20-474" aria-hidden="true" tabindex="-1"></a>    )</span>
<span id="cb20-475"><a href="#cb20-475" aria-hidden="true" tabindex="-1"></a>  )) <span class="sc">%&gt;%</span></span>
<span id="cb20-476"><a href="#cb20-476" aria-hidden="true" tabindex="-1"></a>  <span class="fu">group_by</span>(source, citation_df) <span class="sc">%&gt;%</span></span>
<span id="cb20-477"><a href="#cb20-477" aria-hidden="true" tabindex="-1"></a>  <span class="fu">summarise</span>(</span>
<span id="cb20-478"><a href="#cb20-478" aria-hidden="true" tabindex="-1"></a>    <span class="st">"total_citations"</span> <span class="ot">=</span> <span class="fu">n</span>(),</span>
<span id="cb20-479"><a href="#cb20-479" aria-hidden="true" tabindex="-1"></a>    <span class="st">"prct_in_plos"</span> <span class="ot">=</span> <span class="fu">calc_prct_overlap</span>(<span class="fu">eval</span>(<span class="fu">parse</span>(<span class="at">text =</span> citation_df)), </span>
<span id="cb20-480"><a href="#cb20-480" aria-hidden="true" tabindex="-1"></a>                                              citations_plos),</span>
<span id="cb20-481"><a href="#cb20-481" aria-hidden="true" tabindex="-1"></a>    <span class="st">"prct_in_scopus"</span> <span class="ot">=</span> <span class="fu">calc_prct_overlap</span>(<span class="fu">eval</span>(<span class="fu">parse</span>(<span class="at">text =</span> citation_df)), </span>
<span id="cb20-482"><a href="#cb20-482" aria-hidden="true" tabindex="-1"></a>                                                citations_scopus),</span>
<span id="cb20-483"><a href="#cb20-483" aria-hidden="true" tabindex="-1"></a>    <span class="st">"prct_in_springer"</span> <span class="ot">=</span> <span class="fu">calc_prct_overlap</span>(<span class="fu">eval</span>(<span class="fu">parse</span>(<span class="at">text =</span> citation_df)), </span>
<span id="cb20-484"><a href="#cb20-484" aria-hidden="true" tabindex="-1"></a>                                                  citations_springer),</span>
<span id="cb20-485"><a href="#cb20-485" aria-hidden="true" tabindex="-1"></a>    <span class="st">"prct_in_xdd"</span> <span class="ot">=</span> <span class="fu">calc_prct_overlap</span>(<span class="fu">eval</span>(<span class="fu">parse</span>(<span class="at">text =</span> citation_df)), </span>
<span id="cb20-486"><a href="#cb20-486" aria-hidden="true" tabindex="-1"></a>                                             citations_xdd)</span>
<span id="cb20-487"><a href="#cb20-487" aria-hidden="true" tabindex="-1"></a>  ) <span class="sc">%&gt;%</span></span>
<span id="cb20-488"><a href="#cb20-488" aria-hidden="true" tabindex="-1"></a>  <span class="fu">select</span>(<span class="dv">1</span>, <span class="dv">3</span><span class="sc">:</span><span class="dv">7</span>)</span>
<span id="cb20-489"><a href="#cb20-489" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb20-490"><a href="#cb20-490" aria-hidden="true" tabindex="-1"></a><span class="co"># Save summary table to output folder</span></span>
<span id="cb20-491"><a href="#cb20-491" aria-hidden="true" tabindex="-1"></a><span class="fu">write.csv</span>(scythe_overlap_sum,</span>
<span id="cb20-492"><a href="#cb20-492" aria-hidden="true" tabindex="-1"></a>          <span class="fu">file.path</span>(</span>
<span id="cb20-493"><a href="#cb20-493" aria-hidden="true" tabindex="-1"></a>            output_directory,</span>
<span id="cb20-494"><a href="#cb20-494" aria-hidden="true" tabindex="-1"></a>            <span class="fu">paste0</span>(<span class="st">"scythe_"</span>, date, <span class="st">"_prct_overlap.csv"</span>)</span>
<span id="cb20-495"><a href="#cb20-495" aria-hidden="true" tabindex="-1"></a>          ),</span>
<span id="cb20-496"><a href="#cb20-496" aria-hidden="true" tabindex="-1"></a>          <span class="at">row.names =</span> F)</span>
<span id="cb20-497"><a href="#cb20-497" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb20-498"><a href="#cb20-498" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb20-499"><a href="#cb20-499" aria-hidden="true" tabindex="-1"></a><span class="fu">### 6. How many completely unique citations found in each source?</span></span>
<span id="cb20-500"><a href="#cb20-500" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb20-501"><a href="#cb20-501" aria-hidden="true" tabindex="-1"></a><span class="in">```{r unique_citations_by_source, eval = TRUE}</span></span>
<span id="cb20-502"><a href="#cb20-502" aria-hidden="true" tabindex="-1"></a><span class="co">#| code-fold: true</span></span>
<span id="cb20-503"><a href="#cb20-503" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb20-504"><a href="#cb20-504" aria-hidden="true" tabindex="-1"></a>citations_plos <span class="ot">&lt;-</span> readr<span class="sc">::</span><span class="fu">read_csv</span>(<span class="fu">file.path</span>(output_directory, <span class="st">"scythe_2022-07-14_plos.csv"</span>))</span>
<span id="cb20-505"><a href="#cb20-505" aria-hidden="true" tabindex="-1"></a>citations_scopus <span class="ot">&lt;-</span> readr<span class="sc">::</span><span class="fu">read_csv</span>(<span class="fu">file.path</span>(output_directory, <span class="st">"scythe_2022-07-14_scopus.csv"</span>))</span>
<span id="cb20-506"><a href="#cb20-506" aria-hidden="true" tabindex="-1"></a>citations_springer <span class="ot">&lt;-</span> readr<span class="sc">::</span><span class="fu">read_csv</span>(<span class="fu">file.path</span>(output_directory, <span class="st">"scythe_2022-07-14_springer.csv"</span>))</span>
<span id="cb20-507"><a href="#cb20-507" aria-hidden="true" tabindex="-1"></a>citations_xdd <span class="ot">&lt;-</span> readr<span class="sc">::</span><span class="fu">read_csv</span>(<span class="fu">file.path</span>(output_directory, <span class="st">"scythe_2022-07-14_xdd.csv"</span>))</span>
<span id="cb20-508"><a href="#cb20-508" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb20-509"><a href="#cb20-509" aria-hidden="true" tabindex="-1"></a>unique_plos <span class="ot">&lt;-</span> citations_plos <span class="sc">%&gt;%</span> </span>
<span id="cb20-510"><a href="#cb20-510" aria-hidden="true" tabindex="-1"></a>  <span class="fu">anti_join</span>(citations_scopus, <span class="at">by =</span> <span class="fu">c</span>(<span class="st">"article_id"</span>, <span class="st">"dataset_id"</span>)) <span class="sc">%&gt;%</span> </span>
<span id="cb20-511"><a href="#cb20-511" aria-hidden="true" tabindex="-1"></a>  <span class="fu">anti_join</span>(citations_springer, <span class="at">by =</span> <span class="fu">c</span>(<span class="st">"article_id"</span>, <span class="st">"dataset_id"</span>)) <span class="sc">%&gt;%</span> </span>
<span id="cb20-512"><a href="#cb20-512" aria-hidden="true" tabindex="-1"></a>  <span class="fu">anti_join</span>(citations_xdd, <span class="at">by =</span> <span class="fu">c</span>(<span class="st">"article_id"</span>, <span class="st">"dataset_id"</span>)) <span class="sc">%&gt;%</span> </span>
<span id="cb20-513"><a href="#cb20-513" aria-hidden="true" tabindex="-1"></a>  <span class="fu">filter</span>(<span class="sc">!</span><span class="fu">is.na</span>(article_id))</span>
<span id="cb20-514"><a href="#cb20-514" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb20-515"><a href="#cb20-515" aria-hidden="true" tabindex="-1"></a>unique_scopus <span class="ot">&lt;-</span> citations_scopus <span class="sc">%&gt;%</span> </span>
<span id="cb20-516"><a href="#cb20-516" aria-hidden="true" tabindex="-1"></a>  <span class="fu">anti_join</span>(citations_plos, <span class="at">by =</span> <span class="fu">c</span>(<span class="st">"article_id"</span>, <span class="st">"dataset_id"</span>)) <span class="sc">%&gt;%</span> </span>
<span id="cb20-517"><a href="#cb20-517" aria-hidden="true" tabindex="-1"></a>  <span class="fu">anti_join</span>(citations_springer, <span class="at">by =</span> <span class="fu">c</span>(<span class="st">"article_id"</span>, <span class="st">"dataset_id"</span>)) <span class="sc">%&gt;%</span> </span>
<span id="cb20-518"><a href="#cb20-518" aria-hidden="true" tabindex="-1"></a>  <span class="fu">anti_join</span>(citations_xdd, <span class="at">by =</span> <span class="fu">c</span>(<span class="st">"article_id"</span>, <span class="st">"dataset_id"</span>)) <span class="sc">%&gt;%</span> </span>
<span id="cb20-519"><a href="#cb20-519" aria-hidden="true" tabindex="-1"></a>  <span class="fu">filter</span>(<span class="sc">!</span><span class="fu">is.na</span>(article_id))</span>
<span id="cb20-520"><a href="#cb20-520" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb20-521"><a href="#cb20-521" aria-hidden="true" tabindex="-1"></a>unique_springer <span class="ot">&lt;-</span> citations_springer <span class="sc">%&gt;%</span> </span>
<span id="cb20-522"><a href="#cb20-522" aria-hidden="true" tabindex="-1"></a>  <span class="fu">anti_join</span>(citations_plos, <span class="at">by =</span> <span class="fu">c</span>(<span class="st">"article_id"</span>, <span class="st">"dataset_id"</span>)) <span class="sc">%&gt;%</span> </span>
<span id="cb20-523"><a href="#cb20-523" aria-hidden="true" tabindex="-1"></a>  <span class="fu">anti_join</span>(citations_scopus, <span class="at">by =</span> <span class="fu">c</span>(<span class="st">"article_id"</span>, <span class="st">"dataset_id"</span>)) <span class="sc">%&gt;%</span> </span>
<span id="cb20-524"><a href="#cb20-524" aria-hidden="true" tabindex="-1"></a>  <span class="fu">anti_join</span>(citations_xdd, <span class="at">by =</span> <span class="fu">c</span>(<span class="st">"article_id"</span>, <span class="st">"dataset_id"</span>)) <span class="sc">%&gt;%</span> </span>
<span id="cb20-525"><a href="#cb20-525" aria-hidden="true" tabindex="-1"></a>  <span class="fu">filter</span>(<span class="sc">!</span><span class="fu">is.na</span>(article_id))</span>
<span id="cb20-526"><a href="#cb20-526" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb20-527"><a href="#cb20-527" aria-hidden="true" tabindex="-1"></a>unique_xdd <span class="ot">&lt;-</span> citations_xdd <span class="sc">%&gt;%</span> </span>
<span id="cb20-528"><a href="#cb20-528" aria-hidden="true" tabindex="-1"></a>  <span class="fu">anti_join</span>(citations_plos, <span class="at">by =</span> <span class="fu">c</span>(<span class="st">"article_id"</span>, <span class="st">"dataset_id"</span>)) <span class="sc">%&gt;%</span> </span>
<span id="cb20-529"><a href="#cb20-529" aria-hidden="true" tabindex="-1"></a>  <span class="fu">anti_join</span>(citations_scopus, <span class="at">by =</span> <span class="fu">c</span>(<span class="st">"article_id"</span>, <span class="st">"dataset_id"</span>)) <span class="sc">%&gt;%</span> </span>
<span id="cb20-530"><a href="#cb20-530" aria-hidden="true" tabindex="-1"></a>  <span class="fu">anti_join</span>(citations_springer, <span class="at">by =</span> <span class="fu">c</span>(<span class="st">"article_id"</span>, <span class="st">"dataset_id"</span>)) <span class="sc">%&gt;%</span> </span>
<span id="cb20-531"><a href="#cb20-531" aria-hidden="true" tabindex="-1"></a>  <span class="fu">filter</span>(<span class="sc">!</span><span class="fu">is.na</span>(article_id))</span>
<span id="cb20-532"><a href="#cb20-532" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb20-533"><a href="#cb20-533" aria-hidden="true" tabindex="-1"></a><span class="co"># combine unique citation tables</span></span>
<span id="cb20-534"><a href="#cb20-534" aria-hidden="true" tabindex="-1"></a>unique_citations <span class="ot">&lt;-</span> <span class="fu">rbind</span>(unique_plos, unique_scopus, unique_springer, unique_xdd)</span>
<span id="cb20-535"><a href="#cb20-535" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb20-536"><a href="#cb20-536" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb20-537"><a href="#cb20-537" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb20-538"><a href="#cb20-538" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb20-539"><a href="#cb20-539" aria-hidden="true" tabindex="-1"></a><span class="fu">### 7. Compare `scythe` results to DataOne Metrics citations</span></span>
<span id="cb20-540"><a href="#cb20-540" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb20-541"><a href="#cb20-541" aria-hidden="true" tabindex="-1"></a><span class="in">`dataone_met_cit`</span> came from the SOLR query, it has 626 observations. <span class="in">`dataone_cit_source`</span> came from Rushiraj with 2035 observations. I am still confused on the back end set up of how these citations are truely being generated. <span class="in">`dataone_cit_source`</span> has the record of how citations entered the DataOne Metrics Service: <span class="in">`Crossref`</span>, <span class="in">`Metrics Service Ingest`</span>, and ORCID. I believe <span class="in">`Metrics Service Ingest`</span> is previous <span class="in">`scythe`</span> runs. Nonetheless, I can cross compare the <span class="in">`scythe`</span> citation results with both DataONe metrics citation lists and look at the distribution of citation sources.</span>
<span id="cb20-542"><a href="#cb20-542" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb20-543"><a href="#cb20-543" aria-hidden="true" tabindex="-1"></a><span class="in">```{r new_scythe_citations, eval=TRUE}</span></span>
<span id="cb20-544"><a href="#cb20-544" aria-hidden="true" tabindex="-1"></a><span class="co">#| code-fold: true</span></span>
<span id="cb20-545"><a href="#cb20-545" aria-hidden="true" tabindex="-1"></a>dataone_met_cit <span class="ot">&lt;-</span> readr<span class="sc">::</span><span class="fu">read_csv</span>(<span class="fu">file.path</span>(output_directory, <span class="st">"dataone_metrics_cit_2022-07-08.csv"</span>))</span>
<span id="cb20-546"><a href="#cb20-546" aria-hidden="true" tabindex="-1"></a>scythe_cit <span class="ot">&lt;-</span> readr<span class="sc">::</span><span class="fu">read_csv</span>(<span class="fu">file.path</span>(output_directory, <span class="st">"scythe_2022-07-14_citations_all.csv"</span>))</span>
<span id="cb20-547"><a href="#cb20-547" aria-hidden="true" tabindex="-1"></a>dataone_cit_source <span class="ot">&lt;-</span> readr<span class="sc">::</span><span class="fu">read_csv</span>(<span class="fu">file.path</span>(<span class="st">"data/dataone_citations_reporter.csv"</span>))</span>
<span id="cb20-548"><a href="#cb20-548" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb20-549"><a href="#cb20-549" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb20-550"><a href="#cb20-550" aria-hidden="true" tabindex="-1"></a><span class="co"># source_id = 'Unique identifier to the source dataset / document / article that cited the target dataset '</span></span>
<span id="cb20-551"><a href="#cb20-551" aria-hidden="true" tabindex="-1"></a><span class="co"># target_id = 'Unique identifier to the target DATAONE dataset. This is the dataset that was cited.'</span></span>
<span id="cb20-552"><a href="#cb20-552" aria-hidden="true" tabindex="-1"></a>dataone_met_cit <span class="ot">&lt;-</span> dataone_met_cit <span class="sc">%&gt;%</span> </span>
<span id="cb20-553"><a href="#cb20-553" aria-hidden="true" tabindex="-1"></a>  <span class="fu">rename</span>(<span class="st">"article_id"</span> <span class="ot">=</span> source_id, <span class="co"># rename dataone metrics citations columns to match scythe results</span></span>
<span id="cb20-554"><a href="#cb20-554" aria-hidden="true" tabindex="-1"></a>         <span class="st">"dataset_id"</span> <span class="ot">=</span> target_id) <span class="sc">%&gt;%</span> </span>
<span id="cb20-555"><a href="#cb20-555" aria-hidden="true" tabindex="-1"></a>  <span class="fu">select</span>(article_id, dataset_id)</span>
<span id="cb20-556"><a href="#cb20-556" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb20-557"><a href="#cb20-557" aria-hidden="true" tabindex="-1"></a><span class="co"># only show citations found by scythe that do not already appear in the DataOne Metrics service</span></span>
<span id="cb20-558"><a href="#cb20-558" aria-hidden="true" tabindex="-1"></a>scythe_cit_new1 <span class="ot">&lt;-</span> <span class="fu">anti_join</span>(scythe_cit, dataone_met_cit, <span class="at">by =</span> <span class="fu">c</span>(<span class="st">"article_id"</span>, <span class="st">"dataset_id"</span>)) <span class="sc">%&gt;%</span> </span>
<span id="cb20-559"><a href="#cb20-559" aria-hidden="true" tabindex="-1"></a>  <span class="fu">na.omit</span>()</span>
<span id="cb20-560"><a href="#cb20-560" aria-hidden="true" tabindex="-1"></a><span class="co"># 897 new scythe citations </span></span>
<span id="cb20-561"><a href="#cb20-561" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb20-562"><a href="#cb20-562" aria-hidden="true" tabindex="-1"></a><span class="co"># scythe::write_citation_pairs(scythe_citations_new, </span></span>
<span id="cb20-563"><a href="#cb20-563" aria-hidden="true" tabindex="-1"></a><span class="co">#                              path = paste0("./output/scythe_", date,"_citation_pairs.json"))</span></span>
<span id="cb20-564"><a href="#cb20-564" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb20-565"><a href="#cb20-565" aria-hidden="true" tabindex="-1"></a><span class="co"># clean up dataone citation reporter csv. Remove extra ' from character strings</span></span>
<span id="cb20-566"><a href="#cb20-566" aria-hidden="true" tabindex="-1"></a>dataone_cit_source <span class="ot">&lt;-</span> <span class="fu">as.data.frame</span>(<span class="fu">lapply</span>(dataone_cit_source, gsub, <span class="at">pattern =</span> <span class="st">"*'*"</span>, <span class="at">replacement =</span> <span class="st">""</span>))</span>
<span id="cb20-567"><a href="#cb20-567" aria-hidden="true" tabindex="-1"></a>dataone_cit_source <span class="sc">%&lt;&gt;%</span></span>
<span id="cb20-568"><a href="#cb20-568" aria-hidden="true" tabindex="-1"></a>  <span class="fu">rename</span>(<span class="st">"article_id"</span> <span class="ot">=</span> source_id, <span class="co"># rename dataone metrics citations columns to match scythe results</span></span>
<span id="cb20-569"><a href="#cb20-569" aria-hidden="true" tabindex="-1"></a>         <span class="st">"dataset_id"</span> <span class="ot">=</span> target_id)</span>
<span id="cb20-570"><a href="#cb20-570" aria-hidden="true" tabindex="-1"></a>scythe_cit_new2 <span class="ot">&lt;-</span> <span class="fu">anti_join</span>(scythe_cit, dataone_cit_source, <span class="at">by =</span> <span class="fu">c</span>(<span class="st">"article_id"</span>, <span class="st">"dataset_id"</span>)) <span class="sc">%&gt;%</span> </span>
<span id="cb20-571"><a href="#cb20-571" aria-hidden="true" tabindex="-1"></a>  <span class="fu">na.omit</span>()</span>
<span id="cb20-572"><a href="#cb20-572" aria-hidden="true" tabindex="-1"></a><span class="co"># have 886 new scythe citations not found in dataone metrics</span></span>
<span id="cb20-573"><a href="#cb20-573" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb20-574"><a href="#cb20-574" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb20-575"><a href="#cb20-575" aria-hidden="true" tabindex="-1"></a><span class="fu">## Results</span></span>
<span id="cb20-576"><a href="#cb20-576" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb20-577"><a href="#cb20-577" aria-hidden="true" tabindex="-1"></a>1)  Does the addition of the xDD digital library to the Scythe package improve the quality and scope of citations in the ADC?</span>
<span id="cb20-578"><a href="#cb20-578" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb20-579"><a href="#cb20-579" aria-hidden="true" tabindex="-1"></a><span class="in">    -   How many unique citations were found in xDD and not in any of the other sources?</span></span>
<span id="cb20-580"><a href="#cb20-580" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb20-581"><a href="#cb20-581" aria-hidden="true" tabindex="-1"></a><span class="in">```{r unique_citations_table, eval=TRUE, echo=FALSE}</span></span>
<span id="cb20-582"><a href="#cb20-582" aria-hidden="true" tabindex="-1"></a><span class="co">#| label: tbl-unique</span></span>
<span id="cb20-583"><a href="#cb20-583" aria-hidden="true" tabindex="-1"></a><span class="co">#| tbl-cap: "Number of citations only found within each source"</span></span>
<span id="cb20-584"><a href="#cb20-584" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb20-585"><a href="#cb20-585" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb20-586"><a href="#cb20-586" aria-hidden="true" tabindex="-1"></a><span class="co"># summarize unique citations</span></span>
<span id="cb20-587"><a href="#cb20-587" aria-hidden="true" tabindex="-1"></a>unique_sum <span class="ot">&lt;-</span> unique_citations <span class="sc">%&gt;%</span> </span>
<span id="cb20-588"><a href="#cb20-588" aria-hidden="true" tabindex="-1"></a>  <span class="fu">group_by</span>(source) <span class="sc">%&gt;%</span> </span>
<span id="cb20-589"><a href="#cb20-589" aria-hidden="true" tabindex="-1"></a>  <span class="fu">summarize</span>(<span class="at">unique_cit =</span> <span class="fu">n</span>())</span>
<span id="cb20-590"><a href="#cb20-590" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb20-591"><a href="#cb20-591" aria-hidden="true" tabindex="-1"></a>unique_sum_tbl <span class="ot">&lt;-</span> <span class="fu">rbind</span>(unique_sum, <span class="fu">data.frame</span>(<span class="at">source =</span> <span class="st">"Total"</span>, <span class="at">unique_cit =</span> <span class="fu">sum</span>(unique_sum<span class="sc">$</span>unique_cit)))</span>
<span id="cb20-592"><a href="#cb20-592" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb20-593"><a href="#cb20-593" aria-hidden="true" tabindex="-1"></a>unique_sum_tbl<span class="sc">$</span>source <span class="ot">&lt;-</span> <span class="fu">c</span>(<span class="st">"PLOS"</span>, <span class="st">"Scopus"</span>, <span class="st">"Springer"</span>, <span class="st">"xDD"</span>, <span class="st">"Total"</span>)</span>
<span id="cb20-594"><a href="#cb20-594" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb20-595"><a href="#cb20-595" aria-hidden="true" tabindex="-1"></a>knitr<span class="sc">::</span><span class="fu">kable</span>(unique_sum_tbl,</span>
<span id="cb20-596"><a href="#cb20-596" aria-hidden="true" tabindex="-1"></a>             <span class="at">col.names =</span> <span class="fu">c</span>(<span class="st">"Source"</span>, <span class="st">"Unique Citations"</span>))</span>
<span id="cb20-597"><a href="#cb20-597" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb20-598"><a href="#cb20-598" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb20-599"><a href="#cb20-599" aria-hidden="true" tabindex="-1"></a>xDD found <span class="in">`r nrow(unique_xdd)`</span> unique citations not found in Scoupus, Springer, or PLOS digital libraries. The total number of unique citations returned by <span class="in">`scythe`</span> is <span class="in">`r unique_sum_tbl[5,2]`</span>. <span class="sc">\#</span># new to DataOne Metric service (should be CrossRef &amp; ORCID reports in <span class="in">`dataone_citations_reporter.csv`</span>)</span>
<span id="cb20-600"><a href="#cb20-600" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb20-601"><a href="#cb20-601" aria-hidden="true" tabindex="-1"></a>2)  Does increasing the number of sources we are searching result in more complete coverage (quality)?</span>
<span id="cb20-602"><a href="#cb20-602" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb20-603"><a href="#cb20-603" aria-hidden="true" tabindex="-1"></a><span class="in">```{r overlap_results_table, eval=TRUE, echo=FALSE}</span></span>
<span id="cb20-604"><a href="#cb20-604" aria-hidden="true" tabindex="-1"></a><span class="co">#| label: tbl-overlap</span></span>
<span id="cb20-605"><a href="#cb20-605" aria-hidden="true" tabindex="-1"></a><span class="co">#| tbl-cap: "Percent overlap between Scythe sources"</span></span>
<span id="cb20-606"><a href="#cb20-606" aria-hidden="true" tabindex="-1"></a>source_prct_overlap_2022_07_14 <span class="ot">&lt;-</span> readr<span class="sc">::</span><span class="fu">read_csv</span>(<span class="st">"./output/scythe_2022-07-14_prct_overlap.csv"</span>)</span>
<span id="cb20-607"><a href="#cb20-607" aria-hidden="true" tabindex="-1"></a>source_prct_overlap_2022_07_14<span class="sc">$</span>source <span class="ot">&lt;-</span> <span class="fu">c</span>(<span class="st">"PLOS"</span>, <span class="st">"Scopus"</span>, <span class="st">"Springer"</span>, <span class="st">"xDD"</span>)</span>
<span id="cb20-608"><a href="#cb20-608" aria-hidden="true" tabindex="-1"></a>knitr<span class="sc">::</span><span class="fu">kable</span>(source_prct_overlap_2022_07_14, </span>
<span id="cb20-609"><a href="#cb20-609" aria-hidden="true" tabindex="-1"></a>             <span class="at">col.names =</span> <span class="fu">c</span>(<span class="st">"Source"</span>, <span class="st">"Total Citations"</span>, <span class="st">"% in PLOS"</span>, <span class="st">"% in Scopus"</span>, <span class="st">"% in Springer"</span>, <span class="st">"% in xDD"</span>), </span>
<span id="cb20-610"><a href="#cb20-610" aria-hidden="true" tabindex="-1"></a>             <span class="at">digits =</span> <span class="dv">3</span>)</span>
<span id="cb20-611"><a href="#cb20-611" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb20-612"><a href="#cb20-612" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb20-613"><a href="#cb20-613" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb20-614"><a href="#cb20-614" aria-hidden="true" tabindex="-1"></a>3)  Does the prevalence of data citations differ among disciplines (enviro vs SS)?</span>
<span id="cb20-615"><a href="#cb20-615" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb20-616"><a href="#cb20-616" aria-hidden="true" tabindex="-1"></a><span class="in">    -   Use ADC discipline classifications</span></span>
<span id="cb20-617"><a href="#cb20-617" aria-hidden="true" tabindex="-1"></a><span class="in">    -   Dataset citations are rare, N of classifications varies widely, need to control for sampling biases &lt;https://zenodo.org/record/4730857#.YoaQ2WDMKrM&gt;</span></span>
<span id="cb20-618"><a href="#cb20-618" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb20-619"><a href="#cb20-619" aria-hidden="true" tabindex="-1"></a>4)  Total number of citations is extremely useful. Ground truth analysis - for a small number of datasets manually search through literature for citations.</span>
<span id="cb20-620"><a href="#cb20-620" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb20-621"><a href="#cb20-621" aria-hidden="true" tabindex="-1"></a>5)  Do usage metrics (downloads and views) correlate well with citation metrics?</span>
<span id="cb20-622"><a href="#cb20-622" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb20-623"><a href="#cb20-623" aria-hidden="true" tabindex="-1"></a><span class="fu">## Next Steps</span></span>
<span id="cb20-624"><a href="#cb20-624" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb20-625"><a href="#cb20-625" aria-hidden="true" tabindex="-1"></a><span class="in">    -   Analysis by discipline</span></span>
<span id="cb20-626"><a href="#cb20-626" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb20-627"><a href="#cb20-627" aria-hidden="true" tabindex="-1"></a><span class="co">[</span><span class="ot">Root of ADC discipline semantics annotations</span><span class="co">](https://bioportal.bioontology.org/ontologies/ADCAD/?p=classes&amp;conceptid=root)</span> Classes/ID is where to look for query specifics. "Here's an example SOLR query that looks for two of those disciplines: <span class="in">`https://cn.dataone.org/cn/v2/query/solr/?q=sem_annotation:*ADCAD_00077+OR+sem_annotation:*ADCAD_00005&amp;fl=identifier,formatId,sem_annotation`</span>" - Matt Need to list every single SS ID in query list, not set up to query umbrella SS ID just yet</span>
<span id="cb20-628"><a href="#cb20-628" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb20-629"><a href="#cb20-629" aria-hidden="true" tabindex="-1"></a><span class="in">```{r discipline_semantics}</span></span>
<span id="cb20-630"><a href="#cb20-630" aria-hidden="true" tabindex="-1"></a><span class="co">#| code-fold: true</span></span>
<span id="cb20-631"><a href="#cb20-631" aria-hidden="true" tabindex="-1"></a><span class="co"># Run second Solr query to pull semantic annotations for 2022_08_10 DOIs</span></span>
<span id="cb20-632"><a href="#cb20-632" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb20-633"><a href="#cb20-633" aria-hidden="true" tabindex="-1"></a><span class="co"># set coordinationg node</span></span>
<span id="cb20-634"><a href="#cb20-634" aria-hidden="true" tabindex="-1"></a>cn <span class="ot">&lt;-</span> dataone<span class="sc">::</span><span class="fu">CNode</span>(<span class="st">"PROD"</span>)</span>
<span id="cb20-635"><a href="#cb20-635" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb20-636"><a href="#cb20-636" aria-hidden="true" tabindex="-1"></a><span class="co"># point to specific member node</span></span>
<span id="cb20-637"><a href="#cb20-637" aria-hidden="true" tabindex="-1"></a>mn <span class="ot">&lt;-</span> dataone<span class="sc">::</span><span class="fu">getMNode</span>(cn, <span class="st">"urn:node:ARCTIC"</span>)</span>
<span id="cb20-638"><a href="#cb20-638" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb20-639"><a href="#cb20-639" aria-hidden="true" tabindex="-1"></a><span class="co"># set up Solr query parameters</span></span>
<span id="cb20-640"><a href="#cb20-640" aria-hidden="true" tabindex="-1"></a>queryParamList <span class="ot">&lt;-</span> <span class="fu">list</span>(<span class="at">q =</span> <span class="st">"id:doi* AND (*:* NOT obsoletedBy:*)"</span>,</span>
<span id="cb20-641"><a href="#cb20-641" aria-hidden="true" tabindex="-1"></a>                       <span class="at">fl =</span> <span class="st">"id,title,dateUploaded,datasource,sem_annotation"</span>,</span>
<span id="cb20-642"><a href="#cb20-642" aria-hidden="true" tabindex="-1"></a>                       <span class="at">start =</span><span class="st">"0"</span>,</span>
<span id="cb20-643"><a href="#cb20-643" aria-hidden="true" tabindex="-1"></a>                       <span class="at">rows =</span> <span class="st">"100000"</span>)</span>
<span id="cb20-644"><a href="#cb20-644" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb20-645"><a href="#cb20-645" aria-hidden="true" tabindex="-1"></a><span class="co"># send query to Solr, return results as dataframe. parse = T returns list column, F returns chr value</span></span>
<span id="cb20-646"><a href="#cb20-646" aria-hidden="true" tabindex="-1"></a>solr_adc_sem <span class="ot">&lt;-</span> dataone<span class="sc">::</span><span class="fu">query</span>(mn, <span class="at">solrQuery=</span>queryParamList, <span class="at">as=</span><span class="st">"data.frame"</span>, <span class="at">parse=</span>T)</span>
<span id="cb20-647"><a href="#cb20-647" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb20-648"><a href="#cb20-648" aria-hidden="true" tabindex="-1"></a><span class="co"># read in csv with coded discipline ontology</span></span>
<span id="cb20-649"><a href="#cb20-649" aria-hidden="true" tabindex="-1"></a>adc_disc <span class="ot">&lt;-</span> <span class="fu">read.csv</span>(<span class="st">"https://raw.githubusercontent.com/NCEAS/adc-disciplines/main/adc-disciplines.csv"</span>) <span class="sc">%&gt;%</span> </span>
<span id="cb20-650"><a href="#cb20-650" aria-hidden="true" tabindex="-1"></a>  <span class="co"># use ontology id to build id url - add required amount of 0s to create 5 digit suffix</span></span>
<span id="cb20-651"><a href="#cb20-651" aria-hidden="true" tabindex="-1"></a>    <span class="fu">mutate</span>(<span class="at">an_uri =</span> <span class="fu">paste0</span>(<span class="st">"https://purl.dataone.org/odo/ADCAD_"</span>, </span>
<span id="cb20-652"><a href="#cb20-652" aria-hidden="true" tabindex="-1"></a>                           stringr<span class="sc">::</span><span class="fu">str_pad</span>(id, <span class="dv">5</span>, <span class="st">"left"</span>, <span class="at">pad =</span> <span class="st">"0"</span>)))</span>
<span id="cb20-653"><a href="#cb20-653" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb20-654"><a href="#cb20-654" aria-hidden="true" tabindex="-1"></a>solr_adc_sem<span class="sc">$</span>category <span class="ot">&lt;-</span> purrr<span class="sc">::</span><span class="fu">map</span>(solr_adc_sem<span class="sc">$</span>sem_annotation, <span class="cf">function</span>(x){</span>
<span id="cb20-655"><a href="#cb20-655" aria-hidden="true" tabindex="-1"></a>    t <span class="ot">&lt;-</span> <span class="fu">grep</span>(<span class="st">"*ADCAD*"</span>, x, <span class="at">value =</span> <span class="cn">TRUE</span>)</span>
<span id="cb20-656"><a href="#cb20-656" aria-hidden="true" tabindex="-1"></a>    cats <span class="ot">&lt;-</span> <span class="fu">c</span>()</span>
<span id="cb20-657"><a href="#cb20-657" aria-hidden="true" tabindex="-1"></a>    <span class="cf">for</span> (i <span class="cf">in</span> <span class="dv">1</span><span class="sc">:</span><span class="fu">length</span>(t)){</span>
<span id="cb20-658"><a href="#cb20-658" aria-hidden="true" tabindex="-1"></a>        z <span class="ot">&lt;-</span> <span class="fu">which</span>(adc_disc<span class="sc">$</span>an_uri <span class="sc">==</span> t[i])</span>
<span id="cb20-659"><a href="#cb20-659" aria-hidden="true" tabindex="-1"></a>        cats[i] <span class="ot">&lt;-</span> adc_disc<span class="sc">$</span>discipline[z]</span>
<span id="cb20-660"><a href="#cb20-660" aria-hidden="true" tabindex="-1"></a>        </span>
<span id="cb20-661"><a href="#cb20-661" aria-hidden="true" tabindex="-1"></a>    }</span>
<span id="cb20-662"><a href="#cb20-662" aria-hidden="true" tabindex="-1"></a>    <span class="fu">return</span>(cats)</span>
<span id="cb20-663"><a href="#cb20-663" aria-hidden="true" tabindex="-1"></a>})</span>
<span id="cb20-664"><a href="#cb20-664" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb20-665"><a href="#cb20-665" aria-hidden="true" tabindex="-1"></a><span class="co"># extract discipline categories from single column to populate new columns</span></span>
<span id="cb20-666"><a href="#cb20-666" aria-hidden="true" tabindex="-1"></a>adc_disc_wide <span class="ot">&lt;-</span> solr_adc_sem <span class="sc">%&gt;%</span> </span>
<span id="cb20-667"><a href="#cb20-667" aria-hidden="true" tabindex="-1"></a>    <span class="fu">unnest_wider</span>(category, <span class="at">names_sep =</span><span class="st">"_"</span>) <span class="sc">%&gt;%</span> </span>
<span id="cb20-668"><a href="#cb20-668" aria-hidden="true" tabindex="-1"></a>    <span class="fu">select</span>(<span class="sc">-</span>sem_annotation)</span>
<span id="cb20-669"><a href="#cb20-669" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb20-670"><a href="#cb20-670" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb20-671"><a href="#cb20-671" aria-hidden="true" tabindex="-1"></a><span class="in">```{r map_old_themes_to_ADCAD_ont}</span></span>
<span id="cb20-672"><a href="#cb20-672" aria-hidden="true" tabindex="-1"></a><span class="co">#| code-fold: true</span></span>
<span id="cb20-673"><a href="#cb20-673" aria-hidden="true" tabindex="-1"></a><span class="co"># key from old discipline categories to new ADCAD ontology - approved matches</span></span>
<span id="cb20-674"><a href="#cb20-674" aria-hidden="true" tabindex="-1"></a>themes <span class="ot">&lt;-</span> <span class="fu">read_csv</span>(<span class="fu">file.path</span>(<span class="st">"data/old_themes_ADCAD_key.csv"</span>))</span>
<span id="cb20-675"><a href="#cb20-675" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb20-676"><a href="#cb20-676" aria-hidden="true" tabindex="-1"></a><span class="co"># read in csv with previous classifications</span></span>
<span id="cb20-677"><a href="#cb20-677" aria-hidden="true" tabindex="-1"></a>old_cat <span class="ot">&lt;-</span> <span class="fu">read.csv</span>(<span class="fu">file.path</span>(<span class="st">"data/dataset_categorization.csv"</span>))</span>
<span id="cb20-678"><a href="#cb20-678" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb20-679"><a href="#cb20-679" aria-hidden="true" tabindex="-1"></a><span class="co"># replace old theme categories with new ADCAD ontology terms.</span></span>
<span id="cb20-680"><a href="#cb20-680" aria-hidden="true" tabindex="-1"></a><span class="co"># only replacing terms that don't need review (themes df), leave the rest. </span></span>
<span id="cb20-681"><a href="#cb20-681" aria-hidden="true" tabindex="-1"></a>new_cat <span class="ot">&lt;-</span> old_cat <span class="sc">%&gt;%</span> </span>
<span id="cb20-682"><a href="#cb20-682" aria-hidden="true" tabindex="-1"></a>  <span class="fu">select</span>(url, id)</span>
<span id="cb20-683"><a href="#cb20-683" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb20-684"><a href="#cb20-684" aria-hidden="true" tabindex="-1"></a><span class="cf">for</span>(i <span class="cf">in</span> <span class="fu">colnames</span>(old_cat[<span class="dv">7</span><span class="sc">:</span><span class="dv">11</span>])) {</span>
<span id="cb20-685"><a href="#cb20-685" aria-hidden="true" tabindex="-1"></a>  <span class="co"># sequence through column names</span></span>
<span id="cb20-686"><a href="#cb20-686" aria-hidden="true" tabindex="-1"></a>  new_cat[[i]] <span class="ot">&lt;-</span> purrr<span class="sc">::</span><span class="fu">map</span>(old_cat[[i]], <span class="cf">function</span>(old_theme) {</span>
<span id="cb20-687"><a href="#cb20-687" aria-hidden="true" tabindex="-1"></a>    <span class="cf">if</span> (old_theme <span class="sc">%in%</span> themes<span class="sc">$</span>old) {</span>
<span id="cb20-688"><a href="#cb20-688" aria-hidden="true" tabindex="-1"></a>      <span class="co"># replace if old theme is listed</span></span>
<span id="cb20-689"><a href="#cb20-689" aria-hidden="true" tabindex="-1"></a>      new_theme <span class="ot">&lt;-</span></span>
<span id="cb20-690"><a href="#cb20-690" aria-hidden="true" tabindex="-1"></a>        themes<span class="sc">$</span>ADCAD[<span class="fu">which</span>(themes<span class="sc">$</span>old <span class="sc">==</span> old_theme)] <span class="co"># get corresponding new disc</span></span>
<span id="cb20-691"><a href="#cb20-691" aria-hidden="true" tabindex="-1"></a>      <span class="fu">return</span>(new_theme) <span class="co"># use disc ontology term to populate column</span></span>
<span id="cb20-692"><a href="#cb20-692" aria-hidden="true" tabindex="-1"></a>    } <span class="cf">else</span>{</span>
<span id="cb20-693"><a href="#cb20-693" aria-hidden="true" tabindex="-1"></a>      <span class="cf">if</span> (old_theme <span class="sc">==</span> <span class="st">""</span>) {</span>
<span id="cb20-694"><a href="#cb20-694" aria-hidden="true" tabindex="-1"></a>        old_theme <span class="ot">=</span> <span class="cn">NA</span></span>
<span id="cb20-695"><a href="#cb20-695" aria-hidden="true" tabindex="-1"></a>      }</span>
<span id="cb20-696"><a href="#cb20-696" aria-hidden="true" tabindex="-1"></a>      <span class="fu">return</span>(old_theme)</span>
<span id="cb20-697"><a href="#cb20-697" aria-hidden="true" tabindex="-1"></a>    } <span class="co"># keep old_theme if review is needed</span></span>
<span id="cb20-698"><a href="#cb20-698" aria-hidden="true" tabindex="-1"></a>  })</span>
<span id="cb20-699"><a href="#cb20-699" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb20-700"><a href="#cb20-700" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb20-701"><a href="#cb20-701" aria-hidden="true" tabindex="-1"></a><span class="co"># unnest list columns</span></span>
<span id="cb20-702"><a href="#cb20-702" aria-hidden="true" tabindex="-1"></a>new_cat <span class="sc">%&lt;&gt;%</span> </span>
<span id="cb20-703"><a href="#cb20-703" aria-hidden="true" tabindex="-1"></a>  <span class="fu">unnest</span>(<span class="at">cols =</span> <span class="fu">c</span>(<span class="st">"theme1"</span>, <span class="st">"theme2"</span>, <span class="st">"theme3"</span>, <span class="st">"theme4"</span>, <span class="st">"theme5"</span>))</span>
<span id="cb20-704"><a href="#cb20-704" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb20-705"><a href="#cb20-705" aria-hidden="true" tabindex="-1"></a><span class="co"># Add re-categorization to solr query results (adc_disc_wide)</span></span>
<span id="cb20-706"><a href="#cb20-706" aria-hidden="true" tabindex="-1"></a>adc_disc_new <span class="ot">&lt;-</span> adc_disc_wide <span class="sc">%&gt;%</span> </span>
<span id="cb20-707"><a href="#cb20-707" aria-hidden="true" tabindex="-1"></a>  <span class="fu">left_join</span>(new_cat, <span class="at">by =</span> <span class="st">"id"</span>) <span class="sc">%&gt;%</span> </span>
<span id="cb20-708"><a href="#cb20-708" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">url =</span> url)</span>
<span id="cb20-709"><a href="#cb20-709" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb20-710"><a href="#cb20-710" aria-hidden="true" tabindex="-1"></a><span class="co"># check if there is any overlapping entries between theme1 &amp; category_1 etc.</span></span>
<span id="cb20-711"><a href="#cb20-711" aria-hidden="true" tabindex="-1"></a><span class="co"># overlap_cat1 &lt;- adc_disc_new %&gt;%</span></span>
<span id="cb20-712"><a href="#cb20-712" aria-hidden="true" tabindex="-1"></a><span class="co">#   filter(!is.na(theme1) &amp; !is.na(category_1))</span></span>
<span id="cb20-713"><a href="#cb20-713" aria-hidden="true" tabindex="-1"></a><span class="co"># </span></span>
<span id="cb20-714"><a href="#cb20-714" aria-hidden="true" tabindex="-1"></a><span class="co"># overlap_cat2 &lt;- adc_disc_new %&gt;%</span></span>
<span id="cb20-715"><a href="#cb20-715" aria-hidden="true" tabindex="-1"></a><span class="co">#   filter(!is.na(theme2) &amp; !is.na(category_2))</span></span>
<span id="cb20-716"><a href="#cb20-716" aria-hidden="true" tabindex="-1"></a><span class="co"># </span></span>
<span id="cb20-717"><a href="#cb20-717" aria-hidden="true" tabindex="-1"></a><span class="co"># overlap_cat3 &lt;- adc_disc_new %&gt;%</span></span>
<span id="cb20-718"><a href="#cb20-718" aria-hidden="true" tabindex="-1"></a><span class="co">#   filter(!is.na(theme3) &amp; !is.na(category_3))</span></span>
<span id="cb20-719"><a href="#cb20-719" aria-hidden="true" tabindex="-1"></a><span class="co"># </span></span>
<span id="cb20-720"><a href="#cb20-720" aria-hidden="true" tabindex="-1"></a><span class="co"># overlap_cat4 &lt;- adc_disc_new %&gt;%</span></span>
<span id="cb20-721"><a href="#cb20-721" aria-hidden="true" tabindex="-1"></a><span class="co">#   filter(!is.na(theme4) &amp; !is.na(category_4))</span></span>
<span id="cb20-722"><a href="#cb20-722" aria-hidden="true" tabindex="-1"></a><span class="co"># </span></span>
<span id="cb20-723"><a href="#cb20-723" aria-hidden="true" tabindex="-1"></a><span class="co"># overlap_cat5 &lt;- adc_disc_new %&gt;%</span></span>
<span id="cb20-724"><a href="#cb20-724" aria-hidden="true" tabindex="-1"></a><span class="co">#   filter(!is.na(theme5) &amp; !is.na(category_5))</span></span>
<span id="cb20-725"><a href="#cb20-725" aria-hidden="true" tabindex="-1"></a><span class="co"># ^^ No overlap between two datasets</span></span>
<span id="cb20-726"><a href="#cb20-726" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb20-727"><a href="#cb20-727" aria-hidden="true" tabindex="-1"></a><span class="co"># Combine discipline category columns + DOI</span></span>
<span id="cb20-728"><a href="#cb20-728" aria-hidden="true" tabindex="-1"></a>adc_disc_ADCAD <span class="ot">&lt;-</span> adc_disc_new <span class="sc">%&gt;%</span> </span>
<span id="cb20-729"><a href="#cb20-729" aria-hidden="true" tabindex="-1"></a>  <span class="fu">transmute</span>(<span class="at">url =</span> url,</span>
<span id="cb20-730"><a href="#cb20-730" aria-hidden="true" tabindex="-1"></a>            <span class="at">id =</span> id,</span>
<span id="cb20-731"><a href="#cb20-731" aria-hidden="true" tabindex="-1"></a>            <span class="at">title =</span> title,</span>
<span id="cb20-732"><a href="#cb20-732" aria-hidden="true" tabindex="-1"></a>            <span class="at">disc_cat_1 =</span> <span class="fu">ifelse</span>(<span class="sc">!</span><span class="fu">is.na</span>(category_1), category_1, theme1),</span>
<span id="cb20-733"><a href="#cb20-733" aria-hidden="true" tabindex="-1"></a>            <span class="at">disc_cat_2 =</span> <span class="fu">ifelse</span>(<span class="sc">!</span><span class="fu">is.na</span>(category_2), category_2, theme2),</span>
<span id="cb20-734"><a href="#cb20-734" aria-hidden="true" tabindex="-1"></a>            <span class="at">disc_cat_3 =</span> <span class="fu">ifelse</span>(<span class="sc">!</span><span class="fu">is.na</span>(category_3), category_3, theme3),</span>
<span id="cb20-735"><a href="#cb20-735" aria-hidden="true" tabindex="-1"></a>            <span class="at">disc_cat_4 =</span> <span class="fu">ifelse</span>(<span class="sc">!</span><span class="fu">is.na</span>(category_4), category_4, theme4),</span>
<span id="cb20-736"><a href="#cb20-736" aria-hidden="true" tabindex="-1"></a>            <span class="at">disc_cat_5 =</span> <span class="fu">ifelse</span>(<span class="sc">!</span><span class="fu">is.na</span>(category_5), category_5, theme5)</span>
<span id="cb20-737"><a href="#cb20-737" aria-hidden="true" tabindex="-1"></a>  )</span>
<span id="cb20-738"><a href="#cb20-738" aria-hidden="true" tabindex="-1"></a><span class="co"># Save results</span></span>
<span id="cb20-739"><a href="#cb20-739" aria-hidden="true" tabindex="-1"></a><span class="co"># write.csv(adc_disc_ADCAD, "./output/ADC_ADCAD_disciplines.csv", row.names = F)</span></span>
<span id="cb20-740"><a href="#cb20-740" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div></div></div></div></div>
</div> <!-- /content -->



</body></html>